<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="mk-jar" name="groupware"
	xmlns:artifact="antlib:org.apache.maven.artifact.ant">

	<!-- [고객코드]에 따라 설정함 -->
	<property description="프로퍼티 파일 : build_[고객코드].properties - 개발서버 : ABC123"
		file="build.properties" />
	
	<typedef description="artifact: Ant에서 Maven 사용 라이브러리"
		resource="org/apache/maven/artifact/ant/antlib.xml"
		uri="antlib:org.apache.maven.artifact.ant"
		classpath="lib/maven-ant-tasks-2.1.3.jar" />

	<typedef description="contrib: Ant에서 if/then/else 사용 라이브러리"
		resource="net/sf/antcontrib/antlib.xml"
		classpath="lib/ant-contrib-1.0b3.jar" />
	
	<target description="작업 디렉토리 지우기"
		name="del-old">
		<delete dir="${mob.output}/webapp" />
		<delete file="${mob.output}/${cust.code}/webapp.jar" />
		<delete file="${mob.output}/${cust.code}/htdocs.jar" />
		<mkdir dir="${mob.output}/webapp/WEB-INF" />
	</target>

	<target  description="WIN-INF 디렉토리 output 디렉토리로 복사"
		name="cp-web-inf">
		<copy todir="${mob.output}/webapp/WEB-INF" overwrite="true">
			<fileset dir="${mob.source}/WEB-INF">
				<exclude name="lib/**" />
				<exclude name="jsp/sample/**" />
				<exclude name="message/message-temp_ko_KR.properties" />
			</fileset>
		</copy>
		<copy todir="${mob.output}/webapp/WEB-INF" overwrite="true">
			<fileset dir="${web.source}/WEB-INF">
				<include name="message/*.*" />
				<include name="tags/u/authUrl.tag" />
				<include name="tags/u/convert.tag" />
				<include name="tags/u/msg.tag" />
				<include name="tags/u/out.tag" />
				<include name="tags/u/secu.tag" />
				<include name="tags/u/set.tag" />
				<include name="tags/u/term.tag" />
				<include name="tags/u/cmt.tag" />
				<include name="tags/u/clob.tag" />
				<include name="tags/u/convertMap.tag" />
				<include name="tags/u/params.tag" />
				<include name="tags/u/convertJson.tag" />
				<include name="tags/u/buttonArea.tag" />
				<include name="tags/u/button.tag" />
				<include name="tags/u/convertJsonString.tag" />
				<include name="tags/u/blank.tag" />
				<include name="tags/u/files.tag" />
				<include name="tags/u/tab.tag" />
				<include name="tags/u/tabGroup.tag" />
				<include name="tags/u/title.tag" />
			</fileset>
		</copy>
	</target>

	<target description="classes 디렉토리 output 디렉토리로 복사"
		name="cp-classes">
		<copy todir="${mob.output}/webapp/WEB-INF/classes" overwrite="true">
			<fileset dir="${mob.target}/classes">
				<include name="com/**/*.*" />
				<include name="spring/*.*" />
				<include name="dtd/*.*" />
				<include name="resources/**/*.*" />
				<include name="sql/mybatis-config.xml" />
				<exclude name="com/innobiz/orange/web/cm/crypto/PropertyEncUtil.class" />
				<exclude name="com/innobiz/orange/web/sample/**/*.*" />
			</fileset>
		</copy>
		<copy todir="${mob.output}/webapp/WEB-INF/classes" overwrite="true">
			<fileset dir="${web.target}/classes">
				<include name="sql/${sql.dbms}/**/*.*" />
			</fileset>
		</copy>
		
		<copy overwrite="true"
				file="${web.target}/classes/settings/${cust.code}/gwOrange.license"
				tofile="${mob.output}/webapp/WEB-INF/classes/gwOrange.license" />
		<copy overwrite="true"
				file="${web.target}/classes/settings/${cust.code}/context.properties"
				tofile="${mob.output}/webapp/WEB-INF/classes/context.properties" />
		
		<if>
			<available file="${mob.target}/classes/settings/${cust.code}/servlet-context.xml"/>
			<then>
				<copy overwrite="true"
					file="${mob.target}/classes/settings/${cust.code}/servlet-context.xml"
					tofile="${mob.output}/webapp/WEB-INF/classes/spring/servlet-context.xml" />
			</then>
			<else>
				<copy overwrite="true"
					file="${mob.target}/classes/deploy/servlet-context.xml"
					tofile="${mob.output}/webapp/WEB-INF/classes/spring/servlet-context.xml" />
			</else>
		</if>
		
		<if>
			<available file="${mob.target}/classes/settings/${cust.code}/transaction-context.xml"/>
			<then>
				<copy overwrite="true"
					file="${mob.target}/classes/settings/${cust.code}/transaction-context.xml"
					tofile="${mob.output}/webapp/WEB-INF/classes/spring/transaction-context.xml" />
			</then>
			<else>
				<copy overwrite="true"
					file="${mob.target}/classes/deploy/transaction-context.xml"
					tofile="${mob.output}/webapp/WEB-INF/classes/spring/transaction-context.xml" />
			</else>
		</if>
		
		<if>
			<available file="${web.target}/classes/settings/${cust.code}/log4jMobile.xml"/>
			<then>
				<copy overwrite="true"
					file="${web.target}/classes/settings/${cust.code}/log4jMobile.xml"
					tofile="${mob.output}/webapp/WEB-INF/classes/log4j.xml" />
			</then>
			<else>
				<copy overwrite="true"
					file="${mob.target}/classes/deploy/log4j.xml"
					tofile="${mob.output}/webapp/WEB-INF/classes/log4j.xml" />
			</else>
		</if>
	</target>
	
	<target description="Maven Dependency 라이브러리 복사"
		name="cp-maven-libs">
		
		<artifact:dependencies
			filesetId="dependency.fileset" useScope="runtime" description="">
			<artifact:pom id="mypom" file="../pom.xml" />
		</artifact:dependencies>
		
		<copy description="Dependency의 라이브러리 복사"
			todir="${mob.output}/webapp/WEB-INF/lib">
	    	<fileset refid="dependency.fileset"/>
			<mapper type="flatten" />
		</copy>
		
	</target>
	
	<target description="jar 파일 생성 "
		name="mk-jar" depends="del-old,cp-web-inf,cp-classes,cp-maven-libs">
		
		<jar description="WAS 용 배포 jar 만들기 - Output Directory 에서"
			destfile="${mob.output}/${cust.code}/webapp.jar">
			<tarfileset dir="${mob.output}/webapp">
				<include name="/WEB-INF/**/*.*" />
			</tarfileset>
		</jar>
		
		<jar description="WEB 용 소배포 jar 만들기 - 실제 Directory 에서 추출"
			destfile="${mob.output}/${cust.code}/htdocs.jar">
			<tarfileset dir="${mob.source}">
				<include name="css/*.*" />
				<include name="images/**/*.*" />
				<include name="js/*.*" />
				<include name="browserconfig.xml" />
				<include name="favicon.ico" />
				<exclude name="images/upload/**/*.*" />
				<exclude name="js/jellyMobile.1.0.1.js" />
			</tarfileset>
		</jar>
		
		<echo message="${mob.output}/${cust.code} 에 htdocs.jar, webapp.jar 생성함" />
		
		<!--
		<if>
			<equals arg1="${cust.code}" arg2="ABC123" />
			<then>
				<copy description="배포 네트웍 드라이버로 복사"
					todir="${result.dir}" overwrite="true">
					<fileset dir="${mob.output}/${cust.code}">
						<include name="*.jar" />
					</fileset>
				</copy>
				<echo message="개발서버에 jar 복사" />
			</then>
			<else>
				
			</else>
		</if>
		-->
	</target>

</project>