<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
						http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.1.xsd
						http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.1.xsd
						http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.1.xsd">

	<bean id="gwDataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
		<property name="driverClassName" value="#{contextProperties.gwDriver}"/>
		<property name="url" value="#{contextProperties.gwUrl}"/>
		<property name="username" value="#{contextProperties.gwUsername}"/>
		<property name="password" value="#{contextProperties.gwPassword}"/>
		
		<property name="initialSize" value="2" />
		<property name="minIdle" value="2" />
		<property name="maxIdle" value="20" />
		<property name="testWhileIdle" value="true"/>
		<property name="validationQuery" value="#{contextProperties.validationQuery}"/>
		<property name="timeBetweenEvictionRunsMillis" value="180000"/>
<!--
참조
initialSize	초기에 생성되는 커넥션의 개수
maxActive	커넥션 풀이 제공할 최대 커넥션의 개수
maxWait	풀에 커넥션에 존재하지 않을 때, 커넥션이 다시 풀에 리턴될 때까지 대기시간, 1/1000초 단위, -1일 경우 무한대기
maxIdle	사용되지 않고 풀에 저장될 수 있는 최대 커넥션 개수, 음수일 경우 제한이 없다.
minIdle	사용되지 않고 풀에 저장될 수 있는 최소 커넥션 개수, 음수일 경우 제한이 없다.
testOnBorrow	true 일 경우 커넥션 풀에서 커넥션을 가져올 때 커넥션이 유효한지의 여부 검사
testOnReturn	true 일 경우 커넥션 풀에서 커넥션을 반환할 때 커넥션이 유효한지의 여부 검사
testWhileIdle	true 일 경우 비활성화 커넥션을 추출할 때 커넥션이 유효한지의 여부를 검사해서 유효하지 않은 커넥션은 풀에서 제거
validationQuery	　
timeBetweenEvictionRunsMillis	사용되지 않은 커넥션을 추출하는 쓰레드의 실행주기를 지정한다.
			양수가 아닌경우 실행되지 않는다.
numTestsPerEvictionRund	사용되지 않는 커넥션을 몇 개 검사할 지 지정
minEvictableIdleTimeMillis	사용되지 않은 커넥션을 추출할 때 이 속성에서 지정한 시간 이상 비활성화 상태인 커넥션만 추출한다.
			양수가 아닌 경우 비활성화된 시간으로 풀에서 제건 안됨. 1/1000초 단위
poolPreparedStatements	PreparedStatements를 풀링 할 것인지 결정한다.
PreparedStatement란 이처럼 바인드 변수의 사용을 가능케 하기 위해 사용됩니다. 
			따라서 동일한 문장(위처럼 값만 바뀐다거나 할때)이 여러 번 연속으로 실행되거나 비교적 연속적(라이브러리 캐쉬에 있는
			실행계획이 LRU에 의해 메모리에서 삭제되기 직전에 다시 실행되기만 한다면)으로 실행된다면 월등한 성능향상을 얻을 수 있습니다.
			그러므로 꼭 사용하도록 설정한다.( true로 설정해준다.)
-->
	</bean>

	<bean id="gwTxManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="gwDataSource"/>
	</bean>

	<tx:annotation-driven transaction-manager="gwTxManager" />

	<tx:advice id="gwTxAdvice" transaction-manager="gwTxManager">
		<tx:attributes>
			<tx:method name="*" rollback-for="Exception" propagation="REQUIRED"/>
		</tx:attributes>
	</tx:advice>

    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
		<property name="dataSource" ref="gwDataSource" />
		<property name="typeAliasesPackage" value="com.innobiz.orange.web" />
		<property name="configLocation" value="classpath:sql/mybatis-config.xml" />
		<property name="mapperLocations" value="classpath:sql/#{contextProperties.dbms}/*/*/mapper-*.xml" />
	</bean>

	<bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
		<property name="basePackage" value="com.innobiz.orange" />
	</bean>

    <bean id="commonSeqDao" class="com.innobiz.orange.web.cm.dao.CommonSeqDao" >
    	<property name="dataSource" ref="gwDataSource" />
    </bean>

    <bean id="commonDao" class="com.innobiz.orange.web.cm.dao.CommonDao" />

    <bean id="commonSvc" class="com.innobiz.orange.web.cm.svc.CommonSvc" >
    	<property name="commonDao" ref="commonDao" />
    	<property name="commonSeqDao" ref="commonSeqDao" />
    </bean>
	
    <bean id="lobHandler" class="com.innobiz.orange.web.cm.dao.LobHandler" >
    	<property name="dataSource" ref="gwDataSource" />
    </bean>

</beans>
