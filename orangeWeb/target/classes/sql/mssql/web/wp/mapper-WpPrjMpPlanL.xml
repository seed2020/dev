<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- TABLE : WP_PRJ_MP_PLAN_L[프로잭트인력계획내역] -->
<mapper namespace="com.innobiz.orange.web.wp.dao.WpPrjMpPlanLDao">

	<resultMap id="wpPrjMpPlanLMap" type="WpPrjMpPlanLVo">
		<id property="prjNo" column="PRJ_NO" /><!-- 프로잭트번호 -->
		<id property="mpId" column="MP_ID" /><!-- 인력ID -->
		<id property="mNo" column="M_NO" /><!-- 월번호 -->
		<result property="ver" column="VER" /><!-- 버전 -->
		<result property="planMm" column="PLAN_MM" /><!-- 계획멘먼스 -->
		<result property="planYm" column="PLAN_YM" /><!-- 계획년월 -->
		<result property="rnum" column="RNUM" /><!-- 레코드 번호 -->
	</resultMap>

	<select id="selectWpPrjMpPlanL" resultMap="wpPrjMpPlanLMap" parameterType="WpPrjMpPlanLVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpPlanLDao.selectWpPrjMpPlanL */
		<if test="pageNo != null and pageRowCnt != null">
		SELECT * FROM (
		</if>
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="pageNo != null and pageRowCnt != null">
			TOP (#{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}) ROW_NUMBER() OVER (ORDER BY <if test="orderBy != null">${orderBy}</if><if test="orderBy == null">N.PRJ_NO DESC, N.MP_ID DESC, N.M_NO DESC</if>) AS RNUM, N.* FROM (SELECT
			</if>
			T.PRJ_NO,
			T.MP_ID,
			T.M_NO,
			T.VER,
			T.PLAN_MM,
			CONVERT(VARCHAR(10), T.PLAN_YM, 120) PLAN_YM,
		</trim>
		FROM WP_PRJ_MP_PLAN_${tableType} T
		<where>
			<if test="prjNo != null">AND T.PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="mpId != null">AND T.MP_ID = #{mpId, jdbcType=VARCHAR}</if>
			<if test="mNo != null">AND T.M_NO = #{mNo, jdbcType=INTEGER}</if>
			<if test="ver != null and ver != ''">AND T.VER = #{ver, jdbcType=NUMERIC}</if>
			<if test="prjNoList != null">AND T.PRJ_NO IN ( <foreach collection="prjNoList" item="item" index="index" separator=",">#{item, jdbcType=VARCHAR}</foreach> )</if>
			<if test="minPlanYm != null and minPlanYm != ''">AND T.PLAN_YM <![CDATA[>=]]> CONVERT(DATETIME, #{minPlanYm, jdbcType=VARCHAR}, 120)</if>
			<if test="maxPlanYm != null and maxPlanYm != ''">AND T.PLAN_YM <![CDATA[<]]> CONVERT(DATETIME, #{maxPlanYm, jdbcType=VARCHAR}, 120)</if>
			<if test="minPlanMm != null and minPlanMm != ''">AND T.PLAN_MM <![CDATA[>]]> #{minPlanMm, jdbcType=NUMERIC}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
		<if test="pageNo == null or pageRowCnt == null">
			<if test="orderBy != null">ORDER BY ${orderBy}</if>
			<if test="orderBy == null">ORDER BY T.PRJ_NO, T.MP_ID, T.M_NO</if>
		</if>
		<if test="pageNo != null and pageRowCnt != null">
		<![CDATA[) N ) M WHERE RNUM > (#{pageNo, jdbcType=NUMERIC} - 1) * #{pageRowCnt, jdbcType=NUMERIC} AND RNUM <= #{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}]]>
		</if>
	</select>

	<select id="countWpPrjMpPlanL" resultType="Integer" parameterType="WpPrjMpPlanLVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpPlanLDao.countWpPrjMpPlanL */
		SELECT COUNT(*) CNT
		FROM WP_PRJ_MP_PLAN_${tableType} T
		<where>
			<if test="prjNo != null">AND T.PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="mpId != null">AND T.MP_ID = #{mpId, jdbcType=VARCHAR}</if>
			<if test="mNo != null">AND T.M_NO = #{mNo, jdbcType=INTEGER}</if>
			<if test="ver != null and ver != ''">AND T.VER = #{ver, jdbcType=NUMERIC}</if>
			<if test="prjNoList != null">AND T.PRJ_NO IN ( <foreach collection="prjNoList" item="item" index="index" separator=",">#{item, jdbcType=VARCHAR}</foreach> )</if>
			<if test="minPlanYm != null and minPlanYm != ''">AND T.PLAN_YM <![CDATA[>=]]> CONVERT(DATETIME, #{minPlanYm, jdbcType=VARCHAR}, 120)</if>
			<if test="maxPlanYm != null and maxPlanYm != ''">AND T.PLAN_YM <![CDATA[<]]> CONVERT(DATETIME, #{maxPlanYm, jdbcType=VARCHAR}, 120)</if>
			<if test="minPlanMm != null and minPlanMm != ''">AND T.PLAN_MM <![CDATA[>]]> #{minPlanMm, jdbcType=NUMERIC}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</select>

	<insert id="insertWpPrjMpPlanL" parameterType="WpPrjMpPlanLVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpPlanLDao.insertWpPrjMpPlanL */
		INSERT INTO WP_PRJ_MP_PLAN_${tableType}
		<trim prefix="(" suffix=")" suffixOverrides=",">
			PRJ_NO,
			MP_ID,
			M_NO,
			VER,
			PLAN_MM,
			PLAN_YM,
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides="," >
			#{prjNo, jdbcType=BIGINT},
			#{mpId, jdbcType=VARCHAR},
			#{mNo, jdbcType=INTEGER},
			#{ver, jdbcType=NUMERIC},
			<if test="planMm == ''">NULL</if><if test="planMm != ''">#{planMm, jdbcType=NUMERIC}</if>,
			<if test="planYm == 'sysdate'">GETDATE(),</if><if test="planYm == null or planYm == ''">NULL,</if>
			<if test="planYm != null and planYm != '' and planYm != 'sysdate'">CONVERT(DATETIME, #{planYm, jdbcType=VARCHAR}, 120),</if>
		</trim>
	</insert>

	<update id="updateWpPrjMpPlanL" parameterType="WpPrjMpPlanLVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpPlanLDao.updateWpPrjMpPlanL */
		UPDATE WP_PRJ_MP_PLAN_${tableType}
		<set>
			<if test="prjNo != null">PRJ_NO = #{prjNo, jdbcType=BIGINT},</if>
			<if test="mpId != null">MP_ID = #{mpId, jdbcType=VARCHAR},</if>
			<if test="mNo != null">M_NO = #{mNo, jdbcType=INTEGER},</if>
			<if test="planMm != null">PLAN_MM = <if test="planMm == ''">NULL</if><if test="planMm != ''">#{planMm, jdbcType=NUMERIC}</if>,</if>
			<if test="planYm != null">
				<if test="planYm == 'sysdate'">PLAN_YM = GETDATE(),</if>
				<if test="planYm == ''">PLAN_YM = NULL,</if>
				<if test="planYm != '' and planYm != 'sysdate'">PLAN_YM = CONVERT(DATETIME, #{planYm, jdbcType=VARCHAR}, 120),</if>
			</if>
		</set>
		<where>
			<if test="prjNo != null">AND PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="mpId != null">AND MP_ID = #{mpId, jdbcType=VARCHAR}</if>
			<if test="mNo != null">AND M_NO = #{mNo, jdbcType=INTEGER}</if>
			<if test="ver != null and ver != ''">AND VER = #{ver, jdbcType=NUMERIC}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</update>

	<delete id="deleteWpPrjMpPlanL" parameterType="WpPrjMpPlanLVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpPlanLDao.deleteWpPrjMpPlanL */
		DELETE FROM WP_PRJ_MP_PLAN_${tableType}
		<where>
			<if test="prjNo != null">AND PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="mpId != null">AND MP_ID = #{mpId, jdbcType=VARCHAR}</if>
			<if test="mNo != null">AND M_NO = #{mNo, jdbcType=INTEGER}</if>
			<if test="ver != null and ver != ''">AND VER = #{ver, jdbcType=NUMERIC}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</delete>
	
	<select id="selectPlanMmSumByPrjNo" resultMap="wpPrjMpPlanLMap" parameterType="WpPrjMpPlanLVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpPlanLDao.selectPlanMmSumByPrjNo */
		SELECT T.PRJ_NO, SUM(T.PLAN_MM) PLAN_MM
		FROM WP_PRJ_MP_PLAN_${tableType} T
		<where>
			<if test="prjNo != null">AND PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="prjNoList != null">AND T.PRJ_NO IN ( <foreach collection="prjNoList" item="item" index="index" separator=",">#{item, jdbcType=VARCHAR}</foreach> )</if>
		</where>
		GROUP BY T.PRJ_NO
	</select>

</mapper>