<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- TABLE : WP_PRJ_MP_RSLT_L[프로잭트인력결과내역] -->
<mapper namespace="com.innobiz.orange.web.wp.dao.WpPrjMpRsltLDao">

	<resultMap id="wpPrjMpRsltLMap" type="WpPrjMpRsltLVo">
		<id property="prjNo" column="PRJ_NO" /><!-- 프로잭트번호 -->
		<id property="mpId" column="MP_ID" /><!-- 인력ID -->
		<id property="rsltYmd" column="RSLT_YMD" /><!-- 결과년월일 -->
		<result property="rsltMd" column="RSLT_MD" /><!-- 결과맨데이 -->
		<result property="note" column="NOTE" /><!-- 비고 -->
		<result property="rnum" column="RNUM" /><!-- 레코드 번호 -->
	</resultMap>

	<select id="selectWpPrjMpRsltL" resultMap="wpPrjMpRsltLMap" parameterType="WpPrjMpRsltLVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpRsltLDao.selectWpPrjMpRsltL */
		<if test="pageNo != null and pageRowCnt != null">
		SELECT * FROM (
		</if>
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="pageNo != null and pageRowCnt != null">
			TOP (#{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}) ROW_NUMBER() OVER (ORDER BY <if test="orderBy != null">${orderBy}</if><if test="orderBy == null">N.PRJ_NO DESC, N.MP_ID DESC, N.RSLT_YMD DESC</if>) AS RNUM, N.* FROM (SELECT
			</if>
			T.PRJ_NO,
			T.MP_ID,
			CONVERT(VARCHAR(10), T.RSLT_YMD, 120) RSLT_YMD,
			T.RSLT_MD,
			T.NOTE,
		</trim>
		FROM WP_PRJ_MP_RSLT_L T
		<where>
			<if test="prjNo != null">AND T.PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="mpId != null">AND T.MP_ID = #{mpId, jdbcType=VARCHAR}</if>
			<if test="rsltYmd != null">AND T.RSLT_YMD = CONVERT(DATETIME, #{rsltYmd, jdbcType=VARCHAR}, 120)</if>
			<if test="prjNoList != null">AND T.PRJ_NO IN ( <foreach collection="prjNoList" item="item" index="index" separator=",">#{item, jdbcType=VARCHAR}</foreach> )</if>
			<if test="minRsltYmd != null and minRsltYmd != ''">AND T.RSLT_YMD <![CDATA[>=]]> CONVERT(DATETIME, #{minRsltYmd, jdbcType=VARCHAR}, 120)</if>
			<if test="maxRsltYmd != null and maxRsltYmd != ''">AND T.RSLT_YMD <![CDATA[<]]> CONVERT(DATETIME, #{maxRsltYmd, jdbcType=VARCHAR}, 120)</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
		<if test="pageNo == null or pageRowCnt == null">
			<if test="orderBy != null">ORDER BY ${orderBy}</if>
			<if test="orderBy == null">ORDER BY T.PRJ_NO, T.MP_ID, T.RSLT_YMD</if>
		</if>
		<if test="pageNo != null and pageRowCnt != null">
		<![CDATA[) N ) M WHERE RNUM > (#{pageNo, jdbcType=NUMERIC} - 1) * #{pageRowCnt, jdbcType=NUMERIC} AND RNUM <= #{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}]]>
		</if>
	</select>

	<select id="countWpPrjMpRsltL" resultType="Integer" parameterType="WpPrjMpRsltLVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpRsltLDao.countWpPrjMpRsltL */
		SELECT COUNT(*) CNT
		FROM WP_PRJ_MP_RSLT_L T
		<where>
			<if test="prjNo != null">AND T.PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="mpId != null">AND T.MP_ID = #{mpId, jdbcType=VARCHAR}</if>
			<if test="rsltYmd != null">AND T.RSLT_YMD = CONVERT(DATETIME, #{rsltYmd, jdbcType=VARCHAR}, 120)</if>
			<if test="prjNoList != null">AND T.PRJ_NO IN ( <foreach collection="prjNoList" item="item" index="index" separator=",">#{item, jdbcType=VARCHAR}</foreach> )</if>
			<if test="minRsltYmd != null and minRsltYmd != ''">AND T.RSLT_YMD <![CDATA[>=]]> CONVERT(DATETIME, #{minRsltYmd, jdbcType=VARCHAR}, 120)</if>
			<if test="maxRsltYmd != null and maxRsltYmd != ''">AND T.RSLT_YMD <![CDATA[<]]> CONVERT(DATETIME, #{maxRsltYmd, jdbcType=VARCHAR}, 120)</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</select>

	<insert id="insertWpPrjMpRsltL" parameterType="WpPrjMpRsltLVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpRsltLDao.insertWpPrjMpRsltL */
		INSERT INTO WP_PRJ_MP_RSLT_L
		<trim prefix="(" suffix=")" suffixOverrides=",">
			PRJ_NO,
			MP_ID,
			RSLT_YMD,
			RSLT_MD,
			NOTE,
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides="," >
			#{prjNo, jdbcType=BIGINT},
			#{mpId, jdbcType=VARCHAR},
			<if test="rsltYmd == 'sysdate'">CONVERT(DATETIME, CONVERT(VARCHAR(10), GETDATE(), 120), 120),</if><if test="rsltYmd == null or rsltYmd == ''">NULL,</if>
			<if test="rsltYmd != null and rsltYmd != '' and rsltYmd != 'sysdate'">CONVERT(DATETIME, #{rsltYmd, jdbcType=VARCHAR}, 120),</if>
			<if test="rsltMd == ''">NULL</if><if test="rsltMd != ''">#{rsltMd, jdbcType=NUMERIC}</if>,
			#{note, jdbcType=VARCHAR},
		</trim>
	</insert>

	<update id="updateWpPrjMpRsltL" parameterType="WpPrjMpRsltLVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpRsltLDao.updateWpPrjMpRsltL */
		UPDATE WP_PRJ_MP_RSLT_L
		<set>
			<if test="prjNo != null">PRJ_NO = #{prjNo, jdbcType=BIGINT},</if>
			<if test="mpId != null">MP_ID = #{mpId, jdbcType=VARCHAR},</if>
			<if test="rsltYmd != null">
				<if test="rsltYmd == 'sysdate'">RSLT_YMD = CONVERT(DATETIME, CONVERT(VARCHAR(10), GETDATE(), 120), 120),</if>
				<if test="rsltYmd == ''">RSLT_YMD = NULL,</if>
				<if test="rsltYmd != '' and rsltYmd != 'sysdate'">RSLT_YMD = CONVERT(DATETIME, #{rsltYmd, jdbcType=VARCHAR}, 120),</if>
			</if>
			<if test="rsltMd != null">RSLT_MD = <if test="rsltMd == ''">NULL</if><if test="rsltMd != ''">#{rsltMd, jdbcType=NUMERIC}</if>,</if>
			<if test="note != null">NOTE = #{note, jdbcType=VARCHAR},</if>
		</set>
		<where>
			<if test="prjNo != null">AND PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="mpId != null">AND MP_ID = #{mpId, jdbcType=VARCHAR}</if>
			<if test="rsltYmd != null">AND RSLT_YMD = CONVERT(DATETIME, #{rsltYmd, jdbcType=VARCHAR}, 120)</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</update>

	<delete id="deleteWpPrjMpRsltL" parameterType="WpPrjMpRsltLVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpRsltLDao.deleteWpPrjMpRsltL */
		DELETE FROM WP_PRJ_MP_RSLT_L
		<where>
			<if test="prjNo != null">AND PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="mpId != null">AND MP_ID = #{mpId, jdbcType=VARCHAR}</if>
			<if test="rsltYmd != null">AND RSLT_YMD = CONVERT(DATETIME, #{rsltYmd, jdbcType=VARCHAR}, 120)</if>
			<if test="minRsltYmd != null and minRsltYmd != ''">AND RSLT_YMD <![CDATA[>=]]> CONVERT(DATETIME, #{minRsltYmd, jdbcType=VARCHAR}, 120)</if>
			<if test="maxRsltYmd != null and maxRsltYmd != ''">AND RSLT_YMD <![CDATA[<]]> CONVERT(DATETIME, #{maxRsltYmd, jdbcType=VARCHAR}, 120)</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</delete>

</mapper>