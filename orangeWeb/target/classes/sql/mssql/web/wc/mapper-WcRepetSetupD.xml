<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- TABLE : WC_REPET_SETUP_D[반복설정 상세] -->
<mapper namespace="com.innobiz.orange.web.wc.dao.WcRepetSetupDDao">

	<resultMap id="wcRepetSetupDMap" type="WcRepetSetupDVo">
		<id property="schdlId" column="SCHDL_ID" /><!-- 일정ID -->
		<id property="repetPerdCd" column="REPET_PERD_CD" /><!-- 반복주기코드 -->
		<id property="apntMm" column="APNT_MM" /><!-- 지정월 -->
		<id property="repetMm" column="REPET_MM" /><!-- 반복월 -->
		<id property="apntWk" column="APNT_WK" /><!-- 지정주 -->
		<id property="repetWk" column="REPET_WK" /><!-- 반복주 -->
		<id property="apntDy" column="APNT_DY" /><!-- 지정요일 -->
		<id property="repetDd" column="REPET_DD" /><!-- 반복일 -->
		<id property="apntDd" column="APNT_DD" /><!-- 지정일 -->
		<id property="repetStartDt" column="REPET_START_DT" /><!-- 반복시작일시 -->
		<id property="repetEndDt" column="REPET_END_DT" /><!-- 반복종료일시 -->
	</resultMap>
	
	
	<!-- 조회조건 -->
	<sql id="selectWcRepetSetupDWhere">
		<where>
			<if test="schdlId != null and schdlId !=''"> AND WRS_T.SCHDL_ID = #{schdlId, jdbcType=VARCHAR}</if>
		</where>
	</sql>
	
	<!-- 목록조회 -->
	<select id="selectWcRepetSetupD" resultMap="wcRepetSetupDMap" parameterType="WcRepetSetupDVo" >
		/* com.innobiz.orange.web.wc.dao.WcRepetSetupDDao.selectWcRepetSetupD */
		<if test="pageNo != null and pageRowCnt != null">
		SELECT * FROM (
		</if>
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="pageNo != null and pageRowCnt != null">
			TOP (#{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}) ROW_NUMBER() OVER (ORDER BY <if test="orderBy != null">${orderBy}</if><if test="orderBy == null">N.SCHDL_ID DESC</if>) AS RNUM, N.* 
			FROM (
				SELECT
			</if>
			WRS_T.SCHDL_ID,
			WRS_T.REPET_PERD_CD,
			WRS_T.APNT_MM,
			WRS_T.REPET_MM,
			WRS_T.APNT_WK,
			WRS_T.REPET_WK,
			WRS_T.APNT_DY,
			WRS_T.REPET_DD,
			WRS_T.APNT_DD,
			CONVERT(VARCHAR(19), WRS_T.REPET_START_DT, 120) AS REPET_START_DT,
			CONVERT(VARCHAR(19), WRS_T.REPET_END_DT, 120) AS REPET_END_DT
		</trim>
		FROM WC_REPET_SETUP_D WRS_T
		<include refid="selectWcRepetSetupDWhere"/>
		<if test="pageNo == null or pageRowCnt == null">
			<if test="orderBy != null">ORDER BY ${orderBy}</if>
			<if test="orderBy == null">ORDER BY WRS_T.SCHDL_ID</if>
		</if>
		<if test="pageNo != null and pageRowCnt != null">
		<![CDATA[) N ) M WHERE RNUM > (#{pageNo, jdbcType=NUMERIC} - 1) * #{pageRowCnt, jdbcType=NUMERIC} AND RNUM <= #{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}]]>
		</if>
	</select>
	
	<!-- 목록조회 건수-->
	<select id="countWcRepetSetupD" resultType="Integer" parameterType="WcRepetSetupDVo" >
		/* com.innobiz.orange.web.wc.dao.WcRepetSetupDDao.countWcRepetSetupD */
		SELECT COUNT(*) CNT
		FROM WC_REPET_SETUP_D WRS_T
		<include refid="selectWcRepetSetupDWhere"/>
	</select>
	
	<!-- 폴더 등록 저장 -->
	<insert id="insertWcRepetSetupD" parameterType="WcRepetSetupDVo" >
		/* com.innobiz.orange.web.wc.dao.WcRepetSetupDDao.insertWcRepetSetupD */
		INSERT INTO WC_REPET_SETUP_D
		<trim prefix="(" suffix=")" suffixOverrides=",">
			SCHDL_ID,
			REPET_PERD_CD,
			APNT_MM,
			REPET_MM,
			APNT_WK,
			REPET_WK,
			APNT_DY,
			REPET_DD,
			APNT_DD,
			REPET_START_DT,
			REPET_END_DT
			
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides="," >
			#{schdlId, jdbcType=VARCHAR},
			#{repetPerdCd, jdbcType=VARCHAR},
			#{apntMm, jdbcType=VARCHAR},
			#{repetMm, jdbcType=VARCHAR},
			#{apntWk, jdbcType=VARCHAR},
			#{repetWk, jdbcType=VARCHAR},
			#{apntDy, jdbcType=VARCHAR},
			#{repetDd, jdbcType=VARCHAR},
			#{apntDd, jdbcType=VARCHAR},
			CONVERT(DATETIME, #{repetStartDt, jdbcType=VARCHAR}, 120),
			CONVERT(DATETIME, #{repetEndDt, jdbcType=VARCHAR}, 120),
			
		</trim>
	</insert>
	
	<!-- 폴더 수정 -->
	<update id="updateWcRepetSetupD" parameterType="WcRepetSetupDVo" >
		/* com.innobiz.orange.web.wc.dao.WcRepetSetupDDao.updateWcRepetSetupD */
		UPDATE WC_REPET_SETUP_D
		<set>
			<if test="repetPerdCd != null"> REPET_PERD_CD = #{repetPerdCd, jdbcType=VARCHAR},</if>
			<if test="apntMm != null"> APNT_MM = #{apntMm, jdbcType=VARCHAR},</if>
			<if test="repetMm != null"> REPET_MM = #{repetMm, jdbcType=VARCHAR},</if>
			<if test="apntWk != null"> APNT_WK = #{apntWk, jdbcType=VARCHAR},</if>
			<if test="repetWk != null"> REPET_WK = #{repetWk, jdbcType=VARCHAR},</if>
			<if test="apntDy != null"> APNT_DY = #{apntDy, jdbcType=VARCHAR},</if>
			<if test="repetDd != null"> REPET_DD = #{repetDd, jdbcType=VARCHAR},</if>
			<if test="apntDd != null"> APNT_DD = #{apntDd, jdbcType=VARCHAR},</if>
			<if test="repetStartDt != null"> REPET_START_DT =CONVERT(DATETIME, #{repetStartDt, jdbcType=VARCHAR}, 120),</if>
			<if test="repetEndDt != null"> REPET_END_DT =CONVERT(DATETIME, #{repetEndDt, jdbcType=VARCHAR}, 120),</if>
		</set>
		<where>
			<if test="schdlId != null and schdlId !=''"> AND SCHDL_ID = #{schdlId, jdbcType=VARCHAR}</if>
		</where>
	</update>

	<!-- 폴더 삭제 -->
	<delete id="deleteWcRepetSetupD" parameterType="WcRepetSetupDVo" >
		/* com.innobiz.orange.web.wc.dao.WcRepetSetupDDao.deleteWcRepetSetupD */
		DELETE FROM WC_REPET_SETUP_D
		<where>
			<if test="schdlId != null and schdlId !=''"> AND SCHDL_ID = #{schdlId, jdbcType=VARCHAR}</if>
		</where>
	</delete>

</mapper>