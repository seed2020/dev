<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- TABLE : CU_PSN_CARD_B[인사기록카드] -->
<mapper namespace="com.innobiz.orange.web.cu.dao.CuPsnCardBDao">

	<resultMap id="cuPsnCardBMap" type="CuPsnCardBVo">
		<id property="cardNo" column="CARD_NO" /><!-- 카드번호 -->
		<result property="compId" column="COMP_ID" /><!-- 회사ID -->
		<result property="ein" column="EIN" /><!-- 사번 -->
		<result property="compNm" column="COMP_NM" /><!-- 회사명 -->
		<result property="deptNm" column="DEPT_NM" /><!-- 부서명 -->
		<result property="joinDt" column="JOIN_DT" /><!-- 입사일자 -->
		<result property="teamNm" column="TEAM_NM" /><!-- 팀명 -->		
		<result property="positNm" column="POSIT_NM" /><!-- 직위명 -->
		<result property="koNm" column="KO_NM" /><!-- 성명(한글) -->
		<result property="znNm" column="ZN_NM" /><!-- 성명(한문) -->
		<result property="enNm" column="EN_NM" /><!-- 성명(영문) -->
		<result property="bodyXml" column="BODY_XML" /><!-- 본문XML -->
		<result property="regrUid" column="REGR_UID" /><!-- 등록자 -->
		<result property="regDt" column="REG_DT" /><!-- 등록일시 -->
		<result property="modrUid" column="MODR_UID" /><!-- 수정자 -->
		<result property="modDt" column="MOD_DT" /><!-- 수정일시 -->
	</resultMap>
	
	<sql id="selectCuPsnCardBWhere">
		<where>
			<if test="cardNo != null"> AND T.CARD_NO = #{cardNo, jdbcType=VARCHAR}</if>
			<if test="compId != null and compId !=''"> AND T.COMP_ID = #{compId, jdbcType=VARCHAR}</if>
			<if test="einList==null and ein != null and ein !=''"> AND T.EIN = #{ein, jdbcType=VARCHAR}</if>
			<if test="schCat == 'ein' and schWord != null and schWord != ''"> AND T.EIN like '%' + #{schWord, jdbcType=VARCHAR} + '%'</if>
			<if test="schCat == 'compNm' and schWord != null and schWord != ''"> AND T.COMP_NM like '%' + #{schWord, jdbcType=VARCHAR} + '%'</if>
			<if test="schCat == 'deptNm' and schWord != null and schWord != ''"> AND T.DEPT_NM like '%' + #{schWord, jdbcType=VARCHAR} + '%'</if>
			<if test="schCat == 'teamNm' and schWord != null and schWord != ''"> AND T.TEAM_NM like '%' + #{schWord, jdbcType=VARCHAR} + '%'</if>
			<if test="schCat == 'positNm' and schWord != null and schWord != ''"> AND T.POSIT_NM like '%' + #{schWord, jdbcType=VARCHAR} + '%'</if>
			<if test="schCat == 'koNm' and schWord != null and schWord != ''"> AND T.KO_NM like '%' + #{schWord, jdbcType=VARCHAR} + '%'</if>
			<if test="durCat == 'joinDt' and durStrtDt != null and durStrtDt != ''"><![CDATA[AND CONVERT(VARCHAR(10), T.JOIN_DT, 120) >= #{durStrtDt, jdbcType=VARCHAR}]]></if>
			<if test="durCat == 'joinDt' and durEndDt != null and durEndDt != ''"><![CDATA[AND CONVERT(VARCHAR(10), T.JOIN_DT, 120) <= #{durEndDt, jdbcType=VARCHAR}]]></if>
			<if test="ein == null and einList != null"> AND T.EIN IN ( <foreach collection="einList" item="item" index="index" separator=",">#{item, jdbcType=VARCHAR}</foreach> )</if><!-- 사번 목록 -->
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</sql>
	
	<select id="selectCuPsnCardB" resultMap="cuPsnCardBMap" parameterType="CuPsnCardBVo" >
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.selectCuPsnCardB */
		<if test="pageNo != null and pageRowCnt != null">
		SELECT * FROM (
		</if>
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="pageNo != null and pageRowCnt != null">
			TOP (#{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}) ROW_NUMBER() OVER (ORDER BY <if test="orderBy != null">${orderBy}</if><if test="orderBy == null">T.CARD_NO DESC</if>) AS RNUM,
			</if>
			T.CARD_NO,
			T.COMP_ID,
			T.EIN,
			T.COMP_NM,
			T.DEPT_NM,
			T.JOIN_DT,
			T.TEAM_NM,
			T.POSIT_NM,
			T.KO_NM,
			T.ZN_NM,
			T.EN_NM,
			T.BODY_XML,
			T.REGR_UID,
			T.REG_DT,
			T.MODR_UID,
			T.MOD_DT,						
		</trim>
		FROM CU_PSN_CARD_B T
		<include refid="selectCuPsnCardBWhere" />
		<if test="orderBy != null">ORDER BY ${orderBy}</if>
		<if test="orderBy == null">ORDER BY T.CARD_NO DESC</if>
		<if test="pageNo != null and pageRowCnt != null">
		<![CDATA[) M WHERE RNUM > (#{pageNo, jdbcType=NUMERIC} - 1) * #{pageRowCnt, jdbcType=NUMERIC} AND RNUM <= #{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}]]>
		</if>
	</select>

	<select id="countCuPsnCardB" resultType="Integer" parameterType="CuPsnCardBVo" >
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.countCuPsnCardB */
		SELECT COUNT(*) CNT
		FROM CU_PSN_CARD_B T
		<include refid="selectCuPsnCardBWhere" />
	</select>

	<insert id="insertCuPsnCardB" parameterType="CuPsnCardBVo">
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.insertCuPsnCardB */
		INSERT INTO CU_PSN_CARD_B
		<trim prefix="(" suffix=")" suffixOverrides=",">
			CARD_NO,
			COMP_ID,
			EIN,
			COMP_NM,
			DEPT_NM,
			JOIN_DT,
			TEAM_NM,
			POSIT_NM,
			KO_NM,
			ZN_NM,
			EN_NM,
			BODY_XML,
			REGR_UID,
			REG_DT,
			MODR_UID,
			MOD_DT,
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides=",">
			#{cardNo, jdbcType=INTEGER},
			#{compId, jdbcType=VARCHAR},
			#{ein, jdbcType=VARCHAR},
			#{compNm, jdbcType=VARCHAR},
			#{deptNm, jdbcType=VARCHAR},
			<if test="joinDt == null or joinDt == ''">NULL,</if><if test="joinDt != null and joinDt != ''">CONVERT(DATETIME, #{joinDt, jdbcType=VARCHAR}, 120),</if>
			#{teamNm, jdbcType=NVARCHAR},
			#{positNm, jdbcType=NVARCHAR},
			#{koNm, jdbcType=NVARCHAR},
			#{znNm, jdbcType=NVARCHAR},
			#{enNm, jdbcType=NVARCHAR},
			#{bodyXml, jdbcType=NVARCHAR},
			<if test="regrUid != null">#{regrUid, jdbcType=VARCHAR},</if><if test="regrUid == null">#{modrUid, jdbcType=VARCHAR},</if>
			<if test="regDt == 'sysdate'">GETDATE(),</if><if test="regDt == null or regDt == ''"><if test="modDt == 'sysdate'">GETDATE(),</if><if test="modDt != 'sysdate'">NULL,</if></if>
			<if test="regDt != null and regDt != '' and regDt != 'sysdate'">CONVERT(DATETIME, #{regDt, jdbcType=VARCHAR}, 120),</if>
			#{modrUid, jdbcType=VARCHAR},
			<if test="modDt == 'sysdate'">GETDATE(),</if><if test="modDt == null or modDt == ''">NULL,</if>
			<if test="modDt != null and modDt != '' and modDt != 'sysdate'">CONVERT(DATETIME, #{modDt, jdbcType=VARCHAR}, 120),</if>
		</trim>
	</insert>
			
	<update id="updateCuPsnCardB" parameterType="CuPsnCardBVo" >
		/* com.innobiz.orange.web.pt.dao.CuPsnCardBDao.updateCuPsnCardB */
		UPDATE CU_PSN_CARD_B
		<set>
			<if test="ein != null"> EIN = #{ein, jdbcType=VARCHAR},</if>
			<if test="compNm != null"> COMP_NM = #{compNm, jdbcType=VARCHAR},</if>
			<if test="deptNm != null"> DEPT_NM = #{deptNm, jdbcType=VARCHAR},</if>
			<if test="joinDt != null">
				<if test="joinDt == ''"> JOIN_DT = NULL,</if>
				<if test="joinDt != ''"> JOIN_DT = CONVERT(DATETIME, #{joinDt, jdbcType=VARCHAR}, 120),</if>
			</if>
			<if test="teamNm != null"> TEAM_NM = #{teamNm, jdbcType=VARCHAR},</if>
			<if test="positNm != null"> POSIT_NM = #{positNm, jdbcType=VARCHAR},</if>
			<if test="koNm != null"> KO_NM = #{koNm, jdbcType=VARCHAR},</if>
			<if test="znNm != null"> ZN_NM = #{znNm, jdbcType=VARCHAR},</if>
			<if test="enNm != null"> EN_NM = #{enNm, jdbcType=VARCHAR},</if>
			<if test="bodyXml != null"> BODY_XML = #{bodyXml, jdbcType=VARCHAR},</if>
			<if test="modrUid != null"> MODR_UID = #{modrUid, jdbcType=VARCHAR},</if>
			<if test="modDt != null">
				<if test="modDt == 'sysdate'"> MOD_DT = GETDATE(),</if>
				<if test="modDt == ''"> MOD_DT = NULL,</if>
				<if test="modDt != '' and modDt != 'sysdate'"> MOD_DT = CONVERT(DATETIME, #{modDt, jdbcType=VARCHAR}, 120),</if>
			</if>
		</set>
		<where>
			<if test="cardNo != null"> AND CARD_NO = #{cardNo, jdbcType=VARCHAR}</if>
			<if test="compId != null and compId !=''"> AND COMP_ID = #{compId, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</update>

	<delete id="deleteCuPsnCardB" parameterType="CuPsnCardBVo">
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.deleteCuPsnCardB */
		DELETE FROM CU_PSN_CARD_B
		<where>
			AND CARD_NO = #{cardNo, jdbcType=VARCHAR}
			<if test="compId != null and compId !=''"> AND COMP_ID = #{compId, jdbcType=VARCHAR}</if>
		</where>
	</delete>
	
	<!-- 이미지 -->
	<resultMap id="cuPsnImgDMap" type="CuPsnImgDVo">
		<id property="cardNo" column="CARD_NO" /><!-- 카드번호 -->
		<result property="imgPath" column="IMG_PATH" /><!-- 이미지경로 -->
		<result property="imgWdth" column="IMG_WDTH" /><!-- 이미지넓이 -->
		<result property="imgHght" column="IMG_HGHT" /><!-- 이미지높이 -->
		<result property="modrUid" column="MODR_UID" /><!-- 수정자UID -->
		<result property="modDt" column="MOD_DT" /><!-- 수정일시 -->
		<result property="modrNm" column="MODR_NM" /><!-- 수정자명 -->
		<result property="rnum" column="RNUM" /><!-- 레코드 번호 -->
	</resultMap>

	<select id="selectCuPsnImgD" resultMap="cuPsnImgDMap" parameterType="CuPsnImgDVo" >
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.selectCuPsnImgD */
		<if test="pageNo != null and pageRowCnt != null">
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			M.*,
			(SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_USER_B WHERE USER_UID = M.MODR_UID) AND LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR},'ko')) MODR_NM,
		</trim>
		FROM ( SELECT * FROM (
		</if>
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="pageNo != null and pageRowCnt != null">
			TOP (#{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}) ROW_NUMBER() OVER (ORDER BY <if test="orderBy != null">${orderBy}</if><if test="orderBy == null">N.CARD_NO DESC DESC</if>) AS RNUM, N.* FROM (SELECT
			</if>
			T.CARD_NO,
			T.IMG_PATH,
			T.IMG_WDTH,
			T.IMG_HGHT,
			T.MODR_UID,
			CONVERT(VARCHAR(19), T.MOD_DT, 120) MOD_DT,
			<if test="pageNo == null or pageRowCnt == null">
			(SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_USER_B WHERE USER_UID = T.MODR_UID) AND LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR},'ko')) MODR_NM,
			</if>
		</trim>
		FROM CU_PSN_IMG_D T
		<where>
			<if test="cardNo != null">AND T.CARD_NO = #{cardNo, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
		<if test="pageNo == null or pageRowCnt == null">
			<if test="orderBy != null">ORDER BY ${orderBy}</if>
			<if test="orderBy == null">ORDER BY T.CARD_NO</if>
		</if>
		<if test="pageNo != null and pageRowCnt != null">
		<![CDATA[) N ) M WHERE RNUM > (#{pageNo, jdbcType=NUMERIC} - 1) * #{pageRowCnt, jdbcType=NUMERIC} AND RNUM <= #{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}]]> ) M
		</if>
	</select>

	<select id="countCuPsnImgD" resultType="Integer" parameterType="CuPsnImgDVo" >
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.countCuPsnImgD */
		SELECT COUNT(*) CNT
		FROM CU_PSN_IMG_D T
		<where>
			<if test="cardNo != null">AND T.CARD_NO = #{cardNo, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</select>

	<insert id="insertCuPsnImgD" parameterType="CuPsnImgDVo" >
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.insertCuPsnImgD */
		INSERT INTO CU_PSN_IMG_D
		<trim prefix="(" suffix=")" suffixOverrides=",">
			CARD_NO,
			IMG_PATH,
			IMG_WDTH,
			IMG_HGHT,
			MODR_UID,
			MOD_DT,
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides="," >
			#{cardNo, jdbcType=VARCHAR},
			#{imgPath, jdbcType=VARCHAR},
			#{imgWdth, jdbcType=INTEGER},
			#{imgHght, jdbcType=INTEGER},
			#{modrUid, jdbcType=VARCHAR},
			<if test="modDt == 'sysdate'">GETDATE(),</if><if test="modDt == null or modDt == ''">NULL,</if>
			<if test="modDt != null and modDt != '' and modDt != 'sysdate'">CONVERT(DATETIME, #{modDt, jdbcType=VARCHAR}, 120),</if>
		</trim>
	</insert>

	<update id="updateCuPsnImgD" parameterType="CuPsnImgDVo" >
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.updateCuPsnImgD */
		UPDATE CU_PSN_IMG_D
		<set>
			<if test="imgPath != null">IMG_PATH = #{imgPath, jdbcType=VARCHAR},</if>
			<if test="imgWdth != null">IMG_WDTH = #{imgWdth, jdbcType=INTEGER},</if>
			<if test="imgHght != null">IMG_HGHT = #{imgHght, jdbcType=INTEGER},</if>
			<if test="modrUid != null">MODR_UID = #{modrUid, jdbcType=VARCHAR},</if>
			<if test="modDt != null">
				<if test="modDt == 'sysdate'">MOD_DT = GETDATE(),</if>
				<if test="modDt == ''">MOD_DT = NULL,</if>
				<if test="modDt != '' and modDt != 'sysdate'">MOD_DT = CONVERT(DATETIME, #{modDt, jdbcType=VARCHAR}, 120),</if>
			</if>
		</set>
		<where>
			<if test="cardNo != null">AND CARD_NO = #{cardNo, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</update>

	<delete id="deleteCuPsnImgD" parameterType="CuPsnImgDVo" >
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.deleteCuPsnImgD */
		DELETE FROM CU_PSN_IMG_D
		<where>
			<if test="cardNo != null">AND CARD_NO = #{cardNo, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</delete>
	
	<!-- 개인정보 -->
	<resultMap id="cuPsnInfoDMap" type="CuPsnInfoDVo">
		<id property="cardNo" column="CARD_NO" /><!-- 카드번호 -->
		<result property="ssnEnc" column="SSN_ENC" /><!-- 주민등록번호암호값 -->
		<result property="birthEnc" column="BIRTH_ENC" /><!-- 생년월일암호값 -->
		<result property="homeZipNoEnc" column="HOME_ZIP_NO_ENC" /><!-- 자택우편번호암호값 -->
		<result property="homeAdrEnc" column="HOME_ADR_ENC" /><!-- 자택주소암호값 -->
		<result property="homeDetlAdrEnc" column="HOME_DETL_ADR_ENC" /><!-- 자택상세주소암호값 -->
		<result property="mbnoEnc" column="MBNO_ENC" /><!-- 휴대전화번호암호값 -->		
	</resultMap>
	
	<sql id="selectCuPsnInfoDWhere">
		<where>
			<if test="cardNo != null"> AND T.CARD_NO = #{cardNo, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</sql>
	
	<select id="selectCuPsnInfoD" resultMap="cuPsnInfoDMap" parameterType="CuPsnInfoDVo" >
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.selectCuPsnInfoD */
		<if test="pageNo != null and pageRowCnt != null">
		SELECT * FROM (
		</if>
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="pageNo != null and pageRowCnt != null">
			TOP (#{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}) ROW_NUMBER() OVER (ORDER BY <if test="orderBy != null">${orderBy}</if><if test="orderBy == null">T.CARD_NO DESC</if>) AS RNUM,
			</if>
			T.CARD_NO,
			T.SSN_ENC,
			T.BIRTH_ENC,
			T.HOME_ZIP_NO_ENC,
			T.HOME_ADR_ENC,
			T.HOME_DETL_ADR_ENC,
			T.MBNO_ENC,
		</trim>
		FROM CU_PSN_INFO_D T
		<include refid="selectCuPsnInfoDWhere" />
		<if test="orderBy != null">ORDER BY ${orderBy}</if>
		<if test="orderBy == null">ORDER BY T.CARD_NO DESC</if>
		<if test="pageNo != null and pageRowCnt != null">
		<![CDATA[) M WHERE RNUM > (#{pageNo, jdbcType=NUMERIC} - 1) * #{pageRowCnt, jdbcType=NUMERIC} AND RNUM <= #{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}]]>
		</if>
	</select>

	<select id="countCuPsnInfoD" resultType="Integer" parameterType="CuPsnInfoDVo" >
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.countCuPsnInfoD */
		SELECT COUNT(*) CNT
		FROM CU_PSN_INFO_D T
		<include refid="selectCuPsnInfoDWhere" />
	</select>

	<insert id="insertCuPsnInfoD" parameterType="CuPsnInfoDVo">
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.insertCuPsnInfoD */
		INSERT INTO CU_PSN_INFO_D
		<trim prefix="(" suffix=")" suffixOverrides=",">
			CARD_NO,
			SSN_ENC,
			BIRTH_ENC,
			HOME_ZIP_NO_ENC,
			HOME_ADR_ENC,
			HOME_DETL_ADR_ENC,
			MBNO_ENC,
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides=",">
			#{cardNo, jdbcType=INTEGER},
			#{ssnEnc, jdbcType=VARCHAR},
			#{birthEnc, jdbcType=VARCHAR},
			#{homeZipNoEnc, jdbcType=VARCHAR},
			#{homeAdrEnc, jdbcType=VARCHAR},
			#{homeDetlAdrEnc, jdbcType=VARCHAR},
			#{mbnoEnc, jdbcType=VARCHAR},
		</trim>
	</insert>
			
	<update id="updateCuPsnInfoD" parameterType="CuPsnInfoDVo" >
		/* com.innobiz.orange.web.pt.dao.CuPsnInfoDDao.updateCuPsnInfoD */
		UPDATE CU_PSN_INFO_D
		<set>
			<if test="ssnEnc != null"> SSN_ENC = #{ssnEnc, jdbcType=VARCHAR},</if>
			<if test="birthEnc != null"> BIRTH_ENC = #{birthEnc, jdbcType=VARCHAR},</if>
			<if test="homeZipNoEnc != null"> HOME_ZIP_NO_ENC = #{homeZipNoEnc, jdbcType=VARCHAR},</if>
			<if test="homeAdrEnc != null"> HOME_ADR_ENC = #{homeAdrEnc, jdbcType=VARCHAR},</if>
			<if test="homeDetlAdrEnc != null"> HOME_DETL_ADR_ENC = #{homeDetlAdrEnc, jdbcType=VARCHAR},</if>
			<if test="mbnoEnc != null"> MBNO_ENC = #{mbnoEnc, jdbcType=VARCHAR},</if>
		</set>
		<where>
			<if test="cardNo != null"> AND CARD_NO = #{cardNo, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</update>

	<delete id="deleteCuPsnInfoD" parameterType="CuPsnInfoDVo">
		/* com.innobiz.orange.web.cu.dao.CuPsnCardBDao.deleteCuPsnInfoD */
		DELETE FROM CU_PSN_INFO_D
		<where>
			AND CARD_NO = #{cardNo, jdbcType=VARCHAR}
		</where>
	</delete>
	
	
</mapper>