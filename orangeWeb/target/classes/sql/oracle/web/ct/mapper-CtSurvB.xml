<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- TABLE : CT_SURV_B [커뮤니티 설문 기본] -->
<mapper namespace="com.innobiz.orange.web.ct.dao.CtSurvBDao">

	<resultMap id="ctSurvBMap" type="CtSurvBVo">
		<id property="compId" column="COMP_ID" /><!--회사ID-->
		<id property="survId" column="SURV_ID" /><!--설문ID-->
		
		<result property="ctId" column="CT_ID" /><!--커뮤니티 ID-->
		<result property="ctNm" column="CT_NM" /><!--커뮤니티 명-->
		<result property="ctFncId" column="CT_FNC_ID" /><!--커뮤니티 기능 ID-->
		<result property="ctFncOrdr" column="CT_FNC_ORDR" /><!--커뮤니티 기능 순서-->
		<result property="subj" column="SUBJ" /><!--설문 제목-->
		<result property="quesCnt" column="QUES_CNT" /><!--질문 개수-->
		<result property="survStartDt" column="SURV_START_DT" /><!--설문 시작일시-->
		<result property="survEndDt" column="SURV_END_DT" /><!--설문 종료일시-->
		<result property="pltId" column="PLT_ID" /><!--포틀릿ID-->
		<result property="regDt" column="REG_DT" /><!--등록일시-->
		<result property="modDt" column="MOD_DT" /><!--수정일시-->
		<result property="regrUid" column="REGR_UID" /><!--등록자UID-->
		<result property="regrNm" column="REGR_NM" /><!--등록자UID-->
		<result property="modrUid" column="MODR_UID" /><!--수정자UID-->
		<result property="survPrgStatCd" column="SURV_PRG_STAT_CD" /><!--설문진행상태코드-->
		<result property="openYn" column="OPEN_YN" /><!--공개여부-->
		<result property="repetSurvYn" column="REPET_SURV_YN" /><!--재설문여부-->
		<result property="survItnt" column="SURV_ITNT" /><!--설문취지-->
		<result property="survFtr" column="SURV_FTR" /><!--설문바닥글-->
		<result property="attYn" column="ATT_YN" /><!--첨부여부-->
		<result property="admRjtOpinCont" column="ADM_RJT_OPIN_CONT" /><!--관리자반려의견내용-->
		<result property="survTgtCd" column="SURV_TGT_CD" /><!--설문 대상 코드-->
		<!-- <result property="survFileId" column="SURV_FILE_ID" /> --><!--설문파일ID-->
		<result property="ctFncLocStep" column="CT_FNC_LOC_STEP" /><!-- 커뮤니티 기능 위치 단계 -->
	    <result property="ctFncUid" column="CT_FNC_UID" /><!-- 커뮤니티 기능 UID -->
	    <result property="ctFncPid" column="CT_FNC_PID" /><!-- 커뮤니티 기능 부모ID -->
	    <result property="rnum" column="RNUM" /><!-- 레코드 번호 -->
		<result property="logUserUid" column="LOG_USER_UID" /><!-- 로그인 User Uid -->
		<result property="joinUserCnt" column="JOIN_USER_CNT"/><!-- 참여 인원수-->
		<result property="replyYn" column="REPLY_YN"/><!-- 응답여부 -->
		<result property="compNm" column="COMP_NM"/><!-- 회사명 -->
	    <result property="langTyp" column="LANG_TYP" /><!--사용자 언어타입-->
	    
	      <!-- 커뮤니티 자료검색  -->
	    <result property="fncNm" column="FNC_NM" /><!-- 기능명 -->
	    <result property="strtDt" column="START_DT" /><!--시작 일시-->
		<result property="endDt" column="END_DT" /><!--종료 일시-->
		<result property="ctFncUrl" column="CT_FNC_URL" /><!--커뮤니티 기능 URL -->
		<result property="relTblSubj" column="REL_TBL_SUBJ" /><!--관계테이블명 -->
		<result property="mastNm" column="MAST_NM" /><!-- 마스터명 -->
		<result property="mastUid" column="MAST_UID" /><!-- 마스터UID -->
		
	</resultMap>
	<!-- 조회조건 -->
	<sql id="selectCtSurvBWhere">
		<where>
			<if test="compId != null and compId != ''"> AND CSB_T.COMP_ID = #{compId, jdbcType=CHAR}</if>
			<if test="survId != null and survId != ''"> AND CSB_T.SURV_ID = #{survId, jdbcType=VARCHAR}</if>
			<if test="ctId != null and ctId != ''"> AND CSB_T.CT_ID = #{ctId, jdbcType=VARCHAR}</if>
			<if test="regrUid != null and regrUid != ''"> AND CSB_T.regrUid = #{regrUid, jdbcType=VARCHAR}</if>
			
			<if test="survStartDt != null and survStartDt != ''"> AND CSB_T.SURV_START_DT = TO_DATE(#{survStartDt, jdbcType=VARCHAR}, 'YYYY-MM-DD HH24:MI:SS')</if>
			<if test="'subj'.equals(schCat) and schWord != null and schWord != ''">AND CSB_T.SUBJ LIKE '%'||#{schWord, jdbcType=VARCHAR}||'%'</if>
			<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">AND CSB_T.SURV_ITNT LIKE '%'||#{schWord, jdbcType=VARCHAR}||'%'</if>
			
			<!-- 날짜로 커뮤니티 자료검색  -->
			<if test="strtDt != null and strtDt != '' and  endDt != null and endDt != ''">
				AND TO_CHAR(CSB_T.REG_DT, 'YYYY-MM-DD') BETWEEN #{strtDt, jdbcType=VARCHAR} AND #{endDt, jdbcType=VARCHAR}
			</if>
			<if test="ctIdList != null">
	   			<![CDATA[ AND CT_ID IN ]]>
	   				 <foreach collection="ctIdList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
			
			<if test="survSearchList != null">
	   			<![CDATA[ AND SURV_PRG_STAT_CD IN ]]>
	   				 <foreach collection="survSearchList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
		</where>
	</sql>
	
	<!-- 목록조회 -->
	<select id="selectCtSurvB" resultMap="ctSurvBMap" parameterType="CtSurvBVo" >
		/* com.innobiz.orange.web.ct.dao.CtSurvBDao.selectCtSurvB */
		
		<if test="pageNo != null and pageRowCnt != null">
		SELECT * FROM (
		</if>
		SELECT
		
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="pageNo != null and pageRowCnt != null">
			* FROM (SELECT N.*, ROWNUM RNUM FROM (SELECT
			</if>
			CSB_T.COMP_ID , CSB_T.SURV_ID, CSB_T.CT_ID, CSB_T.CT_FNC_ID, CSB_T.CT_FNC_ORDR,
			CSB_T.SUBJ, CSB_T.QUES_CNT, CSB_T.SURV_START_DT, CSB_T.SURV_END_DT, CSB_T.PLT_ID, 
			CSB_T.REG_DT, CSB_T.MOD_DT, CSB_T.REGR_UID, CSB_T.MODR_UID, CSB_T.SURV_PRG_STAT_CD, 
			CSB_T.OPEN_YN, CSB_T.REPET_SURV_YN, CSB_T.SURV_ITNT, CSB_T.SURV_FTR, CSB_T.ATT_YN, 
			CSB_T.ADM_RJT_OPIN_CONT,  CSB_T.CT_FNC_LOC_STEP, CSB_T.CT_FNC_UID, CSB_T.CT_FNC_PID,CSB_T.SURV_TGT_CD,
			<!-- CSB_T.SURV_FILE_ID, -->
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM CT_SURV_REPLY_D
			 WHERE SURV_ID=CSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM CT_SURV_REPLY_D
			 WHERE SURV_ID=CSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(
				SELECT RESC_VA 
				FROM CT_RESC_B
				WHERE RESC_ID = (SELECT CT_SUBJ_RESC FROM CT_ESTB_B WHERE CT_ID = CSB_T.CT_ID)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
      		) CT_NM,
			(
				SELECT RESC_VA
		      	FROM OR_RESC_B
		      	WHERE RESC_ID = (
					SELECT RESC_ID 
					 FROM OR_USER_B 
		      		 WHERE USER_UID = CSB_T.REGR_UID
		      	)
		      	AND LANG_TYP_CD = #{queryLang, jdbcType=VARCHAR}
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = CSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM,
			(
			 SELECT RESC_VA FROM CT_RESC_B
				WHERE LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
				AND RESC_ID=(				
								SELECT CT_FNC_SUBJ_RESC_ID FROM CT_FNC_D
								WHERE CT_FNC_UID = CSB_T.CT_FNC_UID
							)
      		)FNC_NM,
      		(
      			SELECT URL 
				FROM CT_FNC_MNG_B
				WHERE CSB_T.CT_FNC_ID = CT_FNC_ID
				
			)CT_FNC_URL,
		   (
      			SELECT REL_TBL_SUBJ 
				FROM CT_FNC_MNG_B
				WHERE CSB_T.CT_FNC_ID = CT_FNC_ID
			)REL_TBL_SUBJ,
			(SELECT RESC_VA
		      	FROM OR_RESC_B
		      	WHERE RESC_ID = (
		      						SELECT RESC_ID
		      						FROM OR_USER_B
		      						WHERE USER_UID = (
		      											SELECT MAST_UID
														FROM CT_ESTB_B
														WHERE CSB_T.CT_ID = CT_ID
		      						
		      										)
		      					)
				AND LANG_TYP_CD = #{queryLang, jdbcType=VARCHAR}
		    )MAST_NM,
		    (
				SELECT MAST_UID
				FROM CT_ESTB_B
				WHERE CSB_T.CT_ID = CT_ID
			)MAST_UID,
		</trim>
		FROM CT_SURV_B CSB_T
		<include refid="selectCtSurvBWhere"/>
		
		<if test="orderBy != null">ORDER BY ${orderBy}</if>
			<!-- <if test="orderBy == null">ORDER BY CSB_T.SURV_ID</if> -->
			

		<if test="pageNo != null and pageRowCnt != null">
		<![CDATA[) N WHERE ROWNUM <= #{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}) WHERE RNUM > (#{pageNo, jdbcType=NUMERIC} - 1) * #{pageRowCnt, jdbcType=NUMERIC}]]> ) M
		</if>
	</select>
	
	<!-- 설문 사용자 목록조회 -->
	<select id="selectUserCtSurvB" resultMap="ctSurvBMap" parameterType="CtSurvBVo" >
		/* com.innobiz.orange.web.ct.dao.CtSurvBDao.selectUserCtSurvB */
		
		<if test="pageNo != null and pageRowCnt != null">
		SELECT * FROM (
		</if>
		SELECT
		
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="pageNo != null and pageRowCnt != null">
			* FROM (SELECT N.*, ROWNUM RNUM FROM (SELECT
			</if>
			CSB_T.COMP_ID,
      		CSB_T.SURV_ID,
		    CSB_T.SUBJ,
		    CSB_T.SURV_END_DT,
		    CSB_T.REGR_UID,
		    CSB_T.MODR_UID,
		    CSB_T.SURV_PRG_STAT_CD,
		    CSB_T.SURV_START_DT, 
		    CSB_T.QUES_CNT, 
			CSB_T.REG_DT, 
			CSB_T.MOD_DT, 
			CSB_T.OPEN_YN, 
			CSB_T.REPET_SURV_YN,
			CSB_T.CT_ID,
			CSB_T.CT_FNC_ID,
			CSB_T.CT_FNC_LOC_STEP,
			CSB_T.CT_FNC_UID,
			CSB_T.CT_FNC_PID,
			CSB_T.SURV_TGT_CD,
		    
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM CT_SURV_REPLY_D
			 WHERE SURV_ID=CSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM CT_SURV_REPLY_D
			 WHERE SURV_ID=CSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = CSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA 
				FROM CT_RESC_B
				WHERE RESC_ID = (SELECT CT_SUBJ_RESC FROM CT_ESTB_B WHERE CT_ID = CSB_T.CT_ID)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
      		) CT_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = CSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM,
			
			
		</trim>	
		FROM CT_SURV_B CSB_T
		<include refid="selectCtSurvBWhere"/>
		UNION
		
		SELECT
			CSB_T.COMP_ID,
      		CSB_T.SURV_ID,
		    CSB_T.SUBJ,
		    CSB_T.SURV_END_DT,
		    CSB_T.REGR_UID,
		    CSB_T.MODR_UID,
		    CSB_T.SURV_PRG_STAT_CD,
		    CSB_T.SURV_START_DT, 
		    CSB_T.QUES_CNT, 
			CSB_T.REG_DT, 
			CSB_T.MOD_DT, 
			CSB_T.OPEN_YN, 
			CSB_T.REPET_SURV_YN, 
			CSB_T.CT_ID,
			CSB_T.CT_FNC_ID,
			CSB_T.CT_FNC_LOC_STEP,
			CSB_T.CT_FNC_UID,
			CSB_T.CT_FNC_PID,
			CSB_T.SURV_TGT_CD,
			
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM CT_SURV_REPLY_D
			 WHERE SURV_ID=CSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM CT_SURV_REPLY_D
			 WHERE SURV_ID=CSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = CSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA 
				FROM CT_RESC_B
				WHERE RESC_ID = (SELECT CT_SUBJ_RESC FROM CT_ESTB_B WHERE CT_ID = CSB_T.CT_ID)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
      		) CT_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = CSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM
		
		FROM CT_SURV_B CSB_T
		<where>
		    <if test="'subj'.equals(schCat) and schWord != null and schWord != ''">
				AND CSB_T.SUBJ LIKE '%'||#{schWord, jdbcType=VARCHAR}||'%'
			</if>
			
			<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">
			    AND CSB_T.SURV_ITNT LIKE '%'||#{schWord, jdbcType=VARCHAR}||'%'
			</if>
			<if test="logUserUid != null and logUserUid != ''"> AND CSB_T.REGR_UID = #{logUserUid, jdbcType=VARCHAR}</if>
			<if test="survPrgStatCd != null and survPrgStatCd != ''"> AND CSB_T.SURV_PRG_STAT_CD = #{survPrgStatCd, jdbcType=CHAR}</if>
			<if test="ctId != null and ctId != ''"> AND CSB_T.CT_ID = #{ctId, jdbcType=VARCHAR}</if>
		</where>
		
		
		<if test="orderBy != null">ORDER BY ${orderBy}</if>

		<if test="pageNo != null and pageRowCnt != null">
		<![CDATA[) N WHERE ROWNUM <= #{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}) WHERE RNUM > (#{pageNo, jdbcType=NUMERIC} - 1) * #{pageRowCnt, jdbcType=NUMERIC}]]> ) M
		</if>
	</select>
	
	
	<!-- 목록조회 건수-->
	<select id="countCtSurvB" resultType="Integer" parameterType="CtSurvBVo" >
		/* com.innobiz.orange.web.ct.dao.CtSurvBDao.countCtSurvB */
		SELECT COUNT(*) CNT
		FROM CT_SURV_B CSB_T
		<include refid="selectCtSurvBWhere"/>
	</select>
	
	<!-- 사용자 설문 목록조회 건수-->
	<select id="countUserCtSurvB" resultType="Integer" parameterType="CtSurvBVo" >
		/* com.innobiz.orange.web.ct.dao.CtSurvBDao.countUserCtSurvB */
		SELECT COUNT(*) CNT
		FROM(		
			SELECT
				CSB_T.COMP_ID,
	      		CSB_T.SURV_ID,
			    CSB_T.SUBJ,
			    CSB_T.SURV_END_DT,
			    CSB_T.REGR_UID,
			    CSB_T.MODR_UID,
			    CSB_T.SURV_PRG_STAT_CD,
			    CSB_T.SURV_START_DT, 
			    CSB_T.QUES_CNT, 
				CSB_T.REG_DT, 
				CSB_T.MOD_DT, 
				CSB_T.OPEN_YN, 
				CSB_T.REPET_SURV_YN,
				CSB_T.CT_ID,
				CSB_T.CT_FNC_ID,
				CSB_T.CT_FNC_LOC_STEP,
				CSB_T.CT_FNC_UID,
				CSB_T.CT_FNC_PID,
				CSB_T.SURV_TGT_CD,
				(SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT FROM CT_SURV_REPLY_D WHERE SURV_ID=CSB_T.SURV_ID GROUP BY SURV_ID) AS JOIN_USER_CNT,
				(SELECT CASE WHEN COUNT(1) > 0 THEN 'O'	ELSE 'X'	END REPLY_YN FROM CT_SURV_REPLY_D	WHERE SURV_ID=CSB_T.SURV_ID AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR} ) AS REPLY_YN,
				(SELECT RESC_VA FROM CT_RESC_B WHERE RESC_ID = (SELECT CT_SUBJ_RESC FROM CT_ESTB_B WHERE CT_ID = CSB_T.CT_ID) AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}	) CT_NM,
				(SELECT USER_NM FROM OR_USER_B WHERE USER_UID = CSB_T.REGR_UID ) REGR_NM,
	      		(SELECT RESC_VA FROM PT_RESC_D WHERE RESC_ID = (SELECT RESC_ID FROM PT_COMP_B WHERE COMP_ID = CSB_T.COMP_ID)	AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}	) COMP_NM			
			FROM CT_SURV_B CSB_T
			<include refid="selectCtSurvBWhere"/>
			UNION			
			SELECT
				CSB_T.COMP_ID,
	      		CSB_T.SURV_ID,
			    CSB_T.SUBJ,
			    CSB_T.SURV_END_DT,
			    CSB_T.REGR_UID,
			    CSB_T.MODR_UID,
			    CSB_T.SURV_PRG_STAT_CD,
			    CSB_T.SURV_START_DT, 
			    CSB_T.QUES_CNT, 
				CSB_T.REG_DT, 
				CSB_T.MOD_DT, 
				CSB_T.OPEN_YN, 
				CSB_T.REPET_SURV_YN,
				CSB_T.CT_ID,
				CSB_T.CT_FNC_ID,
				CSB_T.CT_FNC_LOC_STEP,
				CSB_T.CT_FNC_UID,
				CSB_T.CT_FNC_PID,
				CSB_T.SURV_TGT_CD,
				(SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT FROM CT_SURV_REPLY_D WHERE SURV_ID=CSB_T.SURV_ID GROUP BY SURV_ID) AS JOIN_USER_CNT,
				(SELECT CASE WHEN COUNT(1) > 0 THEN 'O' ELSE 'X' END REPLY_YN	FROM CT_SURV_REPLY_D WHERE SURV_ID=CSB_T.SURV_ID AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}	) AS REPLY_YN,				
	      		(SELECT RESC_VA FROM CT_RESC_B WHERE RESC_ID = (SELECT CT_SUBJ_RESC FROM CT_ESTB_B WHERE CT_ID = CSB_T.CT_ID) AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}	) CT_NM,
      			(SELECT USER_NM FROM OR_USER_B WHERE USER_UID = CSB_T.REGR_UID) REGR_NM,
	      		(SELECT RESC_VA FROM PT_RESC_D WHERE RESC_ID = (SELECT RESC_ID FROM PT_COMP_B WHERE COMP_ID = CSB_T.COMP_ID) AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}) COMP_NM			
			FROM CT_SURV_B CSB_T
			<where>
			    <if test="'subj'.equals(schCat) and schWord != null and schWord != ''">
					AND CSB_T.SUBJ LIKE '%'||#{schWord, jdbcType=VARCHAR}||'%'
				</if>
				
				<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">
				    AND CSB_T.SURV_ITNT LIKE '%'||#{schWord, jdbcType=VARCHAR}||'%'
				</if>
				<if test="logUserUid != null and logUserUid != ''"> AND CSB_T.REGR_UID = #{logUserUid, jdbcType=VARCHAR}</if>
				<if test="survPrgStatCd != null and survPrgStatCd != ''"> AND CSB_T.SURV_PRG_STAT_CD = #{survPrgStatCd, jdbcType=CHAR}</if>
				<if test="ctId != null and ctId != ''"> AND CSB_T.CT_ID = #{ctId, jdbcType=VARCHAR}</if>
			</where>

		)CT_SURV_B
	</select>
	
	<!-- 등록 저장 -->
	<insert id="insertCtSurvB" parameterType="CtSurvBVo" >
		/* com.innobiz.orange.web.ct.dao.CtSurvBDao.insertCtSurvB */
		INSERT INTO CT_SURV_B
		<trim prefix="(" suffix=")" suffixOverrides=",">
			COMP_ID,
			CT_ID,  
			SURV_ID, 
			CT_FNC_ID, 
			CT_FNC_ORDR, 
			SUBJ, 
			QUES_CNT, 
			SURV_START_DT, 
			SURV_END_DT, 
			PLT_ID, 
			REG_DT, 
			MOD_DT, 
			REGR_UID, 
			MODR_UID, 
			SURV_PRG_STAT_CD, 
			OPEN_YN, 
			REPET_SURV_YN, 
			SURV_ITNT, 
			SURV_FTR, 
			ATT_YN, 
			ADM_RJT_OPIN_CONT, 
			CT_FNC_LOC_STEP, 
			CT_FNC_UID, 
			CT_FNC_PID,
			SURV_TGT_CD,
			<!-- CSB_T.SURV_FILE_ID, -->

		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides="," >
			#{compId, jdbcType=CHAR},
			#{ctId, jdbcType=VARCHAR},
			#{survId, jdbcType=VARCHAR},
			#{ctFncId, jdbcType=VARCHAR},
			#{ctFncOrdr, jdbcType=NUMERIC},
			#{subj, jdbcType=NVARCHAR},
			#{quesCnt, jdbcType=NUMERIC},
			TO_DATE(#{survStartDt, jdbcType=VARCHAR}, 'YYYY-MM-DD HH24:MI:SS'),
			TO_DATE(#{survEndDt, jdbcType=VARCHAR}, 'YYYY-MM-DD HH24:MI:SS'),
			#{pltId, jdbcType=VARCHAR},
			TO_DATE(#{regDt, jdbcType=VARCHAR}, 'YYYY-MM-DD HH24:MI:SS'),
			TO_DATE(#{modDt, jdbcType=VARCHAR}, 'YYYY-MM-DD HH24:MI:SS'),
			#{regrUid, jdbcType=VARCHAR},
			#{modrUid, jdbcType=VARCHAR},
			#{survPrgStatCd, jdbcType=VARCHAR},
			#{openYn, jdbcType=CHAR},
			#{repetSurvYn, jdbcType=CHAR},
			#{survItnt, jdbcType=NCLOB},
			#{survFtr, jdbcType=NCLOB},
			#{attYn, jdbcType=CHAR},
			#{admRjtOpinCont, jdbcType=NVARCHAR},
			#{ctFncLocStep, jdbcType=VARCHAR}, 
			#{ctFncUid, jdbcType=VARCHAR}, 
			#{ctFncPid, jdbcType=VARCHAR}, 
			#{survTgtCd, jdbcType=VARCHAR}, 
		</trim>
	</insert>
	
	<!-- 수정 -->
	<update id="updateCtSurvB" parameterType="CtSurvBVo" >
		/* com.innobiz.orange.web.ct.dao.CtSurvBDao.updateCtSurvB */
		UPDATE CT_SURV_B
		<set>
		    <if test="ctId != null"> CT_ID = #{ctId, jdbcType=VARCHAR},</if>
		    <if test="ctFncId != null"> CT_FNC_ID = #{ctFncId, jdbcType=VARCHAR},</if>
		    <if test="ctFncOrdr != null"> CT_FNC_ORDR = #{ctFncOrdr, jdbcType=NUMERIC},</if>
		    <if test="subj != null"> SUBJ = #{subj, jdbcType=NVARCHAR},</if>
			<if test="quesCnt != null"> QUES_CNT = #{quesCnt, jdbcType=NUMERIC},</if>
			<if test="survStartDt != null"> SURV_START_DT = TO_DATE(#{survStartDt, jdbcType=VARCHAR}, 'YYYY-MM-DD HH24:MI:SS'),</if>
			<if test="survEndDt != null"> SURV_END_DT = TO_DATE(#{survEndDt, jdbcType=VARCHAR}, 'YYYY-MM-DD HH24:MI:SS'),</if>
		    <if test="pltId != null"> PLT_ID = #{pltId, jdbcType=VARCHAR},</if>
			<if test="modDt != null"> MOD_DT = TO_DATE(#{modDt, jdbcType=VARCHAR}, 'YYYY-MM-DD HH24:MI:SS'),</if>
		    <if test="modrUid != null"> MODR_UID = #{modrUid, jdbcType=VARCHAR},</if>
		    <if test="survPrgStatCd != null"> SURV_PRG_STAT_CD = #{survPrgStatCd, jdbcType=VARCHAR},</if>
			<if test="openYn != null"> OPEN_YN = #{openYn, jdbcType=CHAR},</if>
			<if test="repetSurvYn != null"> REPET_SURV_YN = #{repetSurvYn, jdbcType=CHAR},</if>
			<if test="survItnt != null"> SURV_ITNT = #{survItnt, jdbcType=NCLOB},</if>
			<if test="survFtr != null"> SURV_FTR = #{survFtr, jdbcType=NCLOB},</if>
			<if test="attYn != null"> ATT_YN = #{attYn, jdbcType=CHAR},</if>
			<if test="admRjtOpinCont != null"> ADM_RJT_OPIN_CONT = #{admRjtOpinCont, jdbcType=NVARCHAR},</if>
			<!-- <if test="survFileId != null"> SURV_FILE_ID = #{survFileId, jdbcType=VARCHAR},</if> -->
			<if test="ctFncLocStep != null"> CT_FNC_LOC_STEP = #{ctFncLocStep, jdbcType=VARCHAR},</if>
		    <if test="ctFncUid != null"> CT_FNC_UID = #{ctFncUid, jdbcType=VARCHAR},</if>
		    <if test="ctFncPid != null"> CT_FNC_PID = #{ctFncPid, jdbcType=VARCHAR},</if>
		    <if test="survTgtCd != null"> SURV_TGT_CD = #{survTgtCd, jdbcType=VARCHAR},</if>

		</set>
		<where>
			<if test="compId != null and compId != ''"> AND COMP_ID = #{compId, jdbcType=CHAR}</if>
			<if test="survId != null and survId != ''"> AND SURV_ID = #{survId, jdbcType=VARCHAR}</if>
			<if test="ctId != null and ctId != ''"> AND CT_ID = #{ctId, jdbcType=VARCHAR}</if>
		</where>
	</update>

	<!-- 삭제 -->
	<delete id="deleteCtSurvB" parameterType="CtSurvBVo" >
		/* com.innobiz.orange.web.ct.dao.CtSurvBDao.deleteCtSurvB */
		DELETE FROM CT_SURV_B
		<where>
			<if test="compId != null and compId != ''"> AND COMP_ID = #{compId, jdbcType=CHAR}</if>
			<if test="survId != null and survId != ''"> AND SURV_ID = #{survId, jdbcType=VARCHAR}</if>
			<if test="ctId != null and ctId != ''"> AND CT_ID = #{ctId, jdbcType=VARCHAR}</if>
		</where>
	</delete>

</mapper>