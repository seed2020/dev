<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- TABLE : WV_SURV_B[설문 기본] -->
<mapper namespace="com.innobiz.orange.web.wv.dao.WvSurvBDao">

	<resultMap id="wvSurvBMap" type="WvSurvBVo">
		<id property="compId" column="COMP_ID" /><!--회사ID-->
		<id property="survId" column="SURV_ID" /><!--설문ID-->
		<result property="survSubj" column="SURV_SUBJ" /><!--설문 제목-->
		<result property="quesCnt" column="QUES_CNT" /><!--질문 개수-->
		<result property="survStartDt" column="SURV_START_DT" /><!--설문 시작일시-->
		<result property="survEndDt" column="SURV_END_DT" /><!--설문 종료일시-->
		<result property="pltId" column="PLT_ID" /><!--포틀릿ID-->
		<result property="regDt" column="REG_DT" /><!--등록일시-->
		<result property="modDt" column="MOD_DT" /><!--수정일시-->
		<result property="regrUid" column="REGR_UID" /><!--등록자UID-->
		<result property="regrNm" column="REGR_NM" /><!--등록자UID-->
		<result property="modrUid" column="MODR_UID" /><!--수정자UID-->
		<result property="survPrgStatCd" column="SURV_PRG_STAT_CD" /><!--설문진행상태코드-->
		<result property="openYn" column="OPEN_YN" /><!--공개여부-->
		<result property="repetSurvYn" column="REPET_SURV_YN" /><!--재설문여부-->
		<result property="survItnt" column="SURV_ITNT" /><!--설문취지-->
		<result property="survFtr" column="SURV_FTR" /><!--설문바닥글-->
		<result property="attYn" column="ATT_YN" /><!--첨부여부-->
		<result property="admRjtOpinCont" column="ADM_RJT_OPIN_CONT" /><!--관리자반려의견내용-->
		<result property="survFileId" column="SURV_FILE_ID" /><!--설문파일ID-->
		<result property="rnum" column="RNUM" /><!-- 레코드 번호 -->
		<result property="logUserUid" column="LOG_USER_UID" /><!-- 로그인 User Uid -->
		<result property="logUserDeptId" column="LOG_USER_DEPT_ID" /><!-- 로그인 User DeptId -->
		<result property="joinUserCnt" column="JOIN_USER_CNT"/><!-- 참여 인원수-->
		<result property="replyYn" column="REPLY_YN"/><!-- 응답여부 -->
		<result property="compNm" column="COMP_NM"/><!-- 회사명 -->
		<result property="langTyp" column="LANG_TYP" /><!--사용자 언어타입-->
		<result property="authTgtUid" column="AUTH_TGT_UID" /><!-- 권한타켓 UID -->
		<result property="wCnt" column="W_CNT" />
		<result property="rCnt" column="R_CNT" />
		<result property="useAuthCnt" column="USE_AUTH_CNT" />
		<result property="noAuthYn" column="NO_AUTH_YN" /><!-- 비권한여부 -->
		
	</resultMap>
	
	
	<!-- 조회조건 -->
	<sql id="selectWvSurvBWhere_201411">
		<where>
			<if test="compId != null and compId != ''"> AND WSB_T.COMP_ID = #{compId, jdbcType=CHAR}</if>
			<if test="survId != null and survId != ''"> AND WSB_T.SURV_ID = #{survId, jdbcType=VARCHAR}</if>
			<if test="survStartDt != null and survStartDt != ''"> AND WSB_T.SURV_START_DT = STR_TO_DATE(#{survStartDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s')</if>
			<if test="'survSubj'.equals(schCat) and schWord != null and schWord != ''">
				AND WSB_T.SURV_SUBJ LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			
			<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">
			    AND WSB_T.SURV_ITNT LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			
			<if test="regrUid != null and regrUid != ''"> AND WSB_T.REGR_UID = #{regrUid, jdbcType=VARCHAR}</if>
			<if test="survSearchList != null">
	   			<![CDATA[ AND SURV_PRG_STAT_CD IN ]]>
	   				 <foreach collection="survSearchList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
	   		<!-- 설문대상 조회 조건 : 비조회여부가 'Y' 거나 '부서 및 사용자가 지정되어 있는 설문 조회' -->
	   		<if test='logUserUid != null and schOrgPids != null and logUserDeptId != null'>
				AND ( 
					WSB_T.NO_AUTH_YN = 'Y' 
					OR (
						WSB_T.NO_AUTH_YN = 'N'
			        	AND WSB_T.SURV_ID IN (
				        	SELECT SURV_ID FROM WV_SURV_USE_AUTH_D
				        	WHERE ( AUTH_TGT_TYP_CD='U' AND AUTH_TGT_UID = #{logUserUid, jdbcType=VARCHAR} )
				        	OR (AUTH_TGT_TYP_CD='D' AND AUTH_INCL_YN = 'N' AND AUTH_TGT_UID = #{logUserDeptId, jdbcType=VARCHAR})
				        	OR (AUTH_TGT_TYP_CD='D' AND AUTH_INCL_YN = 'Y' AND AUTH_TGT_UID IN <foreach item="item" collection="schOrgPids" open="(" separator="," close=")">#{item, jdbcType=VARCHAR}</foreach>)
				        )
				    )
				)
			</if>
		</where>
	</sql>
	<!-- 목록조회 건수-->
	<select id="countUserWvSurvB_201411" resultType="Integer" parameterType="WvSurvBVo" >
		/* com.innobiz.orange.web.wv.dao.WvSurvBDao.countUserWvSurvB_201411 */
		SELECT COUNT(*) CNT
		FROM WV_SURV_B WSB_T
		<include refid="selectWvSurvBWhere_201411"/>
	</select>
	
	<!-- 목록조회 -->
	<select id="selectUserWvSurvB_201411" resultMap="wvSurvBMap" parameterType="WvSurvBVo" >
		/* com.innobiz.orange.web.wv.dao.WvSurvBDao.selectUserWvSurvB_201411 */
		
			SELECT
			<trim prefix="" suffix="" suffixOverrides=",">
				
				WSB_T.COMP_ID , WSB_T.SURV_ID, WSB_T.SURV_SUBJ, WSB_T.QUES_CNT, WSB_T.SURV_START_DT, 
				WSB_T.SURV_END_DT, WSB_T.PLT_ID, WSB_T.REG_DT, WSB_T.MOD_DT, WSB_T.REGR_UID,
				WSB_T.MODR_UID, WSB_T.SURV_PRG_STAT_CD, WSB_T.OPEN_YN, WSB_T.REPET_SURV_YN, 
				WSB_T.SURV_ITNT, WSB_T.SURV_FTR, WSB_T.ATT_YN, WSB_T.ADM_RJT_OPIN_CONT, WSB_T.SURV_FILE_ID,
				(
				 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
				 FROM WV_SURV_REPLY_D
				 WHERE SURV_ID=WSB_T.SURV_ID
				 GROUP BY SURV_ID
				) AS JOIN_USER_CNT,
				(
				 SELECT CASE WHEN COUNT(1) > 0
							THEN 'O'
							ELSE 'X'
						END REPLY_YN
				 FROM WV_SURV_REPLY_D
				 WHERE SURV_ID=WSB_T.SURV_ID
						AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
				
				) AS REPLY_YN,
				(
					SELECT RESC_VA
			      	FROM OR_RESC_B
			      	WHERE RESC_ID = (
						SELECT RESC_ID 
						 FROM OR_USER_B 
			      		 WHERE USER_UID = WSB_T.REGR_UID
			      	)
			      	AND LANG_TYP_CD = #{queryLang, jdbcType=VARCHAR}
	      		) REGR_NM,
	      		(
					SELECT RESC_VA
					FROM PT_RESC_D
					WHERE RESC_ID = (
										SELECT RESC_ID
										FROM PT_COMP_B
										WHERE COMP_ID = WSB_T.COMP_ID
									)
					AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
				)COMP_NM,				
				NO_AUTH_YN,
				
			</trim>
			FROM WV_SURV_B WSB_T
			<include refid="selectWvSurvBWhere_201411"/>

		<if test="pageNo == null or pageRowCnt == null">
			<if test="orderBy != null">ORDER BY ${orderBy}</if>
		</if>
		<if test="pageNo != null and pageRowCnt != null">
		LIMIT #{pageStrt, jdbcType=NUMERIC}, #{pageRowCnt, jdbcType=NUMERIC}
		</if>
	</select>

	<!-- 조회조건 -->
	<sql id="selectWvSurvBWhere">
		<where>
			<if test="compId != null and compId != ''"> AND WSB_T.COMP_ID = #{compId, jdbcType=CHAR}</if>
			<if test="survId != null and survId != ''"> AND WSB_T.SURV_ID = #{survId, jdbcType=VARCHAR}</if>
			<if test="survStartDt != null and survStartDt != ''"> AND WSB_T.SURV_START_DT = STR_TO_DATE(#{survStartDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s')</if>
			<if test="'survSubj'.equals(schCat) and schWord != null and schWord != ''">
				AND WSB_T.SURV_SUBJ LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			
			<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">
			    AND WSB_T.SURV_ITNT LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			
			<if test="regrUid != null and regrUid != ''"> AND WSB_T.REGR_UID = #{regrUid, jdbcType=VARCHAR}</if>
			<if test="survSearchList != null">
	   			<![CDATA[ AND SURV_PRG_STAT_CD IN ]]>
	   				 <foreach collection="survSearchList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
	   		<if test="authTgtUid != null">
	   			AND WSUAD_T.AUTH_TGT_UID IS NULL
	   		</if>
		</where>
	</sql>
	
	<!-- 목록조회 -->
	<select id="selectWvSurvB" resultMap="wvSurvBMap" parameterType="WvSurvBVo" >
		/* com.innobiz.orange.web.wv.dao.WvSurvBDao.selectWvSurvB */
		
		SELECT
		
		<trim prefix="" suffix="" suffixOverrides=",">
			WSB_T.COMP_ID , WSB_T.SURV_ID, WSB_T.SURV_SUBJ, WSB_T.QUES_CNT, WSB_T.SURV_START_DT, 
			WSB_T.SURV_END_DT, WSB_T.PLT_ID, WSB_T.REG_DT, WSB_T.MOD_DT, WSB_T.REGR_UID,
			WSB_T.MODR_UID, WSB_T.SURV_PRG_STAT_CD, WSB_T.OPEN_YN, WSB_T.REPET_SURV_YN, 
			WSB_T.SURV_ITNT, WSB_T.SURV_FTR, WSB_T.ATT_YN, WSB_T.ADM_RJT_OPIN_CONT, WSB_T.SURV_FILE_ID,
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(
				SELECT RESC_VA
		      	FROM OR_RESC_B
		      	WHERE RESC_ID = (
					SELECT RESC_ID 
					 FROM OR_USER_B 
		      		 WHERE USER_UID = WSB_T.REGR_UID
		      	)
		      	AND LANG_TYP_CD = #{queryLang, jdbcType=VARCHAR}
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = WSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM,
			NO_AUTH_YN,
			
		</trim>
		FROM WV_SURV_B WSB_T
		<include refid="selectWvSurvBWhere"/>
	
		
		<if test="pageNo == null or pageRowCnt == null">
			<if test="orderBy != null">ORDER BY ${orderBy}</if>
		</if>
		<if test="pageNo != null and pageRowCnt != null">
		LIMIT #{pageStrt, jdbcType=NUMERIC}, #{pageRowCnt, jdbcType=NUMERIC}
		</if>
	</select>
	
	<!-- 설문 사용자 목록조회 -->
	<select id="selectUserWvSurvB" resultMap="wvSurvBMap" parameterType="WvSurvBVo" >
		/* com.innobiz.orange.web.wv.dao.WvSurvBDao.selectUserWvSurvB */
		
		SELECT
		
		<trim prefix="" suffix="" suffixOverrides=",">
			WSB_T.COMP_ID,
      		WSB_T.SURV_ID,
		    WSB_T.SURV_SUBJ,
		    WSB_T.SURV_END_DT,
		    WSB_T.REGR_UID,
		    WSB_T.MODR_UID,
		    WSB_T.SURV_PRG_STAT_CD,
		    WSB_T.SURV_START_DT, 
		    WSB_T.QUES_CNT, 
			WSB_T.REG_DT, 
			WSB_T.MOD_DT, 
			WSB_T.OPEN_YN, 
			WSB_T.REPET_SURV_YN, 
			
		    
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = WSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = WSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM,
			NO_AUTH_YN,
			
		</trim>	
		FROM WV_SURV_B WSB_T
		LEFT OUTER JOIN WV_SURV_USE_AUTH_D AS WSUAD_T ON WSB_T.SURV_ID = WSUAD_T.SURV_ID
		<include refid="selectWvSurvBWhere"/>
		
		
		UNION
		
		SELECT
			WSB_T.COMP_ID,
      		WSB_T.SURV_ID,
		    WSB_T.SURV_SUBJ,
		    WSB_T.SURV_END_DT,
		    WSB_T.REGR_UID,
		    WSB_T.MODR_UID,
		    WSB_T.SURV_PRG_STAT_CD,
		    WSB_T.SURV_START_DT, 
		    WSB_T.QUES_CNT, 
			WSB_T.REG_DT, 
			WSB_T.MOD_DT, 
			WSB_T.OPEN_YN, 
			WSB_T.REPET_SURV_YN, 
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = WSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = WSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM,
		NO_AUTH_YN
		FROM WV_SURV_B WSB_T
		LEFT OUTER JOIN WV_SURV_USE_AUTH_D AS WSUAD_T ON WSB_T.SURV_ID = WSUAD_T.SURV_ID
		<where>
		    <if test="'survSubj'.equals(schCat) and schWord != null and schWord != ''">
				AND WSB_T.SURV_SUBJ LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			
			<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">
			    AND WSB_T.SURV_ITNT LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			<if test="survSearchList != null">
	   			<![CDATA[ AND SURV_PRG_STAT_CD IN ]]>
	   				 <foreach collection="survSearchList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
	   		AND WSUAD_T.AUTH_TGT_UID IS NULL
		</where>
		
		
		UNION
		
		SELECT
			WSB_T.COMP_ID,
      		WSB_T.SURV_ID,
		    WSB_T.SURV_SUBJ,
		    WSB_T.SURV_END_DT,
		    WSB_T.REGR_UID,
		    WSB_T.MODR_UID,
		    WSB_T.SURV_PRG_STAT_CD,
		    WSB_T.SURV_START_DT, 
		    WSB_T.QUES_CNT, 
			WSB_T.REG_DT, 
			WSB_T.MOD_DT, 
			WSB_T.OPEN_YN, 
			WSB_T.REPET_SURV_YN, 
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = WSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = WSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM,
			NO_AUTH_YN		
		FROM WV_SURV_B WSB_T
		LEFT OUTER JOIN WV_SURV_USE_AUTH_D AS WSUAD_T ON WSB_T.SURV_ID = WSUAD_T.SURV_ID
		<where>
		    <if test="'survSubj'.equals(schCat) and schWord != null and schWord != ''">
				AND WSB_T.SURV_SUBJ LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			
			<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">
			    AND WSB_T.SURV_ITNT LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			<if test="survSearchList != null">
	   			<![CDATA[ AND SURV_PRG_STAT_CD IN ]]>
	   				 <foreach collection="survSearchList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
	   		<if test="logUserUid != null and logUserUid != ''"> AND WSB_T.REGR_UID = #{logUserUid, jdbcType=VARCHAR}</if>
	   		AND WSUAD_T.AUTH_TGT_UID IS NOT NULL
		</where>
		
		
		UNION
		
		SELECT
			WSB_T.COMP_ID,
      		WSB_T.SURV_ID,
		    WSB_T.SURV_SUBJ,
		    WSB_T.SURV_END_DT,
		    WSB_T.REGR_UID,
		    WSB_T.MODR_UID,
		    WSB_T.SURV_PRG_STAT_CD,
		    WSB_T.SURV_START_DT, 
		    WSB_T.QUES_CNT, 
			WSB_T.REG_DT, 
			WSB_T.MOD_DT, 
			WSB_T.OPEN_YN, 
			WSB_T.REPET_SURV_YN, 
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = WSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = WSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM,
			NO_AUTH_YN
		FROM WV_SURV_B WSB_T
		LEFT OUTER JOIN WV_SURV_USE_AUTH_D AS WSUAD_T ON WSB_T.SURV_ID = WSUAD_T.SURV_ID
		<where>
		    <if test="'survSubj'.equals(schCat) and schWord != null and schWord != ''">
				AND WSB_T.SURV_SUBJ LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			
			<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">
			    AND WSB_T.SURV_ITNT LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			<if test="survSearchList != null">
	   			<![CDATA[ AND SURV_PRG_STAT_CD IN ]]>
	   				 <foreach collection="survSearchList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
	   		<if test="logUserUid != null and logUserUid != ''"> AND WSUAD_T.AUTH_TGT_UID = #{logUserUid, jdbcType=VARCHAR}</if>
	   		AND WSUAD_T.AUTH_TGT_UID IS NOT NULL
		</where>
		
		
		UNION
		
		SELECT
			WSB_T.COMP_ID,
      		WSB_T.SURV_ID,
		    WSB_T.SURV_SUBJ,
		    WSB_T.SURV_END_DT,
		    WSB_T.REGR_UID,
		    WSB_T.MODR_UID,
		    WSB_T.SURV_PRG_STAT_CD,
		    WSB_T.SURV_START_DT, 
		    WSB_T.QUES_CNT, 
			WSB_T.REG_DT, 
			WSB_T.MOD_DT, 
			WSB_T.OPEN_YN, 
			WSB_T.REPET_SURV_YN, 
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = WSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = WSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM,
			NO_AUTH_YN
		FROM WV_SURV_B WSB_T
		LEFT OUTER JOIN WV_SURV_USE_AUTH_D AS WSUAD_T ON WSB_T.SURV_ID = WSUAD_T.SURV_ID
		<where>
		    <if test="'survSubj'.equals(schCat) and schWord != null and schWord != ''">
				AND WSB_T.SURV_SUBJ LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			
			<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">
			    AND WSB_T.SURV_ITNT LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			<if test="survSearchList != null">
	   			<![CDATA[ AND SURV_PRG_STAT_CD IN ]]>
	   				 <foreach collection="survSearchList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
	   		<if test="logUserDeptId != null and logUserDeptId != ''"> AND WSUAD_T.AUTH_TGT_UID = #{logUserDeptId, jdbcType=VARCHAR}</if>
	   		AND WSUAD_T.AUTH_TGT_UID IS NOT NULL
		</where>
		
		<!-- 
		설문목록에서 임시저장 상태는 뺌.
		UNION
		
		SELECT
			WSB_T.COMP_ID,
      		WSB_T.SURV_ID,
		    WSB_T.SURV_SUBJ,
		    WSB_T.SURV_END_DT,
		    WSB_T.REGR_UID,
		    WSB_T.MODR_UID,
		    WSB_T.SURV_PRG_STAT_CD,
		    WSB_T.SURV_START_DT, 
		    WSB_T.QUES_CNT, 
			WSB_T.REG_DT, 
			WSB_T.MOD_DT, 
			WSB_T.OPEN_YN, 
			WSB_T.REPET_SURV_YN, 
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = WSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = WSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM
		
		FROM WV_SURV_B WSB_T
		<where>
			<if test="logUserUid != null and logUserUid != ''"> AND WSB_T.REGR_UID = #{logUserUid, jdbcType=VARCHAR}</if>
			<if test="survPrgStatCd != null and survPrgStatCd != ''"> AND WSB_T.SURV_PRG_STAT_CD = #{survPrgStatCd, jdbcType=CHAR}</if>
		</where>
		 -->
		
		
		
		
		<if test="pageNo == null or pageRowCnt == null">
			<if test="orderBy != null">ORDER BY ${orderBy}</if>
		</if>
		<if test="pageNo != null and pageRowCnt != null">
		LIMIT #{pageStrt, jdbcType=NUMERIC}, #{pageRowCnt, jdbcType=NUMERIC}
		</if>
	</select>
	
	<!-- 목록조회 건수-->
	<select id="countWvSurvB" resultType="Integer" parameterType="WvSurvBVo" >
		/* com.innobiz.orange.web.wv.dao.WvSurvBDao.countWvSurvB */
		SELECT COUNT(*) CNT
		FROM WV_SURV_B WSB_T
		<include refid="selectWvSurvBWhere"/>
	</select>
	
	<!-- 사용자 설문 목록조회 건수-->
	<select id="countUserWvSurvB" resultType="Integer" parameterType="WvSurvBVo" >
		/* com.innobiz.orange.web.wv.dao.WvSurvBDao.countUserWvSurvB */
		SELECT COUNT(*) CNT
		FROM(
		
			SELECT
				WSB_T.COMP_ID,
	      		WSB_T.SURV_ID,
			    WSB_T.SURV_SUBJ,
			    WSB_T.SURV_END_DT,
			    WSB_T.REGR_UID,
			    WSB_T.MODR_UID,
			    WSB_T.SURV_PRG_STAT_CD,
			    WSB_T.SURV_START_DT, 
			    WSB_T.QUES_CNT, 
				WSB_T.REG_DT, 
				WSB_T.MOD_DT, 
				WSB_T.OPEN_YN, 
				WSB_T.REPET_SURV_YN,
				(
				 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
				 FROM WV_SURV_REPLY_D
				 WHERE SURV_ID=WSB_T.SURV_ID
				 GROUP BY SURV_ID
				) AS JOIN_USER_CNT,
				(
				 SELECT CASE WHEN COUNT(1) > 0
							THEN 'O'
							ELSE 'X'
						END REPLY_YN
				 FROM WV_SURV_REPLY_D
				 WHERE SURV_ID=WSB_T.SURV_ID
						AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
				
				) AS REPLY_YN,
				(select USER_NM 
				 FROM OR_USER_B 
	      		 WHERE USER_UID = WSB_T.REGR_UID
	      		) REGR_NM,
	      		(
					SELECT RESC_VA
					FROM PT_RESC_D
					WHERE RESC_ID = (
										SELECT RESC_ID
										FROM PT_COMP_B
										WHERE COMP_ID = WSB_T.COMP_ID
									)
					AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
				)COMP_NM
			
			FROM WV_SURV_B WSB_T
			LEFT OUTER JOIN WV_SURV_USE_AUTH_D AS WSUAD_T ON WSB_T.SURV_ID = WSUAD_T.SURV_ID
			<include refid="selectWvSurvBWhere"/>
			
			UNION
		
		SELECT
			WSB_T.COMP_ID,
      		WSB_T.SURV_ID,
		    WSB_T.SURV_SUBJ,
		    WSB_T.SURV_END_DT,
		    WSB_T.REGR_UID,
		    WSB_T.MODR_UID,
		    WSB_T.SURV_PRG_STAT_CD,
		    WSB_T.SURV_START_DT, 
		    WSB_T.QUES_CNT, 
			WSB_T.REG_DT, 
			WSB_T.MOD_DT, 
			WSB_T.OPEN_YN, 
			WSB_T.REPET_SURV_YN, 
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = WSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = WSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM
		
		FROM WV_SURV_B WSB_T
		LEFT OUTER JOIN WV_SURV_USE_AUTH_D AS WSUAD_T ON WSB_T.SURV_ID = WSUAD_T.SURV_ID
		<where>
		    <if test="'survSubj'.equals(schCat) and schWord != null and schWord != ''">
				AND WSB_T.SURV_SUBJ LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			
			<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">
			    AND WSB_T.SURV_ITNT LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			<if test="survSearchList != null">
	   			<![CDATA[ AND SURV_PRG_STAT_CD IN ]]>
	   				 <foreach collection="survSearchList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
	   		AND WSUAD_T.AUTH_TGT_UID IS NULL
		</where>
		
		
		UNION
		
		SELECT
			WSB_T.COMP_ID,
      		WSB_T.SURV_ID,
		    WSB_T.SURV_SUBJ,
		    WSB_T.SURV_END_DT,
		    WSB_T.REGR_UID,
		    WSB_T.MODR_UID,
		    WSB_T.SURV_PRG_STAT_CD,
		    WSB_T.SURV_START_DT, 
		    WSB_T.QUES_CNT, 
			WSB_T.REG_DT, 
			WSB_T.MOD_DT, 
			WSB_T.OPEN_YN, 
			WSB_T.REPET_SURV_YN, 
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = WSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = WSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM
		
		FROM WV_SURV_B WSB_T
		LEFT OUTER JOIN WV_SURV_USE_AUTH_D AS WSUAD_T ON WSB_T.SURV_ID = WSUAD_T.SURV_ID
		<where>
		    <if test="'survSubj'.equals(schCat) and schWord != null and schWord != ''">
				AND WSB_T.SURV_SUBJ LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			
			<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">
			    AND WSB_T.SURV_ITNT LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			<if test="survSearchList != null">
	   			<![CDATA[ AND SURV_PRG_STAT_CD IN ]]>
	   				 <foreach collection="survSearchList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
	   		<if test="logUserUid != null and logUserUid != ''"> AND WSB_T.REGR_UID = #{logUserUid, jdbcType=VARCHAR}</if>
	   		AND WSUAD_T.AUTH_TGT_UID IS NOT NULL
		</where>
		
		
		UNION
		
		SELECT
			WSB_T.COMP_ID,
      		WSB_T.SURV_ID,
		    WSB_T.SURV_SUBJ,
		    WSB_T.SURV_END_DT,
		    WSB_T.REGR_UID,
		    WSB_T.MODR_UID,
		    WSB_T.SURV_PRG_STAT_CD,
		    WSB_T.SURV_START_DT, 
		    WSB_T.QUES_CNT, 
			WSB_T.REG_DT, 
			WSB_T.MOD_DT, 
			WSB_T.OPEN_YN, 
			WSB_T.REPET_SURV_YN, 
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = WSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = WSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM
		
		FROM WV_SURV_B WSB_T
		LEFT OUTER JOIN WV_SURV_USE_AUTH_D AS WSUAD_T ON WSB_T.SURV_ID = WSUAD_T.SURV_ID
		<where>
		    <if test="'survSubj'.equals(schCat) and schWord != null and schWord != ''">
				AND WSB_T.SURV_SUBJ LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			
			<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">
			    AND WSB_T.SURV_ITNT LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			<if test="survSearchList != null">
	   			<![CDATA[ AND SURV_PRG_STAT_CD IN ]]>
	   				 <foreach collection="survSearchList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
	   		<if test="logUserUid != null and logUserUid != ''"> AND WSUAD_T.AUTH_TGT_UID = #{logUserUid, jdbcType=VARCHAR}</if>
	   		AND WSUAD_T.AUTH_TGT_UID IS NOT NULL
		</where>
		
		
		UNION
		
		SELECT
			WSB_T.COMP_ID,
      		WSB_T.SURV_ID,
		    WSB_T.SURV_SUBJ,
		    WSB_T.SURV_END_DT,
		    WSB_T.REGR_UID,
		    WSB_T.MODR_UID,
		    WSB_T.SURV_PRG_STAT_CD,
		    WSB_T.SURV_START_DT, 
		    WSB_T.QUES_CNT, 
			WSB_T.REG_DT, 
			WSB_T.MOD_DT, 
			WSB_T.OPEN_YN, 
			WSB_T.REPET_SURV_YN, 
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = WSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = WSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM
		
		FROM WV_SURV_B WSB_T
		LEFT OUTER JOIN WV_SURV_USE_AUTH_D AS WSUAD_T ON WSB_T.SURV_ID = WSUAD_T.SURV_ID
		<where>
		    <if test="'survSubj'.equals(schCat) and schWord != null and schWord != ''">
				AND WSB_T.SURV_SUBJ LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			
			<if test="'survItnt'.equals(schCat) and schWord != null and schWord != ''">
			    AND WSB_T.SURV_ITNT LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')
			</if>
			<if test="survSearchList != null">
	   			<![CDATA[ AND SURV_PRG_STAT_CD IN ]]>
	   				 <foreach collection="survSearchList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
	   		<if test="logUserDeptId != null and logUserDeptId != ''"> AND WSUAD_T.AUTH_TGT_UID = #{logUserDeptId, jdbcType=VARCHAR}</if>
	   		AND WSUAD_T.AUTH_TGT_UID IS NOT NULL
		</where>
		
		<!-- 
		UNION
		
		SELECT
			WSB_T.COMP_ID,
      		WSB_T.SURV_ID,
		    WSB_T.SURV_SUBJ,
		    WSB_T.SURV_END_DT,
		    WSB_T.REGR_UID,
		    WSB_T.MODR_UID,
		    WSB_T.SURV_PRG_STAT_CD,
		    WSB_T.SURV_START_DT, 
		    WSB_T.QUES_CNT, 
			WSB_T.REG_DT, 
			WSB_T.MOD_DT, 
			WSB_T.OPEN_YN, 
			WSB_T.REPET_SURV_YN, 
			(
			 SELECT COUNT(DISTINCT REPLYR_UID)AS REPLYR_CT
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
			 GROUP BY SURV_ID
			) AS JOIN_USER_CNT,
			(
			 SELECT CASE WHEN COUNT(1) > 0
						THEN 'O'
						ELSE 'X'
					END REPLY_YN
			 FROM WV_SURV_REPLY_D
			 WHERE SURV_ID=WSB_T.SURV_ID
					AND REPLYR_UID= #{logUserUid, jdbcType=VARCHAR}
			
			) AS REPLY_YN,
			(select USER_NM 
			 FROM OR_USER_B 
      		 WHERE USER_UID = WSB_T.REGR_UID
      		) REGR_NM,
      		(
				SELECT RESC_VA
				FROM PT_RESC_D
				WHERE RESC_ID = (
									SELECT RESC_ID
									FROM PT_COMP_B
									WHERE COMP_ID = WSB_T.COMP_ID
								)
				AND LANG_TYP_CD = #{langTyp, jdbcType=VARCHAR}
			)COMP_NM
		
		FROM WV_SURV_B WSB_T
		<where>
			<if test="logUserUid != null and logUserUid != ''"> AND WSB_T.REGR_UID = #{logUserUid, jdbcType=VARCHAR}</if>
			<if test="survPrgStatCd != null and survPrgStatCd != ''"> AND WSB_T.SURV_PRG_STAT_CD = #{survPrgStatCd, jdbcType=CHAR}</if>
		</where> 
		-->
		
		
		)WV_SURV_B
	</select>
	
	<!-- 등록 저장 -->
	<insert id="insertWvSurvB" parameterType="WvSurvBVo" >
		/* com.innobiz.orange.web.wv.dao.WvSurvBDao.insertWvSurvB */
		INSERT INTO WV_SURV_B
		<trim prefix="(" suffix=")" suffixOverrides=",">
			COMP_ID, SURV_ID, SURV_SUBJ, QUES_CNT, SURV_START_DT, SURV_END_DT,
			PLT_ID, REG_DT, MOD_DT, REGR_UID, MODR_UID, SURV_PRG_STAT_CD, OPEN_YN,
			REPET_SURV_YN, SURV_ITNT, SURV_FTR, ATT_YN, ADM_RJT_OPIN_CONT, SURV_FILE_ID,NO_AUTH_YN,

		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides="," >
			#{compId, jdbcType=CHAR},#{survId, jdbcType=VARCHAR},#{survSubj, jdbcType=NVARCHAR},#{quesCnt, jdbcType=NUMERIC},
			STR_TO_DATE(#{survStartDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),STR_TO_DATE(#{survEndDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),#{pltId, jdbcType=VARCHAR},STR_TO_DATE(#{regDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),
			STR_TO_DATE(#{modDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),#{regrUid, jdbcType=VARCHAR},#{modrUid, jdbcType=VARCHAR},#{survPrgStatCd, jdbcType=VARCHAR},
			#{openYn, jdbcType=CHAR},#{repetSurvYn, jdbcType=CHAR},#{survItnt, jdbcType=NVARCHAR},#{survFtr, jdbcType=NVARCHAR},
			#{attYn, jdbcType=CHAR},#{admRjtOpinCont, jdbcType=NVARCHAR},#{survFileId, jdbcType=VARCHAR},#{noAuthYn, jdbcType=CHAR},
		</trim>
	</insert>
	
	<!-- 수정 -->
	<update id="updateWvSurvB" parameterType="WvSurvBVo" >
		/* com.innobiz.orange.web.wv.dao.WvSurvBDao.updateWvSurvB */
		UPDATE WV_SURV_B
		<set>
		    <if test="survSubj != null"> SURV_SUBJ = #{survSubj, jdbcType=NVARCHAR},</if>
			<if test="quesCnt != null"> QUES_CNT = #{quesCnt, jdbcType=NUMERIC},</if>
			<if test="survStartDt != null"> SURV_START_DT = STR_TO_DATE(#{survStartDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			<if test="survEndDt != null"> SURV_END_DT = STR_TO_DATE(#{survEndDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
		    <if test="pltId != null"> PLT_ID = #{pltId, jdbcType=VARCHAR},</if>
			<if test="regDt != null"> REG_DT = STR_TO_DATE(#{regDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			<if test="modDt != null"> MOD_DT = STR_TO_DATE(#{modDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			<if test="regrUid != null"> REGR_UID = #{regrUid, jdbcType=VARCHAR},</if>
		    <if test="modrUid != null"> MODR_UID = #{modrUid, jdbcType=VARCHAR},</if>
		    <if test="survPrgStatCd != null"> SURV_PRG_STAT_CD = #{survPrgStatCd, jdbcType=VARCHAR},</if>
			<if test="openYn != null"> OPEN_YN = #{openYn, jdbcType=CHAR},</if>
			<if test="repetSurvYn != null"> REPET_SURV_YN = #{repetSurvYn, jdbcType=CHAR},</if>
			<if test="survItnt != null"> SURV_ITNT = #{survItnt, jdbcType=NVARCHAR},</if>
			<if test="survFtr != null"> SURV_FTR = #{survFtr, jdbcType=NVARCHAR},</if>
			<if test="attYn != null"> ATT_YN = #{attYn, jdbcType=CHAR},</if>
			<if test="admRjtOpinCont != null"> ADM_RJT_OPIN_CONT = #{admRjtOpinCont, jdbcType=NVARCHAR},</if>
			<if test="survFileId != null"> SURV_FILE_ID = #{survFileId, jdbcType=VARCHAR},</if>
			<if test="noAuthYn != null"> NO_AUTH_YN = #{noAuthYn, jdbcType=CHAR},</if>
			
		</set>
		<where>
			<if test="compId != null and compId != ''"> AND COMP_ID = #{compId, jdbcType=CHAR}</if>
			<if test="survId != null and survId != ''"> AND SURV_ID = #{survId, jdbcType=VARCHAR}</if>
		</where>
	</update>

	<!-- 삭제 -->
	<delete id="deleteWvSurvB" parameterType="WvSurvBVo" >
		/* com.innobiz.orange.web.wv.dao.WvSurvBDao.deleteWvSurvB */
		DELETE FROM WV_SURV_B
		<where>
			<if test="compId != null and compId != ''"> AND COMP_ID = #{compId, jdbcType=CHAR}</if>
			<if test="survId != null and survId != ''"> AND SURV_ID = #{survId, jdbcType=VARCHAR}</if>
		</where>
	</delete>
	
	<!-- 목록조회 -->
	<select id="selectPopupWvSurvB" resultType="java.lang.String" parameterType="WvSurvBVo" >
		/* com.innobiz.orange.web.wv.dao.WvSurvBDao.selectPopupWvSurvB */
		SELECT T.SURV_ID
		FROM WV_SURV_B T
		<where>
			<if test="compId != null and compId != ''"> AND T.COMP_ID = #{compId, jdbcType=CHAR}</if>
			<if test="survId != null and survId != ''"> AND T.SURV_ID = #{survId, jdbcType=VARCHAR}</if>
			<if test="'fromYmd'.equals(durCat) and durStrtDt != null and durStrtDt != '' and durEndDt != null and durEndDt != ''">
				<![CDATA[
				AND T.SURV_START_DT <= STR_TO_DATE(#{durEndDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s')
				AND T.SURV_END_DT >= STR_TO_DATE(#{durStrtDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s')
				]]>
			</if>
			<if test="survSearchList != null">
	   			AND T.SURV_PRG_STAT_CD IN
	   				 <foreach collection="survSearchList" item="item" index="index" separator="," open="(" close=")">
			            	#{item, jdbcType=VARCHAR}
			        </foreach>	   			
	   		</if>
	   		<!-- 설문대상 조회 조건 : 비조회여부가 'Y' 거나 '부서 및 사용자가 지정되어 있는 설문 조회' -->
	   		<if test='logUserUid != null and schOrgPids != null and logUserDeptId != null'>
				AND ( 
					T.NO_AUTH_YN = 'Y' 
					OR (
						T.NO_AUTH_YN = 'N'
			        	AND T.SURV_ID IN (
				        	SELECT SURV_ID FROM WV_SURV_USE_AUTH_D
				        	WHERE ( AUTH_TGT_TYP_CD='U' AND AUTH_TGT_UID = #{logUserUid, jdbcType=VARCHAR} )
				        	OR (AUTH_TGT_TYP_CD='D' AND AUTH_INCL_YN = 'N' AND AUTH_TGT_UID = #{logUserDeptId, jdbcType=VARCHAR})
				        	OR (AUTH_TGT_TYP_CD='D' AND AUTH_INCL_YN = 'Y' AND AUTH_TGT_UID IN <foreach item="item" collection="schOrgPids" open="(" separator="," close=")">#{item, jdbcType=VARCHAR}</foreach>)
				        	AND AUTH_GRAD_CD = 'W'
				        )
				    )
				)
			</if>
		</where>
	</select>

</mapper>