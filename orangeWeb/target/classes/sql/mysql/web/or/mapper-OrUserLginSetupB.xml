<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- TABLE : OR_USER_LGIN_SETUP_B[사용자기본] -->
<mapper namespace="com.innobiz.orange.web.or.dao.OrUserLginSetupBDao">

	<resultMap id="orUserLginSetupBMap" type="OrUserLginSetupBVo">
		<id property="compId" column="USER_UID" /><!-- 회사ID -->
		<result property="repetTypCd" column="REPET_TYP_CD" /><!-- 반복구분코드 -->
		<result property="strtYmd" column="STRT_YMD" /><!-- 시작년월일 -->
		<result property="regDt" column="REG_DT" /><!-- 등록일시 -->
		<result property="nextRepetYmd" column="NEXT_REPET_YMD" /><!-- 다음반복연월일 -->
		<result property="useYn" column="USE_YN" /><!-- 사용여부 -->
		<result property="delYn" column="DEL_YN" /><!-- 삭제여부 -->
	</resultMap>

	<sql id="selectOrUserLginSetupBWhere">
		<where>
			<if test="compId != null and compId != ''"> AND T.COMP_ID = #{compId, jdbcType=VARCHAR}</if>
			<if test="useYn != null and useYn != ''"> AND T.USE_YN = #{useYn, jdbcType=VARCHAR}</if>
			<if test="delYn != null and delYn != ''"> AND T.DEL_YN = #{delYn, jdbcType=VARCHAR}</if>
			<if test="durCat != null and durCat != '' and 'today'.equals(durCat)"> AND DATE_FORMAT(NEXT_REPET_YMD, '%Y-%m-%d') = #{schWord, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</sql>

	<select id="selectOrUserLginSetupB" resultMap="orUserLginSetupBMap" parameterType="OrUserLginSetupBVo" >
		/* com.innobiz.orange.web.or.dao.OrUserLginSetupBDao.selectOrUserLginSetupB */
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			COMP_ID, REPET_TYP_CD, DATE_FORMAT(STRT_YMD, '%Y-%m-%d') AS STRT_YMD, REG_DT, DATE_FORMAT(NEXT_REPET_YMD, '%Y-%m-%d') AS NEXT_REPET_YMD, USE_YN, DEL_YN,
		</trim>
		FROM OR_USER_LGIN_SETUP_B T
		<include refid="selectOrUserLginSetupBWhere"/>
		<if test="orderBy != null">ORDER BY ${orderBy}</if>
		<if test="orderBy == null">ORDER BY REG_DT DESC</if>
		<if test="pageNo != null and pageRowCnt != null">
		LIMIT #{pageStrt, jdbcType=NUMERIC}, #{pageRowCnt, jdbcType=NUMERIC}
		</if>
	</select>

	<select id="countOrUserLginSetupB" resultType="Integer" parameterType="OrUserLginSetupBVo" >
		/* com.innobiz.orange.web.or.dao.OrUserLginSetupBDao.countOrUserLginSetupB */
		SELECT COUNT(*) CNT
		FROM OR_USER_LGIN_SETUP_B
		<include refid="selectOrUserLginSetupBWhere"/>
	</select>

	<insert id="insertOrUserLginSetupB" parameterType="OrUserLginSetupBVo" >
		/* com.innobiz.orange.web.or.dao.OrUserLginSetupBDao.insertOrUserLginSetupB */
		INSERT INTO OR_USER_LGIN_SETUP_B
		<trim prefix="(" suffix=")" suffixOverrides=",">
			COMP_ID,
			REPET_TYP_CD,
			STRT_YMD,
			REGR_UID,
			REG_DT,
			NEXT_REPET_YMD,
			USE_YN,
			DEL_YN,
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides="," >
			#{compId, jdbcType=VARCHAR},
			#{repetTypCd, jdbcType=VARCHAR},
			STR_TO_DATE(#{strtYmd, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),
			#{regrUid, jdbcType=VARCHAR},
			NOW(),
			STR_TO_DATE(#{nextRepetYmd, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),
			#{useYn, jdbcType=VARCHAR},
			#{delYn, jdbcType=VARCHAR},
		</trim>
	</insert>

	<update id="updateOrUserLginSetupB" parameterType="OrUserLginSetupBVo" >
		/* com.innobiz.orange.web.or.dao.OrUserLginSetupBDao.updateOrUserLginSetupB */
		UPDATE OR_USER_LGIN_SETUP_B
		<set>
			<if test="repetTypCd != null"> REPET_TYP_CD = #{repetTypCd, jdbcType=VARCHAR},</if>
			<if test="strtYmd != null"> STRT_YMD = STR_TO_DATE(#{strtYmd, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			<if test="useYn != null"> USE_YN = #{useYn, jdbcType=VARCHAR},</if>
			<if test="nextRepetYmd != null">
				<if test="!''.equals(nextRepetYmd)">NEXT_REPET_YMD = STR_TO_DATE(#{nextRepetYmd, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if> 
				<if test="''.equals(nextRepetYmd)">NEXT_REPET_YMD = NULL,</if>
			</if>
			<if test="delYn != null"> DEL_YN = #{delYn, jdbcType=VARCHAR},</if>
			<if test="regrUid != null"> REGR_UID = #{regrUid, jdbcType=VARCHAR}, REG_DT = NOW(),</if>
		</set>
		<where>
			<if test="compId != null and compId != ''"> AND COMP_ID = #{compId, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</update>

	<delete id="deleteOrUserLginSetupB" parameterType="OrUserLginSetupBVo" >
		/* com.innobiz.orange.web.or.dao.OrUserLginSetupBDao.deleteOrUserLginSetupB */
		DELETE FROM OR_USER_LGIN_SETUP_B
		<where>
			<if test="compId != null"> AND COMP_ID = #{compId, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</delete>

</mapper>