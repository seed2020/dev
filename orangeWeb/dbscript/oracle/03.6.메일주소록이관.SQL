/****** Object:  Table EM_MAIL_ADR_TRAN_TGT_T    Script Date: 2017/03/20 15:08 ******/
CREATE TABLE EM_MAIL_ADR_TRAN_TGT_T(
TRAN_ID VARCHAR2(30) NOT NULL,
SEQ NUMBER NOT NULL,
USER_UID VARCHAR2(30) NOT NULL,
USER_SN VARCHAR2(30) NOT NULL,
FLD_CNT NUMBER,
ADR_CNT NUMBER,
ERR_YN CHAR(1)
)
TABLESPACE TS_GW_WK
STORAGE (INITIAL 1M NEXT 1M MAXEXTENTS UNLIMITED)
LOGGING
NOPARALLEL;

CREATE UNIQUE INDEX PK_EM_MAIL_ADR_TRAN_TGT_T ON EM_MAIL_ADR_TRAN_TGT_T
(
TRAN_ID ASC,
SEQ ASC
)
TABLESPACE TS_GW_WK
LOGGING
NOPARALLEL;

ALTER TABLE EM_MAIL_ADR_TRAN_TGT_T ADD
(CONSTRAINT PK_EM_MAIL_ADR_TRAN_TGT_T PRIMARY KEY (TRAN_ID, SEQ));

COMMENT ON COLUMN EM_MAIL_ADR_TRAN_TGT_T.TRAN_ID IS '이관ID';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_TGT_T.SEQ IS '순번';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_TGT_T.USER_UID IS '사용자UID';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_TGT_T.USER_SN IS '사용자번호';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_TGT_T.FLD_CNT IS '폴더건수';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_TGT_T.ADR_CNT IS '주소록건수';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_TGT_T.ERR_YN IS '오류여부';
COMMENT ON TABLE EM_MAIL_ADR_TRAN_TGT_T IS '이관대상임시';


/****** Object:  Table EM_MAIL_ADR_TRAN_B    Script Date: 2017/03/20 15:08 ******/
CREATE TABLE EM_MAIL_ADR_TRAN_B(
TRAN_ID VARCHAR2(30) NOT NULL,
USER_CNT NUMBER,
FLD_CNT NUMBER,
ADR_CNT NUMBER,
TRAN_STRT_DT DATE,
TRAN_END_DT DATE,
TRAN_PROC_STAT_CD VARCHAR2(30),
TRAN_CONT VARCHAR2(1000),
ERR_CONT VARCHAR2(1000),
USER_UID VARCHAR2(30)
)
TABLESPACE TS_GW_WK
STORAGE (INITIAL 1M NEXT 1M MAXEXTENTS UNLIMITED)
LOGGING
NOPARALLEL;

CREATE UNIQUE INDEX PK_EM_MAIL_ADR_TRAN_B ON EM_MAIL_ADR_TRAN_B
(
TRAN_ID ASC
)
TABLESPACE TS_GW_WK
LOGGING
NOPARALLEL;

ALTER TABLE EM_MAIL_ADR_TRAN_B ADD
(CONSTRAINT PK_EM_MAIL_ADR_TRAN_B PRIMARY KEY (TRAN_ID));

COMMENT ON COLUMN EM_MAIL_ADR_TRAN_B.TRAN_ID IS '이관ID';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_B.USER_CNT IS '사용자수';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_B.FLD_CNT IS '폴더건수';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_B.ADR_CNT IS '주소록건수';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_B.TRAN_STRT_DT IS '이관시작일시';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_B.TRAN_END_DT IS '이관종료일시';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_B.TRAN_PROC_STAT_CD IS '이관진행상태코드';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_B.TRAN_CONT IS '이관내용';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_B.ERR_CONT IS '오류내용';
COMMENT ON COLUMN EM_MAIL_ADR_TRAN_B.USER_UID IS '사용자UID';
COMMENT ON TABLE EM_MAIL_ADR_TRAN_B IS '메일주소록이관';


-- 초기 데이터
CREATE SEQUENCE SQ_EM_MAIL_ADR_TRAN_B START WITH 1 INCREMENT BY 1 NOCACHE;



/*
-- 폴더에 속한 명함 조회
SELECT BC_ID
FROM WB_BC_B
WHERE FLD_ID IN(SELECT BC_FLD_ID
FROM WB_BC_FLD_B
CONNECT BY PRIOR BC_FLD_ID = ABV_FLD_ID
START WITH FLD_NM LIKE '20170320162441%' -- 이관ID
)

--연락처 삭제
DELETE FROM WB_BC_CNTC_D
WHERE BC_ID IN(
SELECT BC_ID
FROM WB_BC_B
WHERE FLD_ID IN(SELECT BC_FLD_ID
FROM WB_BC_FLD_B
CONNECT BY PRIOR BC_FLD_ID = ABV_FLD_ID
START WITH FLD_NM LIKE '20170320162441%')
)

-- 명함삭제
DELETE FROM WB_BC_B
WHERE FLD_ID IN(SELECT BC_FLD_ID
FROM WB_BC_FLD_B
CONNECT BY PRIOR BC_FLD_ID = ABV_FLD_ID
START WITH FLD_NM LIKE '20170320162441%')

-- 폴더삭제
DELETE FROM WB_BC_FLD_B
WHERE BC_FLD_ID IN(SELECT BC_FLD_ID
FROM WB_BC_FLD_B
CONNECT BY PRIOR BC_FLD_ID = ABV_FLD_ID
START WITH FLD_NM LIKE '20170320162441%')

COMMIT;
*/

