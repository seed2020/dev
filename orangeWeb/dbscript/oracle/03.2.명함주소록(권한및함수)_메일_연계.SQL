
--      GW_AD8227_USER 를 고객 그룹웨어 DB 사용자 계정으로 변경해서 실행할것
--      [메일계정] 를 메일 DB 사용자 계정으로 변경해서 실행할것

--------------------------------- 생성 --------------------------------------------

-- >> 1. 사용자 VIEW 권한 부여(그룹웨어 계정) - SYSTEM
GRANT CREATE VIEW TO GW_AD8227_USER;

-- >> 2.ID 치환함수 생성(아래) - 그룹웨어

-- 오라클 ID 치환 함수 - 그룹웨어계정
CREATE OR REPLACE FUNCTION GW_AD8227_USER.FN_TOINT(ID IN VARCHAR2)
 RETURN NUMBER
AS
 v_sum NUMBER := 0;
 v_len NUMBER;
 v_ascii NUMBER;
 v_power NUMBER := 1;
BEGIN
 
 if ID is not null then
 
 v_len := length(ID);
  
 for i in 1 .. v_len-1 loop
  v_ascii := ascii(substr(ID, v_len-i+1,1));
  IF v_ascii >= 97 THEN
   v_ascii := v_ascii - 87;
  ELSIF v_ascii >= 65 THEN
   v_ascii := v_ascii - 55;
  ELSIF v_ascii >= 48 THEN
   v_ascii := v_ascii - 48;
  ELSE
   v_ascii := 0;
  END IF;
  
  v_sum := v_sum + (v_ascii * v_power);
  v_power := v_power * 36;
  
 end loop;
 
 end if;
 
 RETURN v_sum;
END;

-- 함수 실행 권한부여 - SYSTEM
GRANT EXECUTE ON GW_AD8227_USER.FN_TOINT TO [메일계정];

-- SYNONYM 생성 - SYSTEM
CREATE SYNONYM [메일계정].FN_TOINT FOR GW_AD8227_USER.FN_TOINT;

-- 권한 회수 - SYSTEM
-- REVOKE EXECUTE ON GW_AD8227_USER.FN_TOINT FROM [메일계정];

-- 함수 삭제 - 그룹웨어
--DROP FUNCTION FN_TOINT;

-- >> 2.그룹웨어 계정 접속해서 VIEW 생성- 그룹웨어(첨부파일 참조) : 03.3개인, 03.4공용





-- >> 4. 뷰 SELECT 권한 부여(메일 계정) - SYSTEM
--개인
GRANT SELECT ON GW_AD8227_USER.ZT_ADDRESS_GROUP TO [메일계정];
GRANT SELECT ON GW_AD8227_USER.ZT_ADDRESS_PERSON TO [메일계정];
GRANT SELECT ON GW_AD8227_USER.ZT_GROUP_PERSON TO [메일계정];
--공용
GRANT SELECT ON GW_AD8227_USER.ZT_C_ADDRESS_GROUP TO [메일계정];
GRANT SELECT ON GW_AD8227_USER.ZT_C_ADDRESS_PERSON TO [메일계정];
GRANT SELECT ON GW_AD8227_USER.ZT_C_GROUP_PERSON TO [메일계정];


--5. SYNONYM 생성 - SYSTEM
--개인
CREATE SYNONYM [메일계정].ZT_ADDRESS_GROUP FOR GW_AD8227_USER.ZT_ADDRESS_GROUP;
CREATE SYNONYM [메일계정].ZT_ADDRESS_PERSON FOR GW_AD8227_USER.ZT_ADDRESS_PERSON;
CREATE SYNONYM [메일계정].ZT_GROUP_PERSON FOR GW_AD8227_USER.ZT_GROUP_PERSON;
--공용
CREATE SYNONYM [메일계정].ZT_C_ADDRESS_GROUP FOR GW_AD8227_USER.ZT_C_ADDRESS_GROUP;
CREATE SYNONYM [메일계정].ZT_C_ADDRESS_PERSON FOR GW_AD8227_USER.ZT_C_ADDRESS_PERSON;
CREATE SYNONYM [메일계정].ZT_C_GROUP_PERSON FOR GW_AD8227_USER.ZT_C_GROUP_PERSON;


--------------------------------- 삭제 --------------------------------------------

-- SYNONYM 삭제 - SYSTEM
--개인
--DROP SYNONYM [메일계정].ZT_ADDRESS_GROUP;
--DROP SYNONYM [메일계정].ZT_ADDRESS_PERSON;
--DROP SYNONYM [메일계정].ZT_GROUP_PERSON;
--공용
--DROP SYNONYM [메일계정].ZT_C_ADDRESS_GROUP;
--DROP SYNONYM [메일계정].ZT_C_ADDRESS_PERSON;
--DROP SYNONYM [메일계정].ZT_C_GROUP_PERSON;

-- 권한 회수 - SYSTEM
-- REVOKE SELECT ON GW_AD8227_USER.ZT_ADDRESS_GROUP FROM [메일계정];
-- REVOKE SELECT ON GW_AD8227_USER.ZT_ADDRESS_PERSON FROM [메일계정];
-- REVOKE SELECT ON GW_AD8227_USER.ZT_GROUP_PERSON FROM [메일계정];
-- REVOKE SELECT ON GW_AD8227_USER.ZT_C_ADDRESS_GROUP FROM [메일계정];
-- REVOKE SELECT ON GW_AD8227_USER.ZT_C_ADDRESS_PERSON FROM [메일계정];
-- REVOKE SELECT ON GW_AD8227_USER.ZT_C_GROUP_PERSON FROM [메일계정];

-- VIEW 삭제 - 그룹웨어
-- DROP VIEW ZT_ADDRESS_GROUP;
-- DROP VIEW ZT_ADDRESS_PERSON;
-- DROP VIEW ZT_GROUP_PERSON;
-- DROP VIEW ZT_C_ADDRESS_GROUP;
-- DROP VIEW ZT_C_ADDRESS_PERSON;
-- DROP VIEW ZT_C_GROUP_PERSON;

-- 권한회수 - SYSTEM
-- REVOKE CREATE VIEW FROM GW_AD8227_USER;



-- 기존 테이블명 변경
-- ALTER TABLE ZT_ADDRESS_GROUP RENAME TO ZT_ADDRESS_GROUP_TEMP;
-- ALTER TABLE ZT_ADDRESS_PERSON RENAME TO ZT_ADDRESS_PERSON_TEMP;
-- ALTER TABLE ZT_GROUP_PERSON RENAME TO ZT_GROUP_PERSON_TEMP;
-- ALTER TABLE ZT_C_ADDRESS_GROUP RENAME TO ZT_C_ADDRESS_GROUP_TEMP;
-- ALTER TABLE ZT_C_ADDRESS_PERSON RENAME TO ZT_C_ADDRESS_PERSON_TEMP;
-- ALTER TABLE ZT_C_GROUP_PERSON RENAME TO ZT_C_GROUP_PERSON_TEMP;