
-- 주의 : 사이트 사용자 계정(GW_[고객코드]_USER) 로 실행 할 것.

CREATE OR REPLACE PROCEDURE SP_AP_DOC_SEQ
(
	IN_YY			IN	AP_DOC_NO_D.YY%TYPE,
	IN_REC_LST_ID	IN	AP_DOC_NO_D.REC_LST_ID%TYPE,
	IN_ORG_ID		IN	AP_DOC_NO_D.ORG_ID%TYPE,
	IN_ORG_RESC_ID	IN	AP_DOC_NO_D.ORG_RESC_ID%TYPE,
	OUT_DOC_SEQ		OUT	NUMBER
)
AS
BEGIN
	
	UPDATE AP_DOC_NO_D SET DOC_SEQ = DOC_SEQ + 1 WHERE YY = IN_YY AND REC_LST_ID = IN_REC_LST_ID AND ORG_ID = IN_ORG_ID;
	SELECT DOC_SEQ INTO OUT_DOC_SEQ FROM AP_DOC_NO_D WHERE YY = IN_YY AND REC_LST_ID = IN_REC_LST_ID AND ORG_ID = IN_ORG_ID;
	COMMIT;
	
EXCEPTION WHEN NO_DATA_FOUND THEN

  INSERT INTO AP_DOC_NO_D VALUES ( IN_YY, IN_REC_LST_ID, IN_ORG_ID, IN_ORG_RESC_ID, 0 );
  COMMIT;
  OUT_DOC_SEQ := 0;
	
END;


-- 문서관리 > 문서번호
CREATE OR REPLACE PROCEDURE SP_DM_DOC_SEQ
(
    IN_STOR_ID    IN    DM_DOC_NO_D.STOR_ID%TYPE,
    IN_YY            IN    DM_DOC_NO_D.YY%TYPE,    
    IN_ORG_ID        IN    DM_DOC_NO_D.ORG_ID%TYPE,    
    OUT_DOC_SEQ        OUT    NUMBER
)
AS
BEGIN
    
    UPDATE DM_DOC_NO_D SET DOC_SEQ = DOC_SEQ + 1 WHERE STOR_ID = IN_STOR_ID AND YY = IN_YY AND ORG_ID = IN_ORG_ID;
    SELECT DOC_SEQ INTO OUT_DOC_SEQ FROM DM_DOC_NO_D WHERE STOR_ID = IN_STOR_ID AND YY = IN_YY AND ORG_ID = IN_ORG_ID;
    COMMIT;
    
EXCEPTION WHEN NO_DATA_FOUND THEN

  INSERT INTO DM_DOC_NO_D VALUES ( IN_STOR_ID, IN_YY, IN_ORG_ID, 0 );
  COMMIT;
  OUT_DOC_SEQ := 0;
    
END;


-- 헬프데스크 > 문서번호
CREATE OR REPLACE PROCEDURE SP_WH_DOC_SEQ
(
    IN_YY            IN    WH_DOC_NO_D.YY%TYPE,    
    IN_ORG_ID        IN    WH_DOC_NO_D.ORG_ID%TYPE,    
    OUT_DOC_SEQ        OUT    NUMBER
)
AS
BEGIN
    
    UPDATE WH_DOC_NO_D SET DOC_SEQ = DOC_SEQ + 1 WHERE YY = IN_YY AND ORG_ID = IN_ORG_ID;
    SELECT DOC_SEQ INTO OUT_DOC_SEQ FROM WH_DOC_NO_D WHERE YY = IN_YY AND ORG_ID = IN_ORG_ID;
    COMMIT;
    
EXCEPTION WHEN NO_DATA_FOUND THEN

  INSERT INTO WH_DOC_NO_D VALUES ( IN_YY, IN_ORG_ID, 0 );
  COMMIT;
  OUT_DOC_SEQ := 0;
    
END;
