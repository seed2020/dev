
--      GW_AD8227_USER 를 고객 그룹웨어 DB 사용자 계정으로 변경해서 실행할것

-- 개인주소록(그룹)
CREATE OR REPLACE VIEW ZT_ADDRESS_GROUP (
    GROUP_SN,
    USER_SN,
    UPPER_GROUP_SN,
    GROUP_PATH,
    LEVELS,
    GROUP_RANK,
    ISLEAF,
    GROUP_NAME,
    SORT_CODE,
    COMMENTS
    )
AS SELECT TO_NUMBER(FN_TOINT(USER_UID)||'1'),
          USER_UID,
          0,
          NULL,
          0,
          0,
          0,
          '전체',
          0,
          NULL
FROM(   
    SELECT USER_UID
    FROM OR_USER_B
    WHERE USER_STAT_CD IN('02','03','04')
)  
UNION
SELECT TO_NUMBER(FN_TOINT(USER_UID)||'2'),
          USER_UID,
          TO_NUMBER(FN_TOINT(USER_UID)||'1'),
          NULL,
          1,
          1,
          1,
          '미분류',
          0,
          NULL
FROM(   
    SELECT USER_UID
    FROM OR_USER_B
    WHERE USER_STAT_CD IN('02','03','04')
)
UNION
SELECT 
  FN_TOINT(BC_FLD_ID),
      REGR_UID,
  DECODE(ABV_FLD_ID,'ROOT',TO_NUMBER(FN_TOINT(REGR_UID)||'1'),FN_TOINT(ABV_FLD_ID)),
      NULL,
      1,
      2,
      1,
      FLD_NM,
      NVL(SORT_ORDR,1),
      NULL
FROM GW_AD8227_USER.WB_BC_FLD_B;


/* CREATE OR REPLACE VIEW ZT_ADDRESS_GROUP (
    GROUP_SN,
    USER_SN,
    UPPER_GROUP_SN,
    GROUP_PATH,
    LEVELS,
    GROUP_RANK,
    ISLEAF,
    GROUP_NAME,
    SORT_CODE,
    COMMENTS
    )
AS SELECT TO_NUMBER(FN_TOINT(REGR_UID)||'1'),
          REGR_UID,
          0,
          NULL,
          0,
          0,
          0,
          '전체',
          0,
          NULL
FROM(   
    SELECT NVL(T.REGR_UID,B.REGR_UID) AS REGR_UID
    FROM GW_AD8227_USER.WB_BC_FLD_B T RIGHT OUTER JOIN GW_AD8227_USER.WB_BC_B B ON T.REGR_UID = B.REGR_UID 
    GROUP BY NVL(T.REGR_UID,B.REGR_UID)
)  
UNION
SELECT TO_NUMBER(FN_TOINT(REGR_UID)||'2'),
          REGR_UID,
          TO_NUMBER(FN_TOINT(REGR_UID)||'1'),
          NULL,
          1,
          1,
          1,
          '미분류',
          0,
          NULL
FROM(   
    SELECT NVL(T.REGR_UID,B.REGR_UID) AS REGR_UID
    FROM GW_AD8227_USER.WB_BC_FLD_B T RIGHT OUTER JOIN GW_AD8227_USER.WB_BC_B B ON T.REGR_UID = B.REGR_UID 
    GROUP BY NVL(T.REGR_UID,B.REGR_UID)
)
UNION
SELECT 
      FN_TOINT(BC_FLD_ID),
          REGR_UID,
      DECODE(ABV_FLD_ID,'ROOT',TO_NUMBER(FN_TOINT(REGR_UID)||'1'),FN_TOINT(ABV_FLD_ID)),
          NULL,
          1,
          2,
          1,
          FLD_NM,
          SORT_ORDR,
          NULL
   FROM GW_AD8227_USER.WB_BC_FLD_B; */


-- 개인주소록(사용자)
CREATE OR REPLACE VIEW ZT_ADDRESS_PERSON( 
    PERSON_SN,
    GROUP_SN,
    USER_SN,
    CREATE_USER_SN,
    PERSON_NAME,
    SORT_CODE,
    ENG_NAME,
    HANJA_NAME,
    NICKNAME,
    EMAIL,
    MOBILE,
    GENDER_CODE,
    BIRTHDAY,
    BIRTHDAY_TYPE,
    ANNIVERSARY,
    HOME_ZIPCODE,
    HOME_ADDRESS1,
    HOME_ADDRESS2,
    HOME_PHONE,
    HOMEPAGE,
    COMPANY_CODE,
    ORGAN_NAME,
    DEPT_NAME,
    ROLE_NAME,
    POSITION_NAME,
    OFFICE_ZIPCODE,
    OFFICE_ADDRESS1,
    OFFICE_ADDRESS2,
    OFFICE_PHONE,
    OFFICE_LOCAL_PHONE,
    OFFICE_D_PHONE,
    OFFICE_FAX,
    PICTURE_FNAME,
    WORKS,
    COMMENTS
)
AS 
SELECT FN_TOINT(T.BC_ID),
	DECODE(T.FLD_ID,'NONE',TO_NUMBER(FN_TOINT(T.REGR_UID)||'2'),FN_TOINT(T.FLD_ID)) AS FLD_ID,
    T.REGR_UID,
    T.REGR_UID,
    T.BC_NM,
    0,
    T.BC_EN_NM,
    NULL,
    NULL,
    ( SELECT CNTC_CONT FROM GW_AD8227_USER.WB_BC_CNTC_D C WHERE C.BC_ID = T.BC_ID AND C.CNTC_CLS_CD = 'EMAIL' AND CNTC_TYP_CD = 'email' AND C.BC_CNTC_SEQ = 1 ) AS EMAIL,
    ( SELECT CNTC_CONT FROM GW_AD8227_USER.WB_BC_CNTC_D C WHERE C.BC_ID = T.BC_ID AND C.CNTC_CLS_CD = 'CNTC' AND CNTC_TYP_CD = 'mbno' AND C.BC_CNTC_SEQ = 1 ) AS MBNO,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL,
    NULL
FROM GW_AD8227_USER.WB_BC_B T INNER JOIN GW_AD8227_USER.OR_USER_B O ON T.REGR_UID = O.USER_UID AND O.USER_STAT_CD IN('02','03','04')
												   INNER JOIN GW_AD8227_USER.WB_BC_CNTC_D C ON C.BC_ID = T.BC_ID AND C.CNTC_CLS_CD = 'EMAIL' AND CNTC_TYP_CD = 'email' AND C.BC_CNTC_SEQ = 1;



-- 개인주소록(명함그룹 매핑)
CREATE OR REPLACE VIEW ZT_GROUP_PERSON (
    GROUP_SN,
    PERSON_SN
    ) AS 
SELECT DECODE(B.FLD_ID,'NONE',TO_NUMBER(FN_TOINT(B.REGR_UID)||'2'),FN_TOINT(B.FLD_ID)) AS FLD_ID, FN_TOINT(B.BC_ID)
FROM GW_AD8227_USER.WB_BC_B B INNER JOIN GW_AD8227_USER.OR_USER_B O ON B.REGR_UID = O.USER_UID AND O.USER_STAT_CD IN('02','03','04')
												   INNER JOIN GW_AD8227_USER.WB_BC_CNTC_D C ON C.BC_ID = B.BC_ID AND C.CNTC_CLS_CD = 'EMAIL' AND CNTC_TYP_CD = 'email' AND C.BC_CNTC_SEQ = 1;


--FROM GW_AD8227_USER.WB_BC_FLD_B T RIGHT OUTER JOIN GW_AD8227_USER.WB_BC_B B ON T.BC_FLD_ID = B.FLD_ID;

