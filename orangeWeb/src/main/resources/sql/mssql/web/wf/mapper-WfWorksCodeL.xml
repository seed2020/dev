<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- TABLE : WFG_${formId}_WORKS_CODE_L[업무코드목록] -->
<mapper namespace="com.innobiz.orange.web.wf.dao.WfWorksCodeLDao">

	<resultMap id="wfWorksCodeLMap" type="WfWorksCodeLVo">
		<id property="workNo" column="WORK_NO" /><!-- 업무번호 -->
		<id property="typCd" column="TYP_CD" /><!-- 구분코드 -->
		<id property="colmNm" column="COLM_NM" /><!-- 컬럼명 -->
		<id property="cdVa" column="CD_VA" /><!-- 코드값 -->
		<result property="sortOrdr" column="SORT_ORDR" /><!-- 정렬순서 -->		
		<result property="cdNm" column="CD_NM" /><!-- 코드명 -->
	</resultMap>
	
	<!-- 조회조건 -->
	<sql id="selectWfWorksCodeLWhere">
		<where>
			<if test="workNo != null and workNo !=''"> AND T.WORK_NO = #{workNo, jdbcType=VARCHAR}</if>
			<if test="typCd != null and typCd !=''"> AND T.TYP_CD = #{typCd, jdbcType=VARCHAR}</if>
			<if test="cdVaList != null"> AND T.CD_VA IN ( <foreach collection="cdVaList" item="item" index="index" separator=",">#{item, jdbcType=VARCHAR}</foreach>)</if>
			<if test="colmNm != null and colmNm !=''"> AND T.COLM_NM = #{colmNm, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</sql>
	
	<!-- 목록조회 -->
	<select id="selectWfWorksCodeL" resultMap="wfWorksCodeLMap" parameterType="WfWorksCodeLVo" >
		/* com.innobiz.orange.web.wf.dao.WfWorksCodeLDao.selectWfWorksCodeL */
		<if test="pageNo != null and pageRowCnt != null">
		SELECT * FROM (
		</if>
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="pageNo != null and pageRowCnt != null">
			TOP (#{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}) ROW_NUMBER() OVER (ORDER BY <if test="orderBy != null">${orderBy}</if><if test="orderBy == null">N.COLM_NM ASC, N.SORT_ORDR ASC</if>) AS RNUM, N.* FROM (SELECT
			</if>
			T.WORK_NO,
			T.TYP_CD,			
			T.COLM_NM,
			T.CD_VA,
			T.SORT_ORDR,
			CASE WHEN T.TYP_CD = 'USER' THEN (SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_USER_B WHERE USER_UID = T.CD_VA) AND LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')) 
					WHEN T.TYP_CD = 'DEPT' THEN (SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_ORG_B WHERE ORG_ID = T.CD_VA) AND LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR}, 'ko'))
					WHEN T.TYP_CD = 'CHECK' OR T.TYP_CD = 'SELECT' OR T.TYP_CD = 'RADIO' THEN (SELECT RESC_VA FROM WF_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM WF_CD_D WHERE CD_ID = T.CD_VA) AND LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR}, 'ko'))
			ELSE NULL END CD_NM 
		</trim>
		FROM WFG_${formId}_WORKS_CODE_L T
		<include refid="selectWfWorksCodeLWhere"/>
		<if test="pageNo == null or pageRowCnt == null">
			<if test="orderBy != null">ORDER BY ${orderBy}</if>
			<if test="orderBy == null">ORDER BY T.COLM_NM ASC, T.SORT_ORDR ASC</if>
		</if>
		<if test="pageNo != null and pageRowCnt != null">
		<![CDATA[) N ) M WHERE RNUM > (#{pageNo, jdbcType=NUMERIC} - 1) * #{pageRowCnt, jdbcType=NUMERIC} AND RNUM <= #{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}]]>
		</if>
	</select>
	
	<!-- 목록조회 건수-->
	<select id="countWfWorksCodeL" resultType="Integer" parameterType="WfWorksCodeLVo" >
		/* com.innobiz.orange.web.wf.dao.WfWorksCodeLDao.countWfWorksCodeL */
		SELECT COUNT(*) CNT
		FROM WFG_${formId}_WORKS_CODE_L T
		<include refid="selectWfWorksCodeLWhere"/>
	</select>
	
	<!-- 등록 저장 -->
	<insert id="insertWfWorksCodeL" parameterType="WfWorksCodeLVo" >
		/* com.innobiz.orange.web.wf.dao.WfWorksCodeLDao.insertWfWorksCodeL */
		INSERT INTO WFG_${formId}_WORKS_CODE_L
		<trim prefix="(" suffix=")" suffixOverrides=",">
			WORK_NO,
			TYP_CD,			
			COLM_NM,
			CD_VA,
			SORT_ORDR,
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides="," >
			#{workNo, jdbcType=INTEGER},
			#{typCd, jdbcType=VARCHAR},			
			#{colmNm, jdbcType=VARCHAR},
			#{cdVa, jdbcType=VARCHAR},
			#{sortOrdr, jdbcType=INTEGER},
		</trim>
	</insert>
	
	<!-- 수정 -->
	<update id="updateWfWorksCodeL" parameterType="WfWorksCodeLVo" >
		/* com.innobiz.orange.web.wf.dao.WfWorksCodeLDao.updateWfWorksCodeL */
		UPDATE WFG_${formId}_WORKS_CODE_L
		<set>
			<if test="cdVa != null"> CD_VA = #{cdVa, jdbcType=VARCHAR},</if>
			<if test="sortOrdr != null"> SORT_ORDR = #{sortOrdr, jdbcType=INTEGER},</if>
		</set>
		<where>
			<if test="workNo != null and workNo !=''"> AND WORK_NO = #{workNo, jdbcType=VARCHAR}</if>
			<if test="typCd != null and typCd !=''"> AND TYP_CD = #{typCd, jdbcType=VARCHAR}</if>
			<if test="colmNm != null and colmNm !=''"> AND COLM_NM = #{colmNm, jdbcType=VARCHAR}</if>
		</where>
	</update>

	<!-- 삭제 -->
	<delete id="deleteWfWorksCodeL" parameterType="WfWorksCodeLVo" >
		/* com.innobiz.orange.web.wf.dao.WfWorksCodeLDao.deleteWfWorksCodeL */
		DELETE FROM WFG_${formId}_WORKS_CODE_L
		<where>
			<if test="workNo != null"> AND WORK_NO = #{workNo, jdbcType=VARCHAR}</if>
			<if test="typCd != null and typCd !=''"> AND TYP_CD = #{typCd, jdbcType=VARCHAR}</if>
			<if test="colmNm != null and colmNm !=''"> AND COLM_NM = #{colmNm, jdbcType=VARCHAR}</if>
		</where>
	</delete>

</mapper>