<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- TABLE : WP_PRJ_MP_PLAN_D[프로잭트인력계획상세] -->
<mapper namespace="com.innobiz.orange.web.wp.dao.WpPrjMpPlanDDao">

	<resultMap id="wpPrjMpPlanDMap" type="WpPrjMpPlanDVo">
		<id property="prjNo" column="PRJ_NO" /><!-- 프로잭트번호 -->
		<id property="mpId" column="MP_ID" /><!-- 인력ID -->
		<result property="ver" column="VER" /><!-- 버전 -->
		<result property="mpTypCd" column="MP_TYP_CD" /><!-- 인력구분코드 -->
		<result property="prjRole1Cd" column="PRJ_ROLE1_CD" /><!-- 프로잭트역할1코드 -->
		<result property="prjRole2Cd" column="PRJ_ROLE2_CD" /><!-- 프로잭트역할2코드 -->
		<result property="sortOrdr" column="SORT_ORDR" /><!-- 정렬순서 -->
		<result property="mpMmSum" column="MP_MM_SUM" /><!-- 인력멘먼스합계 -->
		<result property="mpNm" column="MP_NM" /><!-- 투입인력명 -->
		<result property="rnum" column="RNUM" /><!-- 레코드 번호 -->
	</resultMap>

	<select id="selectWpPrjMpPlanD" resultMap="wpPrjMpPlanDMap" parameterType="WpPrjMpPlanDVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpPlanDDao.selectWpPrjMpPlanD */
		<if test="pageNo != null and pageRowCnt != null">
		SELECT * FROM (
		</if>
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="pageNo != null and pageRowCnt != null">
			TOP (#{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}) ROW_NUMBER() OVER (ORDER BY <if test="orderBy != null">${orderBy}</if><if test="orderBy == null">N.PRJ_NO DESC, N.MP_ID DESC</if>) AS RNUM, N.* FROM (SELECT
			</if>
			T.PRJ_NO,
			T.MP_ID,
			T.VER,
			T.MP_TYP_CD,
			T.PRJ_ROLE1_CD,
			T.PRJ_ROLE2_CD,
			T.SORT_ORDR,
			T.MP_MM_SUM,
			(CASE WHEN T.MP_TYP_CD = 'emp' THEN (SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_USER_B WHERE USER_UID = T.MP_ID) AND LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR},'ko')) WHEN T.MP_TYP_CD = 'out' THEN (SELECT MP_NM FROM WP_MP_B WHERE MP_ID = T.MP_ID) ELSE NULL END) MP_NM,
		</trim>
		FROM WP_PRJ_MP_PLAN_${tableType} T
		<where>
			<if test="prjNo != null">AND T.PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="mpId != null">AND T.MP_ID = #{mpId, jdbcType=VARCHAR}</if>
			<if test="ver != null and ver != ''">AND T.VER = #{ver, jdbcType=NUMERIC}</if>
			<if test="prjNoList != null">AND T.PRJ_NO IN ( <foreach collection="prjNoList" item="item" index="index" separator=",">#{item, jdbcType=VARCHAR}</foreach> )</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
		<if test="pageNo == null or pageRowCnt == null">
			<if test="orderBy != null">ORDER BY ${orderBy}</if>
			<if test="orderBy == null">ORDER BY T.PRJ_NO, T.MP_ID</if>
		</if>
		<if test="pageNo != null and pageRowCnt != null">
		<![CDATA[) N ) M WHERE RNUM > (#{pageNo, jdbcType=NUMERIC} - 1) * #{pageRowCnt, jdbcType=NUMERIC} AND RNUM <= #{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}]]>
		</if>
	</select>

	<select id="countWpPrjMpPlanD" resultType="Integer" parameterType="WpPrjMpPlanDVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpPlanDDao.countWpPrjMpPlanD */
		SELECT COUNT(*) CNT
		FROM WP_PRJ_MP_PLAN_${tableType} T
		<where>
			<if test="prjNo != null">AND T.PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="mpId != null">AND T.MP_ID = #{mpId, jdbcType=VARCHAR}</if>
			<if test="ver != null and ver != ''">AND T.VER = #{ver, jdbcType=NUMERIC}</if>
			<if test="prjNoList != null">AND T.PRJ_NO IN ( <foreach collection="prjNoList" item="item" index="index" separator=",">#{item, jdbcType=VARCHAR}</foreach> )</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</select>

	<insert id="insertWpPrjMpPlanD" parameterType="WpPrjMpPlanDVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpPlanDDao.insertWpPrjMpPlanD */
		INSERT INTO WP_PRJ_MP_PLAN_${tableType}
		<trim prefix="(" suffix=")" suffixOverrides=",">
			PRJ_NO,
			MP_ID,
			VER,
			MP_TYP_CD,
			PRJ_ROLE1_CD,
			PRJ_ROLE2_CD,
			SORT_ORDR,
			MP_MM_SUM,
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides="," >
			#{prjNo, jdbcType=BIGINT},
			#{mpId, jdbcType=VARCHAR},
			#{ver, jdbcType=NUMERIC},
			#{mpTypCd, jdbcType=VARCHAR},
			#{prjRole1Cd, jdbcType=VARCHAR},
			#{prjRole2Cd, jdbcType=VARCHAR},
			<if test="sortOrdr != null and sortOrdr != ''">#{sortOrdr, jdbcType=INTEGER},</if>
			<if test="sortOrdr == null or sortOrdr == ''">(SELECT ISNULL(MAX(SORT_ORDR),0)+1 FROM WP_PRJ_MP_PLAN_${tableType}),</if>
			<if test="mpMmSum == ''">NULL</if><if test="mpMmSum != ''">#{mpMmSum, jdbcType=NUMERIC}</if>,
		</trim>
	</insert>

	<update id="updateWpPrjMpPlanD" parameterType="WpPrjMpPlanDVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpPlanDDao.updateWpPrjMpPlanD */
		UPDATE WP_PRJ_MP_PLAN_${tableType}
		<set>
			<if test="prjNo != null">PRJ_NO = #{prjNo, jdbcType=BIGINT},</if>
			<if test="mpId != null">MP_ID = #{mpId, jdbcType=VARCHAR},</if>
			<if test="mpTypCd != null">MP_TYP_CD = #{mpTypCd, jdbcType=VARCHAR},</if>
			<if test="prjRole1Cd != null">PRJ_ROLE1_CD = #{prjRole1Cd, jdbcType=VARCHAR},</if>
			<if test="prjRole2Cd != null">PRJ_ROLE2_CD = #{prjRole2Cd, jdbcType=VARCHAR},</if>
			<if test="sortOrdr != null">SORT_ORDR = #{sortOrdr, jdbcType=VARCHAR},</if>
			<if test="mpMmSum != null">MP_MM_SUM = <if test="mpMmSum == ''">NULL</if><if test="mpMmSum != ''">#{mpMmSum, jdbcType=NUMERIC}</if>,</if>
		</set>
		<where>
			<if test="prjNo != null">AND PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="mpId != null">AND MP_ID = #{mpId, jdbcType=VARCHAR}</if>
			<if test="ver != null and ver != ''">AND VER = #{ver, jdbcType=NUMERIC}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</update>

	<delete id="deleteWpPrjMpPlanD" parameterType="WpPrjMpPlanDVo" >
		/* com.innobiz.orange.web.wp.dao.WpPrjMpPlanDDao.deleteWpPrjMpPlanD */
		DELETE FROM WP_PRJ_MP_PLAN_${tableType}
		<where>
			<if test="prjNo != null">AND PRJ_NO = #{prjNo, jdbcType=BIGINT}</if>
			<if test="mpId != null">AND MP_ID = #{mpId, jdbcType=VARCHAR}</if>
			<if test="ver != null and ver != ''">AND VER = #{ver, jdbcType=NUMERIC}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</delete>

</mapper>