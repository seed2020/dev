<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- TABLE : BA_BRD_B[테이블관리] -->
<mapper namespace="com.innobiz.orange.web.bb.dao.BaBrdBDao">

	<resultMap id="baBrdBMap" type="BaBrdBVo">
		<id property="compId" column="COMP_ID" /><!-- 회사ID -->
		<id property="brdId" column="BRD_ID" /><!-- 게시판ID -->
		<id property="brdNm" column="BRD_NM" /><!-- 게시판명 -->
		<id property="rescId" column="RESC_ID" /><!-- 리소스ID -->
		<id property="rescNm" column="RESC_NM" /><!-- 리소스명 -->
		<id property="brdDesc" column="BRD_DESC" /><!-- 설명 -->
		<id property="deptBrdYn" column="DEPT_BRD_YN" /><!-- 부서게시판여부 -->
		<id property="allCompYn" column="ALL_COMP_YN" /><!-- 전사게시판여부 -->
		<id property="photoYn" column="PHOTO_YN" /><!-- 포토게시판여부 -->
		<id property="tblId" column="TBL_ID" /><!-- 테이블ID -->
		<id property="tblNm" column="TBL_NM" /><!-- 테이블명 -->
		<id property="tblDispNm" column="TBL_DISP_NM" /><!-- 테이블표시명 -->
		<id property="exYn" column="EX_YN" /><!-- 확장여부 -->
		<id property="catYn" column="CAT_YN" /><!-- 카테고리사용여부 -->
		<id property="catGrpId" column="CAT_GRP_ID" /><!-- 카테고리그룹ID -->
		<id property="catGrpNm" column="CAT_GRP_NM" /><!-- 카테고리그룹명 -->
		<id property="brdTypCd" column="BRD_TYP_CD" /><!-- 게시판타입코드 -->
		<id property="brdTypNm" column="BRD_TYP_NM" /><!-- 게시판타입명 -->
		<id property="replyYn" column="REPLY_YN" /><!-- 답변형여부 -->
		<id property="discYn" column="DISC_YN" /><!-- 심의여부 -->
		<id property="discrUid" column="DISCR_UID" /><!-- 심의자UID -->
		<id property="discrNm" column="DISCR_NM" /><!-- 심의자명 -->
		<id property="kndCd" column="KND_CD" /><!-- 게시판종류코드 -->
		<id property="kndNm" column="KND_NM" /><!-- 게시판종류명 -->
		<id property="rezvPrd" column="REZV_PRD" /><!-- 게시예약기간 -->
		<id property="bodySizeLim" column="BODY_SIZE_LIM" /><!-- 본문사이즈제한 -->
		<id property="attSizeLim" column="ATT_SIZE_LIM" /><!-- 첨부사이즈제한 -->
		<id property="attCapaLim" column="ATT_CAPA_LIM" /><!-- 첨부용량제한 -->
		<id property="newDispYn" column="NEW_DISP_YN" /><!-- 신규게시물표시여부 -->
		<id property="newDispPrd" column="NEW_DISP_PRD" /><!-- 신규게시물표시기간 -->
		<id property="prevNextYn" column="PREV_NEXT_YN" /><!-- 이전다음표시여부 -->
		<id property="cmtYn" column="CMT_YN" /><!-- 한줄답변사용여부 -->
		<id property="favotYn" column="FAVOT_YN" /><!-- 찬반투표사용여부 -->
		<id property="pichDispYn" column="PICH_DISP_YN" /><!-- 담당자표시여부 -->
		<id property="pichUid" column="PICH_UID" /><!-- 담당자UID -->
		<id property="readHstUseYn" column="READ_HST_USE_YN" /><!-- 조회이력사용여부 -->
		<id property="notcDispPrd" column="NOTC_DISP_PRD" /><!-- 공지표시기간 -->
		<id property="recmdUseYn" column="RECMD_USE_YN" /><!-- 추천사용여부 -->
		<id property="screUseYn" column="SCRE_USE_YN" /><!-- 점수사용여부 -->
		<id property="lastBullYn" column="LAST_BULL_YN" /><!-- 최근게시물여부 -->
		<id property="pltYn" column="PLT_YN" /><!--  포틀렛게시판여부 -->
		<id property="optVa" column="OPT_VA" /><!--  옵션값 -->
		<id property="regrUid" column="REGR_UID" /><!-- 등록자 -->
		<id property="regDt" column="REG_DT" /><!-- 등록일시 -->
		<id property="modrUid" column="MODR_UID" /><!-- 수정자 -->
		<id property="modDt" column="MOD_DT" /><!-- 수정일시 -->
	</resultMap>

	<select id="selectBaBrdB" resultMap="baBrdBMap" parameterType="BaBrdBVo" >
		/* com.innobiz.orange.web.bb.dao.BaBrdBDao.selectBaBrdB */
		<if test="pageNo != null and pageRowCnt != null">
		SELECT * FROM (
		</if>
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			<if test="pageNo != null and pageRowCnt != null">
			TOP (#{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}) ROW_NUMBER() OVER (ORDER BY <if test="orderBy != null">${orderBy}</if><if test="orderBy == null">T.BRD_ID DESC</if>) AS RNUM,
			</if>
			T.COMP_ID,
			T.BRD_ID,
			T.BRD_NM,
			T.RESC_ID,
			(SELECT RESC_VA FROM BA_RESC_B WHERE RESC_ID = T.RESC_ID AND LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR},'ko')) RESC_NM,
			T.BRD_DESC,
			T.DEPT_BRD_YN,
			T.ALL_COMP_YN,
			T.PHOTO_YN,
			T.TBL_ID,
			(SELECT TBL_NM FROM BA_TBL_B WHERE TBL_ID = T.TBL_ID) TBL_NM,
			(SELECT RESC_VA FROM BA_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM BA_TBL_B WHERE TBL_ID = T.TBL_ID) AND LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')) TBL_DISP_NM,
			(SELECT EX_YN FROM BA_TBL_B WHERE TBL_ID = T.TBL_ID) EX_YN,
			T.CAT_YN,
			T.CAT_GRP_ID,
			(SELECT RESC_VA FROM BA_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM BA_CAT_GRP_B WHERE CAT_GRP_ID = T.CAT_GRP_ID) AND LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')) CAT_GRP_NM,
			T.BRD_TYP_CD,
			(SELECT RESC_VA FROM PT_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM PT_CD_B WHERE CLS_CD = ISNULL(#{brdTypRcd, jdbcType=VARCHAR},'BRD_TYP_CD') AND CD = T.BRD_TYP_CD) AND LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR},'ko')) BRD_TYP_NM,
			T.REPLY_YN,
			T.DISC_YN,
			T.DISCR_UID,
			(SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_USER_B WHERE USER_UID = T.DISCR_UID) AND LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')) DISCR_NM,
			T.KND_CD,
			(SELECT RESC_VA FROM PT_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM PT_CD_B WHERE CLS_CD = ISNULL(#{kndRcd, jdbcType=VARCHAR}, 'KND_CD') AND CD = T.KND_CD) AND LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')) KND_NM,
			T.REZV_PRD,
			T.BODY_SIZE_LIM,
			T.ATT_SIZE_LIM,
			T.ATT_CAPA_LIM,
			T.NEW_DISP_YN,
			T.NEW_DISP_PRD,
			T.PREV_NEXT_YN,
			T.CMT_YN,
			T.FAVOT_YN,
			T.PICH_DISP_YN,
			T.PICH_UID,
			T.READ_HST_USE_YN,
			T.NOTC_DISP_PRD,
			T.RECMD_USE_YN,
			T.SCRE_USE_YN,
			T.LAST_BULL_YN,
			T.PLT_YN,
			T.OPT_VA,
			T.REGR_UID,
			T.REG_DT,
			T.MODR_UID,
			T.MOD_DT,
		</trim>
		FROM BA_BRD_B T<if test="schCat == 'BRD_NM' and schWord != null and schWord != ''">, BA_RESC_B R</if>
		<where>
			<if test="brdId != null and brdId != ''"> AND T.BRD_ID = #{brdId, jdbcType=VARCHAR}</if>
			<if test="compId != null"> AND (T.COMP_ID = #{compId, jdbcType=VARCHAR} OR T.ALL_COMP_YN = 'Y')</if>
			<if test="tblId != null and tblId != ''"> AND T.TBL_ID = #{tblId, jdbcType=VARCHAR}</if>
			<if test="schCat == 'BRD_NM' and schWord != null and schWord != ''"> AND R.LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR},'ko') AND R.RESC_ID = T.RESC_ID AND R.RESC_VA LIKE '%'+#{schWord, jdbcType=VARCHAR}+'%'</if>
			<if test="schTblId != null and schTblId != ''"> AND T.TBL_ID = #{schTblId, jdbcType=VARCHAR}</if>
			<if test="catGrpId != null and catGrpId != ''"> AND T.CAT_GRP_ID = #{catGrpId, jdbcType=VARCHAR}</if>
			<if test="exYn != null and exYn != ''"> AND EXISTS (SELECT 1 FROM BA_TBL_B WHERE TBL_ID = T.TBL_ID AND EX_YN = #{exYn, jdbcType=VARCHAR})</if>
			<if test="replyYn != null and replyYn != ''"> AND T.REPLY_YN = #{replyYn, jdbcType=VARCHAR}</if>
			<if test="kndCd != null and kndCd != ''"> AND T.KND_CD = #{kndCd, jdbcType=VARCHAR}</if>
			<if test="brdTypCd != null and brdTypCd != ''"> AND T.BRD_TYP_CD = #{brdTypCd, jdbcType=VARCHAR}</if>
			<if test="discYn != null and discYn != ''"> AND T.DISC_YN = #{discYn, jdbcType=VARCHAR}</if>
			<if test="deptBrdYn != null and deptBrdYn != ''" > AND T.DEPT_BRD_YN = #{deptBrdYn, jdbcType=VARCHAR}</if>
			<if test="allCompYn != null and allCompYn != ''" > AND T.ALL_COMP_YN = #{allCompYn, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
		<if test="orderBy != null">ORDER BY ${orderBy}</if>
		<if test="orderBy == null">ORDER BY T.BRD_ID DESC</if>
		<if test="pageNo != null and pageRowCnt != null">
		<![CDATA[) M WHERE RNUM > (#{pageNo, jdbcType=NUMERIC} - 1) * #{pageRowCnt, jdbcType=NUMERIC} AND RNUM <= #{pageNo, jdbcType=NUMERIC} * #{pageRowCnt, jdbcType=NUMERIC}]]>
		</if>
	</select>

	<select id="countBaBrdB" resultType="Integer" parameterType="BaBrdBVo" >
		/* com.innobiz.orange.web.bb.dao.BaBrdBDao.countBaBrdB */
		SELECT COUNT(*) CNT
		FROM BA_BRD_B T<if test="schCat == 'BRD_NM' and schWord != null and schWord != ''">, BA_RESC_B R</if>
		<where>
			<if test="brdId != null and brdId != ''"> AND T.BRD_ID = #{brdId, jdbcType=VARCHAR}</if>
			<if test="compId != null"> AND (T.COMP_ID = #{compId, jdbcType=VARCHAR} OR T.ALL_COMP_YN = 'Y')</if>
			<if test="tblId != null and tblId != ''"> AND T.TBL_ID = #{tblId, jdbcType=VARCHAR}</if>
			<if test="schCat == 'BRD_NM' and schWord != null and schWord != ''"> AND R.LANG_TYP_CD = ISNULL(#{queryLang, jdbcType=VARCHAR},'ko') AND R.RESC_ID = T.RESC_ID AND R.RESC_VA LIKE '%'+#{schWord, jdbcType=VARCHAR}+'%'</if>
			<if test="schTblId != null and schTblId != ''"> AND T.TBL_ID = #{schTblId, jdbcType=VARCHAR}</if>
			<if test="catGrpId != null and catGrpId != ''"> AND T.CAT_GRP_ID = #{catGrpId, jdbcType=VARCHAR}</if>
			<if test="exYn != null and exYn != ''"> AND EXISTS (SELECT 1 FROM BA_TBL_B WHERE TBL_ID = T.TBL_ID AND EX_YN = #{exYn, jdbcType=VARCHAR})</if>
			<if test="replyYn != null and replyYn != ''"> AND T.REPLY_YN = #{replyYn, jdbcType=VARCHAR}</if>
			<if test="kndCd != null and kndCd != ''"> AND T.KND_CD = #{kndCd, jdbcType=VARCHAR}</if>
			<if test="brdTypCd != null and brdTypCd != ''"> AND T.BRD_TYP_CD = #{brdTypCd, jdbcType=VARCHAR}</if>
			<if test="discYn != null and discYn != ''"> AND T.DISC_YN = #{discYn, jdbcType=VARCHAR}</if>
			<if test="allCompYn != null and allCompYn != ''" > AND T.ALL_COMP_YN = #{allCompYn, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</select>

	<insert id="insertBaBrdB" parameterType="BaBrdBVo">
		/* com.innobiz.orange.web.bb.dao.BaBrdBDao.insertBaBrdB */
		INSERT INTO BA_BRD_B
		<trim prefix="(" suffix=")" suffixOverrides=",">
			COMP_ID,
			BRD_ID,
			BRD_NM,
			RESC_ID,
			BRD_DESC,
			DEPT_BRD_YN,
			ALL_COMP_YN,
			PHOTO_YN,
			TBL_ID,
			CAT_YN,
			CAT_GRP_ID,
			BRD_TYP_CD,
			REPLY_YN,
			DISC_YN,
			DISCR_UID,
			KND_CD,
			REZV_PRD,
			BODY_SIZE_LIM,
			ATT_SIZE_LIM,
			ATT_CAPA_LIM,
			NEW_DISP_YN,
			NEW_DISP_PRD,
			PREV_NEXT_YN,
			CMT_YN,
			FAVOT_YN,
			PICH_DISP_YN,
			PICH_UID,
			READ_HST_USE_YN,
			NOTC_DISP_PRD,
			RECMD_USE_YN,
			SCRE_USE_YN,
			LAST_BULL_YN,
			OPT_VA,
			REGR_UID,
			REG_DT,
			MODR_UID,
			MOD_DT,
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides=",">
			#{compId, jdbcType=VARCHAR},
			#{brdId, jdbcType=VARCHAR},
			#{brdNm, jdbcType=VARCHAR},
			#{rescId, jdbcType=VARCHAR},
			#{brdDesc, jdbcType=NVARCHAR},
			#{deptBrdYn, jdbcType=VARCHAR},
			#{allCompYn, jdbcType=VARCHAR},
			#{photoYn, jdbcType=VARCHAR},
			#{tblId, jdbcType=VARCHAR},
			#{catYn, jdbcType=VARCHAR},
			#{catGrpId, jdbcType=VARCHAR},
			#{brdTypCd, jdbcType=VARCHAR},
			#{replyYn, jdbcType=VARCHAR},
			#{discYn, jdbcType=VARCHAR},
			#{discrUid, jdbcType=VARCHAR},
			#{kndCd, jdbcType=VARCHAR},
			#{rezvPrd, jdbcType=INTEGER},
			#{bodySizeLim, jdbcType=INTEGER},
			#{attSizeLim, jdbcType=INTEGER},
			#{attCapaLim, jdbcType=INTEGER},
			#{newDispYn, jdbcType=VARCHAR},
			#{newDispPrd, jdbcType=INTEGER},
			#{prevNextYn, jdbcType=VARCHAR},
			#{cmtYn, jdbcType=VARCHAR},
			#{favotYn, jdbcType=VARCHAR},
			#{pichDispYn, jdbcType=VARCHAR},
			#{pichUid, jdbcType=VARCHAR},
			#{readHstUseYn, jdbcType=VARCHAR},
			#{notcDispPrd, jdbcType=INTEGER},
			#{recmdUseYn, jdbcType=VARCHAR},
			#{screUseYn, jdbcType=VARCHAR},
			#{lastBullYn, jdbcType=VARCHAR},
			#{optVa, jdbcType=VARCHAR},
			<if test="regrUid != null">#{regrUid, jdbcType=VARCHAR},</if><if test="regrUid == null">#{modrUid, jdbcType=VARCHAR},</if>
			<if test="regDt == 'sysdate'">GETDATE(),</if><if test="regDt == null or regDt == ''"><if test="modDt == 'sysdate'">GETDATE(),</if><if test="modDt != 'sysdate'">NULL,</if></if>
			<if test="regDt != null and regDt != '' and regDt != 'sysdate'">CONVERT(DATETIME, #{regDt, jdbcType=VARCHAR}, 120),</if>
			#{modrUid, jdbcType=VARCHAR},
			<if test="modDt == 'sysdate'">GETDATE(),</if><if test="modDt == null or modDt == ''">NULL,</if>
			<if test="modDt != null and modDt != '' and modDt != 'sysdate'">CONVERT(DATETIME, #{modDt, jdbcType=VARCHAR}, 120),</if>
		</trim>
	</insert>

	<update id="updateBaBrdB" parameterType="BaBrdBVo" >
		/* com.innobiz.orange.web.pt.dao.BaBrdBDao.updateBaBrdB */
		UPDATE BA_BRD_B
		<set>
			<if test="compId != null"> COMP_ID = #{compId, jdbcType=VARCHAR},</if>
			<if test="brdId != null"> BRD_ID = #{brdId, jdbcType=VARCHAR},</if>
			<if test="brdNm != null"> BRD_NM = #{brdNm, jdbcType=VARCHAR},</if>
			<if test="rescId != null"> RESC_ID = #{rescId, jdbcType=VARCHAR},</if>
			<if test="brdDesc != null"> BRD_DESC = #{brdDesc, jdbcType=NVARCHAR},</if>
			<if test="deptBrdYn != null"> DEPT_BRD_YN = #{deptBrdYn, jdbcType=VARCHAR},</if>
			<if test="allCompYn != null"> ALL_COMP_YN = #{allCompYn, jdbcType=VARCHAR},</if>
			<if test="photoYn != null"> PHOTO_YN = #{photoYn, jdbcType=VARCHAR},</if>
			<if test="tblId != null"> TBL_ID = #{tblId, jdbcType=VARCHAR},</if>
			<if test="catYn != null"> CAT_YN = #{catYn, jdbcType=VARCHAR},</if>
			<if test="catGrpId != null"> CAT_GRP_ID = #{catGrpId, jdbcType=VARCHAR},</if>
			<if test="brdTypCd != null"> BRD_TYP_CD = #{brdTypCd, jdbcType=VARCHAR},</if>
			<if test="replyYn != null"> REPLY_YN = #{replyYn, jdbcType=VARCHAR},</if>
			<if test="discYn != null"> DISC_YN = #{discYn, jdbcType=VARCHAR},</if>
			<if test="discrUid != null"> DISCR_UID = #{discrUid, jdbcType=VARCHAR},</if>
			<if test="kndCd != null"> KND_CD = #{kndCd, jdbcType=VARCHAR},</if>
			<if test="rezvPrd != null"> REZV_PRD = #{rezvPrd, jdbcType=INTEGER},</if>
			<if test="bodySizeLim != null"> BODY_SIZE_LIM = #{bodySizeLim, jdbcType=INTEGER},</if>
			<if test="attSizeLim != null"> ATT_SIZE_LIM = #{attSizeLim, jdbcType=INTEGER},</if>
			<if test="attCapaLim != null"> ATT_CAPA_LIM = #{attCapaLim, jdbcType=INTEGER},</if>
			<if test="newDispYn != null"> NEW_DISP_YN = #{newDispYn, jdbcType=VARCHAR},</if>
			<if test="newDispPrd != null"> NEW_DISP_PRD = #{newDispPrd, jdbcType=INTEGER},</if>
			<if test="prevNextYn != null"> PREV_NEXT_YN = #{prevNextYn, jdbcType=VARCHAR},</if>
			<if test="cmtYn != null"> CMT_YN = #{cmtYn, jdbcType=VARCHAR},</if>
			<if test="favotYn != null"> FAVOT_YN = #{favotYn, jdbcType=VARCHAR},</if>
			<if test="pichDispYn != null"> PICH_DISP_YN = #{pichDispYn, jdbcType=VARCHAR},</if>
			<if test="pichUid != null"> PICH_UID = #{pichUid, jdbcType=VARCHAR},</if>
			<if test="readHstUseYn != null"> READ_HST_USE_YN = #{readHstUseYn, jdbcType=VARCHAR},</if>
			<if test="notcDispPrd != null"> NOTC_DISP_PRD = #{notcDispPrd, jdbcType=INTEGER},</if>
			<if test="recmdUseYn != null"> RECMD_USE_YN = #{recmdUseYn, jdbcType=VARCHAR},</if>
			<if test="screUseYn != null"> SCRE_USE_YN = #{screUseYn, jdbcType=VARCHAR},</if>
			<if test="lastBullYn != null"> LAST_BULL_YN = #{lastBullYn, jdbcType=VARCHAR},</if>
			<if test="pltYn != null"> PLT_YN = #{pltYn, jdbcType=VARCHAR},</if>
			<if test="optVa != null"> OPT_VA = #{optVa, jdbcType=VARCHAR},</if>
			<if test="modrUid != null"> MODR_UID = #{modrUid, jdbcType=VARCHAR},</if>
			<if test="modDt != null">
				<if test="modDt == 'sysdate'"> MOD_DT = GETDATE(),</if>
				<if test="modDt == ''"> MOD_DT = NULL,</if>
				<if test="modDt != '' and modDt != 'sysdate'"> MOD_DT = CONVERT(DATETIME, #{modDt, jdbcType=VARCHAR}, 120),</if>
			</if>
		</set>
		<where>
			<if test="brdId != null"> AND BRD_ID = #{brdId, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</update>

	<delete id="deleteBaBrdB" parameterType="BaBrdBVo">
		/* com.innobiz.orange.web.bb.dao.BaBrdBDao.deleteBaBrdB */
		DELETE FROM BA_BRD_B
		<where>
			AND BRD_ID = #{brdId, jdbcType=VARCHAR}
		</where>
	</delete>

</mapper>