<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- TABLE : OR_OFSE_D[관인상세] -->
<mapper namespace="com.innobiz.orange.web.or.dao.OrOfseDDao">

	<resultMap id="orOfseDMap" type="OrOfseDVo">
		<id property="orgId" column="ORG_ID" /><!-- 조직ID -->
		<id property="seq" column="SEQ" /><!-- 일련번호 -->
		<result property="ofseTypCd" column="OFSE_TYP_CD" /><!-- 관인구분코드 -->
		<result property="ofseNm" column="OFSE_NM" /><!-- 관인명 -->
		<result property="rescId" column="RESC_ID" /><!-- 리소스ID -->
		<result property="dftOfseYn" column="DFT_OFSE_YN" /><!-- 기본관인여부 -->
		<result property="disuYn" column="DISU_YN" /><!-- 폐기여부 -->
		<result property="imgPath" column="IMG_PATH" /><!-- 이미지경로 -->
		<result property="imgWdth" column="IMG_WDTH" /><!-- 이미지넓이 -->
		<result property="imgHght" column="IMG_HGHT" /><!-- 이미지높이 -->
		<result property="chnRson" column="CHN_RSON" /><!-- 변경사유 -->
		<result property="regrUid" column="REGR_UID" /><!-- 등록자UID -->
		<result property="regDt" column="REG_DT" /><!-- 등록일시 -->
		<result property="disurUid" column="DISUR_UID" /><!-- 폐기자UID -->
		<result property="disuDt" column="DISU_DT" /><!-- 폐기일시 -->
		<result property="ofseTypNm" column="OFSE_TYP_NM" /><!-- 관인구분명 -->
		<result property="rescNm" column="RESC_NM" /><!-- 리소스명 -->
		<result property="regrNm" column="REGR_NM" /><!-- 등록자U명 -->
		<result property="disurNm" column="DISUR_NM" /><!-- 폐기자U명 -->
		<result property="rnum" column="RNUM" /><!-- 레코드 번호 -->
	</resultMap>

	<select id="selectOrOfseD" resultMap="orOfseDMap" parameterType="OrOfseDVo" >
		/* com.innobiz.orange.web.or.dao.OrOfseDDao.selectOrOfseD */
		<if test="pageNo != null and pageRowCnt != null">
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			M.*,
			(SELECT RESC_VA FROM PT_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM PT_CD_B WHERE CLS_CD = 'OFSE_TYP_CD' AND CD = M.OFSE_TYP_CD) AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR},'ko')) OFSE_TYP_NM,
			(SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = M.RESC_ID AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR},'ko')) RESC_NM,
			(SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_USER_B WHERE USER_UID = M.REGR_UID) AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR},'ko')) REGR_NM,
			(SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_USER_B WHERE USER_UID = M.DISUR_UID) AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR},'ko')) DISUR_NM,
		</trim>
		FROM (
		</if>
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			T.ORG_ID,
			T.SEQ,
			T.OFSE_TYP_CD,
			T.OFSE_NM,
			T.RESC_ID,
			T.DFT_OFSE_YN,
			T.DISU_YN,
			T.IMG_PATH,
			T.IMG_WDTH,
			T.IMG_HGHT,
			T.CHN_RSON,
			T.REGR_UID,
			DATE_FORMAT(T.REG_DT, '%Y-%m-%d %H:%i:%s') REG_DT,
			T.DISUR_UID,
			DATE_FORMAT(T.DISU_DT, '%Y-%m-%d %H:%i:%s') DISU_DT,
			<if test="pageNo == null or pageRowCnt == null">
			(SELECT RESC_VA FROM PT_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM PT_CD_B WHERE CLS_CD = 'OFSE_TYP_CD' AND CD = T.OFSE_TYP_CD) AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR},'ko')) OFSE_TYP_NM,
			(SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = T.RESC_ID AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR},'ko')) RESC_NM,
			(SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_USER_B WHERE USER_UID = T.REGR_UID) AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR},'ko')) REGR_NM,
			(SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_USER_B WHERE USER_UID = T.DISUR_UID) AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR},'ko')) DISUR_NM,
			</if>
		</trim>
		FROM OR_OFSE_D T
		<where>
			<if test="orgId != null">AND T.ORG_ID = #{orgId, jdbcType=VARCHAR}</if>
			<if test="seq != null">AND T.SEQ = #{seq, jdbcType=INTEGER}</if>
			<if test="ofseTypCd != null and ofseTypCd != ''">AND T.OFSE_TYP_CD = #{ofseTypCd, jdbcType=VARCHAR}</if>
			<if test="dftOfseYn != null and dftOfseYn != ''">AND T.DFT_OFSE_YN = #{dftOfseYn, jdbcType=VARCHAR}</if>
			<if test="disuYn != null and disuYn != ''">AND T.DISU_YN = #{disuYn, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
		<if test="orderBy != null">ORDER BY ${orderBy}</if>
		<if test="orderBy == null">ORDER BY T.ORG_ID, T.SEQ</if>
		<if test="pageNo != null and pageRowCnt != null">
		LIMIT #{pageStrt, jdbcType=NUMERIC}, #{pageRowCnt, jdbcType=NUMERIC} ) M
		</if>
	</select>

	<select id="countOrOfseD" resultType="Integer" parameterType="OrOfseDVo" >
		/* com.innobiz.orange.web.or.dao.OrOfseDDao.countOrOfseD */
		SELECT COUNT(*) CNT
		FROM OR_OFSE_D T
		<where>
			<if test="orgId != null">AND T.ORG_ID = #{orgId, jdbcType=VARCHAR}</if>
			<if test="seq != null">AND T.SEQ = #{seq, jdbcType=INTEGER}</if>
			<if test="ofseTypCd != null and ofseTypCd != ''">AND T.OFSE_TYP_CD = #{ofseTypCd, jdbcType=VARCHAR}</if>
			<if test="dftOfseYn != null and dftOfseYn != ''">AND T.DFT_OFSE_YN = #{dftOfseYn, jdbcType=VARCHAR}</if>
			<if test="disuYn != null and disuYn != ''">AND T.DISU_YN = #{disuYn, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</select>

	<insert id="insertOrOfseD" parameterType="OrOfseDVo" >
		/* com.innobiz.orange.web.or.dao.OrOfseDDao.insertOrOfseD */
		INSERT INTO OR_OFSE_D
		<trim prefix="(" suffix=")" suffixOverrides=",">
			ORG_ID,
			SEQ,
			OFSE_TYP_CD,
			OFSE_NM,
			RESC_ID,
			DFT_OFSE_YN,
			DISU_YN,
			IMG_PATH,
			IMG_WDTH,
			IMG_HGHT,
			CHN_RSON,
			REGR_UID,
			REG_DT,
			DISUR_UID,
			DISU_DT,
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides="," >
			#{orgId, jdbcType=VARCHAR},
			<if test="seq != null and seq != ''">#{seq, jdbcType=INTEGER},</if>
			<if test="seq == null or seq == ''">(SELECT IFNULL(MAX(P.SEQ),0)+1 FROM OR_OFSE_D P WHERE P.ORG_ID = #{orgId, jdbcType=VARCHAR}),</if>
			#{ofseTypCd, jdbcType=VARCHAR},
			#{ofseNm, jdbcType=NVARCHAR},
			#{rescId, jdbcType=VARCHAR},
			#{dftOfseYn, jdbcType=VARCHAR},
			#{disuYn, jdbcType=VARCHAR},
			#{imgPath, jdbcType=VARCHAR},
			#{imgWdth, jdbcType=INTEGER},
			#{imgHght, jdbcType=INTEGER},
			#{chnRson, jdbcType=NVARCHAR},
			#{regrUid, jdbcType=VARCHAR},
			<if test="regDt == 'sysdate'">NOW(),</if><if test="regDt == null or regDt == ''">NULL,</if>
			<if test="regDt != null and regDt != '' and regDt != 'sysdate'">STR_TO_DATE(#{regDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			#{disurUid, jdbcType=VARCHAR},
			<if test="disuDt == 'sysdate'">NOW(),</if><if test="disuDt == null or disuDt == ''">NULL,</if>
			<if test="disuDt != null and disuDt != '' and disuDt != 'sysdate'">STR_TO_DATE(#{disuDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
		</trim>
	</insert>

	<update id="updateOrOfseD" parameterType="OrOfseDVo" >
		/* com.innobiz.orange.web.or.dao.OrOfseDDao.updateOrOfseD */
		UPDATE OR_OFSE_D
		<set>
			<if test="seq != null">SEQ = #{seq, jdbcType=INTEGER},</if>
			<if test="ofseNm != null">OFSE_NM = #{ofseNm, jdbcType=NVARCHAR},</if>
			<if test="rescId != null">RESC_ID = #{rescId, jdbcType=VARCHAR},</if>
			<if test="dftOfseYn != null">DFT_OFSE_YN = #{dftOfseYn, jdbcType=VARCHAR},</if>
			<if test="disuYn != null">DISU_YN = #{disuYn, jdbcType=VARCHAR},</if>
			<if test="imgPath != null">IMG_PATH = #{imgPath, jdbcType=VARCHAR},</if>
			<if test="imgWdth != null">IMG_WDTH = #{imgWdth, jdbcType=INTEGER},</if>
			<if test="imgHght != null">IMG_HGHT = #{imgHght, jdbcType=INTEGER},</if>
			<if test="chnRson != null">CHN_RSON = #{chnRson, jdbcType=NVARCHAR},</if>
			<if test="regrUid != null">REGR_UID = #{regrUid, jdbcType=VARCHAR},</if>
			<if test="regDt != null">
				<if test="regDt == 'sysdate'">REG_DT = NOW(),</if>
				<if test="regDt == ''">REG_DT = NULL,</if>
				<if test="regDt != '' and regDt != 'sysdate'">REG_DT = STR_TO_DATE(#{regDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			</if>
			<if test="disurUid != null">DISUR_UID = #{disurUid, jdbcType=VARCHAR},</if>
			<if test="disuDt != null">
				<if test="disuDt == 'sysdate'">DISU_DT = NOW(),</if>
				<if test="disuDt == ''">DISU_DT = NULL,</if>
				<if test="disuDt != '' and disuDt != 'sysdate'">DISU_DT = STR_TO_DATE(#{disuDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			</if>
		</set>
		<where>
			<if test="orgId != null">AND ORG_ID = #{orgId, jdbcType=VARCHAR}</if>
			<if test="seq != null">AND SEQ = #{seq, jdbcType=INTEGER}</if>
			<if test="ofseTypCd != null and ofseTypCd != ''">AND OFSE_TYP_CD = #{ofseTypCd, jdbcType=VARCHAR}</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</update>

	<delete id="deleteOrOfseD" parameterType="OrOfseDVo" >
		/* com.innobiz.orange.web.or.dao.OrOfseDDao.deleteOrOfseD */
		DELETE FROM OR_OFSE_D
		<where>
			<if test="orgId != null">AND ORG_ID = #{orgId, jdbcType=VARCHAR}</if>
			<if test="seq != null">AND SEQ = #{seq, jdbcType=INTEGER}</if>
			<if test="compId != null and compId != ''">AND ORG_ID IN (SELECT ORG_ID FROM OR_ORG_B WHERE COMP_ID = #{compId, jdbcType=VARCHAR})</if>
			<if test="whereSqllet != null and whereSqllet != ''">${whereSqllet}</if>
		</where>
	</delete>

</mapper>