<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- TABLE : BB_X000X_L[게시물] -->
<mapper namespace="com.innobiz.orange.web.bb.dao.BbBullLDao">

	<resultMap id="bbBullLMap" type="BbBullLVo">
		<id property="bullId" column="BULL_ID" /><!-- 게시물ID -->
		<id property="compId" column="COMP_ID" /><!-- 회사ID -->
		<id property="brdId" column="BRD_ID" /><!-- 게시판ID -->
		<id property="brdNm" column="BRD_NM" /><!-- 게시판명 -->
		<id property="bullPid" column="BULL_PID" /><!-- 부모게시물ID -->
		<id property="replyGrpId" column="REPLY_GRP_ID" /><!-- 답변그룹ID -->
		<id property="replyOrdr" column="REPLY_ORDR" /><!-- 답변순서 -->
		<id property="replyDpth" column="REPLY_DPTH" /><!-- 답변단계 -->
		<id property="bullStatCd" column="BULL_STAT_CD" /><!-- 게시물상태코드 -->
		<id property="bullRezvYn" column="BULL_REZV_YN" /><!-- 게시물예약여부 -->
		<id property="tgtDeptYn" column="TGT_DEPT_YN" /><!-- 대상부서지정여부 -->
		<id property="tgtUserYn" column="TGT_USER_YN" /><!-- 대상사용자지정여부 -->
		<id property="subj" column="SUBJ" /><!-- 제목 -->
		<id property="catId" column="CAT_ID" /><!-- 카테고리ID -->
		<id property="catNm" column="CAT_NM" /><!-- 카테고리명 -->
		<id property="bullRezvDt" column="BULL_REZV_DT" /><!-- 게시예약일시 -->
		<id property="bullExprDt" column="BULL_EXPR_DT" /><!-- 게시완료일시 -->
		<id property="cont" column="CONT" /><!-- 본문 -->
		<id property="readCnt" column="READ_CNT" /><!-- 조회수 -->
		<id property="prosCnt" column="PROS_CNT" /><!-- 찬성수 -->
		<id property="consCnt" column="CONS_CNT" /><!-- 반대수 -->
		<id property="recmdCnt" column="RECMD_CNT" /><!-- 추천수 -->
		<id property="scre" column="SCRE" /><!-- 점수 -->
		<id property="regrUid" column="REGR_UID" /><!-- 등록자UID -->
		<id property="regrNm" column="REGR_NM" /><!-- 등록자명 -->
		<id property="regDt" column="REG_DT" /><!-- 등록일시 -->
		<id property="modrUid" column="MODR_UID" /><!-- 수정자UID -->
		<id property="modrNm" column="MODR_NM" /><!-- 수정자명 -->
		<id property="modDt" column="MOD_DT" /><!-- 수정일시 -->
		<id property="c01" column="C01" /><!-- 확장컬럼01 -->
		<id property="c02" column="C02" /><!-- 확장컬럼02 -->
		<id property="c03" column="C03" /><!-- 확장컬럼03 -->
		<id property="c04" column="C04" /><!-- 확장컬럼04 -->
		<id property="c05" column="C05" /><!-- 확장컬럼05 -->
		<id property="c06" column="C06" /><!-- 확장컬럼06 -->
		<id property="c07" column="C07" /><!-- 확장컬럼07 -->
		<id property="c08" column="C08" /><!-- 확장컬럼08 -->
		<id property="c09" column="C09" /><!-- 확장컬럼09 -->
		<id property="c10" column="C10" /><!-- 확장컬럼10 -->
		<id property="c11" column="C11" /><!-- 확장컬럼11 -->
		<id property="c12" column="C12" /><!-- 확장컬럼12 -->
		<id property="c13" column="C13" /><!-- 확장컬럼13 -->
		<id property="c14" column="C14" /><!-- 확장컬럼14 -->
		<id property="c15" column="C15" /><!-- 확장컬럼15 -->
		<id property="c16" column="C16" /><!-- 확장컬럼16 -->
		<id property="c17" column="C17" /><!-- 확장컬럼17 -->
		<id property="c18" column="C18" /><!-- 확장컬럼18 -->
		<id property="c19" column="C19" /><!-- 확장컬럼19 -->
		<id property="c20" column="C20" /><!-- 확장컬럼20 -->
		<id property="anonRegrNm" column="ANON_REGR_NM" /><!-- 익명등록자명 -->
		<id property="secuYn" column="SECU_YN" /><!-- 보안여부 -->
		<id property="ugntYn" column="UGNT_YN" /><!-- 긴급여부 -->
		<id property="notcYn" column="NOTC_YN" /><!-- 공지여부 -->
		<id property="newYn" column="NEW_YN" /><!-- 새글여부 -->
		<id property="readYn" column="READ_YN" /><!-- 조회여부 -->
		<id property="brdTypCd" column="BRD_TYP_CD" /><!-- 게시판타입코드 -->
		<id property="deptId" column="DEPT_ID" /><!-- 부서ID -->
		<id property="deptNm" column="DEPT_NM" /><!-- 부서명 -->
		<id property="cmtCnt" column="CMT_CNT" /><!-- 한줄답변수 -->
		<id property="fileCnt" column="FILE_CNT" /><!-- 첨부파일수 -->
		<id property="replyGrpRegrUid" column="REPLY_GRP_REGR_UID" /><!-- 답변원문글작성자ID -->
		<id property="tableName" column="TABLE_NAME" /><!-- 게시물 테이블명 -->
	</resultMap>

	<!-- 공통 검색조건 -->
	<sql id="selectBbBullLWhere">
			<if test="brdId != null"> AND T.BRD_ID = #{brdId, jdbcType=VARCHAR}</if>
			<if test="bullStatCd != null"> AND T.BULL_STAT_CD = #{bullStatCd, jdbcType=VARCHAR}</if>
			<if test="compId != null"> AND T.COMP_ID = #{compId, jdbcType=VARCHAR}</if>
			<if test="compIdList != null"> AND T.COMP_ID IN <foreach item="item" collection="compIdList" open="(" separator="," close=")">#{item, jdbcType=VARCHAR}</foreach></if>
			<if test="deptId != null or deptIdList != null"> AND (
				<if test="deptId != null">T.DEPT_ID = #{deptId, jdbcType=VARCHAR}</if>
				<if test="deptIdList != null">T.DEPT_ID IN <foreach item="item" collection="deptIdList" open="(" separator="," close=")">#{item, jdbcType=VARCHAR}</foreach></if>
				<if test='tgtSchYn !=null and "Y".equals(tgtSchYn) and schUserUid != null and schOrgPids != null and schDeptId != null and "B".equals(bullStatCd)'>
				OR (T.TGT_USER_YN = 'Y' AND EXISTS (SELECT 1 FROM BA_BULL_TGT_D WHERE BULL_ID = T.BULL_ID AND TGT_TYP = 'U' AND TGT_ID = #{schUserUid, jdbcType=VARCHAR}))
				OR (T.TGT_DEPT_YN = 'Y' AND (EXISTS (SELECT 1 FROM BA_BULL_TGT_D WHERE BULL_ID = T.BULL_ID AND TGT_TYP = 'D' AND WITH_SUB_YN = 'N' AND TGT_ID = #{schDeptId, jdbcType=VARCHAR})
				OR EXISTS (SELECT 1 FROM BA_BULL_TGT_D WHERE BULL_ID = T.BULL_ID AND TGT_TYP = 'D' AND WITH_SUB_YN = 'Y' AND TGT_ID IN <foreach item="item" collection="schOrgPids" open="(" separator="," close=")">#{item, jdbcType=VARCHAR}</foreach> )
				OR T.REGR_UID = #{schUserUid, jdbcType=VARCHAR}
				OR (SELECT REGR_UID FROM ${tableName} WHERE BULL_ID = T.REPLY_GRP_ID) = #{schUserUid, jdbcType=VARCHAR}
				))
				</if>
				)</if>
			<if test='brdKndCd != null and brdKndCd == "R" and bullStatCd == "B"'>
			 AND (T.BULL_EXPR_DT IS NULL OR T.BULL_EXPR_DT &gt; NOW())
			</if>
			<if test='tgtSchYn !=null and "N".equals(tgtSchYn) and schUserUid != null and schOrgPids != null and schDeptId != null and "B".equals(bullStatCd)'>
			 AND (
			 	(T.TGT_DEPT_YN != 'Y' AND T.TGT_USER_YN != 'Y')
			 	OR T.BULL_ID IN(SELECT BULL_ID FROM BA_BULL_TGT_D WHERE (
			 	(TGT_TYP = 'U' AND TGT_ID = #{schUserUid, jdbcType=VARCHAR}) OR 
			 	(TGT_TYP = 'D' AND WITH_SUB_YN = 'N' AND TGT_ID = #{schDeptId, jdbcType=VARCHAR}) OR 
			 	(TGT_TYP = 'D' AND WITH_SUB_YN = 'Y' AND TGT_ID IN <foreach item="item" collection="schOrgPids" open="(" separator="," close=")">#{item, jdbcType=VARCHAR}</foreach>)) GROUP BY BULL_ID)
				OR T.REGR_UID = #{schUserUid, jdbcType=VARCHAR}
				OR (SELECT REGR_UID FROM ${tableName} WHERE BULL_ID = T.REPLY_GRP_ID) = #{schUserUid, jdbcType=VARCHAR}
				)
			</if>
			<if test="catId != null and catId != ''"> AND T.CAT_ID = #{catId, jdbcType=VARCHAR}</if>
			<if test="schExpr != null"> AND T.BULL_EXPR_DT &lt; NOW()</if>
			<if test="schOrgId != null and schOrgId != ''"> AND U.ORG_ID = #{schOrgId, jdbcType=VARCHAR}</if>
			<if test="!isListCondApply">
				<if test="regDt != null and regDt != ''"> AND T.REG_DT &gt; STR_TO_DATE(#{regDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s')</if>
				<if test="strtYmd != null and strtYmd != ''"> AND DATE_FORMAT(T.REG_DT, '%Y-%m-%d') &gt;= #{strtYmd, jdbcType=VARCHAR}</if>
				<if test="endYmd != null and endYmd != ''"> AND DATE_FORMAT(T.REG_DT, '%Y-%m-%d') &lt;= #{endYmd, jdbcType=VARCHAR}</if>
				<if test="schRegrUid != null and schRegrUid != ''"> AND T.REGR_UID = #{schRegrUid, jdbcType=VARCHAR}</if>
				<if test="schCat == 'SUBJ' and schWord != null and schWord != ''"> AND T.SUBJ LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')</if>
				<if test="schCat == 'CONT' and schWord != null and schWord != ''"> AND T.CONT LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')</if>
				<if test="schCat == 'REGR_NM' and schWord != null and schWord != ''"> AND R.RESC_VA LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')</if>
				<if test="schCat == 'ANON_REGR_NM' and schWord != null and schWord != ''"> AND T.ANON_REGR_NM LIKE CONCAT('%', #{schWord, jdbcType=VARCHAR}, '%')</if>
			</if>
			<if test="isListCondApply">
				<if test="paramMap != null">
					<foreach collection="paramMap" item="entry" index="key" >
						<foreach collection="entry" item="item" index="index" >
							<if test="key == 'TEXT_LIKE' or key == 'DATE' or key == 'DATE_TIME' or key == 'CODE'">
								<if test="key == 'TEXT_LIKE'"> AND ${item[0]} LIKE '%${item[1]}%'</if>
								<if test="key == 'DATE'"> AND ${item[0]} = '${item[1]}'</if>
								<if test="key == 'DATE_TIME'"> AND ${item[0]} = '${item[1]}'</if>
								<if test="key == 'CODE'"> AND ${item[0]} LIKE '%${item[1]}%'</if>
							</if>
							<if test="key == 'DATE_FROM' or key == 'DATE_TIME_FROM'">
								<if test="durCat !=null and item[1] != null and item[1] != ''"><![CDATA[AND STR_TO_DATE(${item[0]}, '%Y-%m-%d %H:%i:%s') >= STR_TO_DATE('${item[1]}', '%Y-%m-%d %H:%i:%s')]]></if>
								<if test="durCat !=null and item[2] != null and item[2] != ''"><![CDATA[AND STR_TO_DATE(${item[0]}, '%Y-%m-%d %H:%i:%s') <= STR_TO_DATE('${item[2]}', '%Y-%m-%d %H:%i:%s')]]></if>
							</if>
				         </foreach>
						
				    </foreach>
				</if>
				<if test="durCat == 'regDt' and durStrtDt != null and durStrtDt != ''"><![CDATA[AND DATE_FORMAT(T.REG_DT, '%Y-%m-%d') >= #{durStrtDt, jdbcType=VARCHAR}]]></if>
				<if test="durCat == 'regDt' and durEndDt != null and durEndDt != ''"><![CDATA[AND DATE_FORMAT(T.REG_DT, '%Y-%m-%d') <= #{durEndDt, jdbcType=VARCHAR}]]></if>
				<if test="durCat == 'modDt' and durStrtDt != null and durStrtDt != ''"><![CDATA[AND DATE_FORMAT(T.MOD_DT, '%Y-%m-%d') >= #{durStrtDt, jdbcType=VARCHAR}]]></if>
				<if test="durCat == 'modDt' and durEndDt != null and durEndDt != ''"><![CDATA[AND DATE_FORMAT(T.MOD_DT, '%Y-%m-%d') <= #{durEndDt, jdbcType=VARCHAR}]]></if>
				<if test="regrUid != null and regrUid != ''"> AND T.REGR_UID = #{regrUid, jdbcType=VARCHAR}</if>
				<if test="modrUid != null and modrUid != ''"> AND T.MODR_UID = #{modrUid, jdbcType=VARCHAR}</if>
				<if test="regrNm != null and regrNm != ''"> AND R.RESC_VA LIKE CONCAT('%', #{regrNm, jdbcType=VARCHAR}, '%')</if>
				<if test="modrNm != null and modrNm != ''"> AND R2.RESC_VA LIKE CONCAT('%', #{modrNm, jdbcType=VARCHAR}, '%')</if>
				<if test="(durCat==null or durCat=='') and regDt != null and regDt != ''"> AND T.REG_DT = STR_TO_DATE(#{regDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s')</if>
				<if test="(durCat==null or durCat=='') and modDt != null and modDt != ''"> AND T.MOD_DT = STR_TO_DATE(#{modDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s')</if>
			</if>
	</sql>

	<select id="selectBbBullL" resultMap="bbBullLMap" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.selectBbBullL */
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			T.BULL_ID,
			T.COMP_ID,
			T.BRD_ID,
			(SELECT RESC_VA FROM BA_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM BA_BRD_B WHERE BRD_ID = T.BRD_ID) AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')) BRD_NM,
			T.BULL_PID,
			T.REPLY_GRP_ID,
			T.REPLY_ORDR,
			T.REPLY_DPTH,
			T.BULL_STAT_CD,
			T.BULL_REZV_YN,
			T.TGT_DEPT_YN,
			T.TGT_USER_YN,
			T.SUBJ,
			T.CAT_ID,
			(SELECT RESC_VA FROM BA_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM BA_CAT_D WHERE CAT_ID = T.CAT_ID) AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR},'ko')) CAT_NM,
			T.BULL_REZV_DT,
			T.BULL_EXPR_DT,
			<if test="withLob">T.CONT,</if>
			T.READ_CNT,
			T.PROS_CNT,
			T.CONS_CNT,
			T.RECMD_CNT,
			T.SCRE,
			T.REGR_UID,
			(SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_USER_B WHERE USER_UID = T.REGR_UID) AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')) REGR_NM,
			T.REG_DT,
			T.MODR_UID,
			(SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_USER_B WHERE USER_UID = T.MODR_UID) AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')) MODR_NM,
			T.MOD_DT,
			<if test="exColmNmList != null"><foreach item="exColmNm" index="index" collection="exColmNmList" >
			T.${exColmNm},
			</foreach></if>
			<if test="dispOrdr != null and dispOrdr != ''">${dispOrdr}</if><if test="dispOrdr == null or dispOrdr == ''">NULL </if> DISP_ORDR,
			T.ANON_REGR_NM,
			(SELECT BRD_TYP_CD FROM BA_BRD_B WHERE BRD_ID = T.BRD_ID) BRD_TYP_CD,
			IFNULL(O.SECU_YN, 'N') SECU_YN,
			IFNULL(O.UGNT_YN, 'N') UGNT_YN,
			IFNULL(O.NOTC_YN, 'N') NOTC_YN,
			CASE WHEN T.REG_DT &gt; DATE_ADD(NOW(), INTERVAL -(SELECT NEW_DISP_PRD FROM BA_BRD_B WHERE BRD_ID = T.BRD_ID) DAY) THEN 'Y' ELSE 'N' END NEW_YN,
			(SELECT CASE WHEN COUNT(*) > 0 THEN 'Y' ELSE 'N' END FROM BA_READ_HST_L WHERE BULL_ID = T.BULL_ID AND USER_UID = #{schUserUid, jdbcType=VARCHAR}) READ_YN,
			T.DEPT_ID, 
			(SELECT RESC_VA FROM OR_RESC_B WHERE LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko') AND RESC_ID = (SELECT DEPT_RESC_ID FROM OR_USER_B WHERE USER_UID = T.REGR_UID)) AS DEPT_NM,
			-- (SELECT COUNT(*) FROM BA_CMT_D WHERE BULL_ID = T.BULL_ID) CMT_CNT,
			-- (SELECT COUNT(*) FROM BA_BULL_FILE_D WHERE REF_ID = CONVERT(T.BULL_ID, CHAR)) FILE_CNT,
			(SELECT A.REGR_UID FROM ${tableName} A WHERE A.BULL_ID = T.REPLY_GRP_ID) AS REPLY_GRP_REGR_UID,
			#{tableName, jdbcType=VARCHAR} TABLE_NAME,
		</trim>
		FROM ${tableName} T
			LEFT JOIN BA_BULL_OPT_D O ON T.BULL_ID = O.BULL_ID
		<if test="(!isListCondApply and schCat == 'REGR_NM' and schWord != null and schWord != '') or (schOrgId != null and schOrgId != '') or (isListCondApply and regrNm != null and regrNm != '')">
			LEFT JOIN OR_USER_B U ON T.REGR_UID = U.USER_UID
			<if test="(!isListCondApply and schCat == 'REGR_NM' and schWord != null and schWord != '') or (isListCondApply and regrNm != null and regrNm != '')">
				LEFT JOIN OR_RESC_B R ON U.RESC_ID = R.RESC_ID AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')
			</if>
		</if>
		<if test="isListCondApply and modrNm != null and modrNm != ''">
			LEFT JOIN OR_USER_B U2 ON T.MODR_UID = U2.USER_UID
			LEFT JOIN OR_RESC_B R2 ON U2.RESC_ID = R2.RESC_ID AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')
		</if>
		<where>
			<if test="bullId != null"> AND T.BULL_ID = #{bullId, jdbcType=INTEGER}</if>
			<if test="bullPid != null"> AND T.BULL_PID = #{bullPid, jdbcType=INTEGER}</if>
			<if test="replyGrpId != null"> AND T.REPLY_GRP_ID = #{replyGrpId, jdbcType=INTEGER}</if>
			<if test="notcYn != null and notcYn != ''"> AND O.NOTC_YN = #{notcYn, jdbcType=VARCHAR}</if>
			<include refid="selectBbBullLWhere"/>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
		<if test="orderBy != null">ORDER BY ${orderBy}</if>
		<if test="orderBy == null">ORDER BY T.BULL_ID DESC</if>
		<if test="pageNo != null and pageRowCnt != null">
		LIMIT #{pageStrt, jdbcType=NUMERIC}, #{pageRowCnt, jdbcType=NUMERIC}
		</if>
	</select>

	<select id="countBbBullL" resultType="Integer" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.countBbBullL */
		SELECT COUNT(*) CNT
		FROM ${tableName} T
			LEFT JOIN BA_BULL_OPT_D O ON T.BULL_ID = O.BULL_ID
		<if test="(!isListCondApply and schCat == 'REGR_NM' and schWord != null and schWord != '') or (schOrgId != null and schOrgId != '') or (isListCondApply and regrNm != null and regrNm != '')">
			LEFT JOIN OR_USER_B U ON T.REGR_UID = U.USER_UID
			<if test="(!isListCondApply and schCat == 'REGR_NM' and schWord != null and schWord != '') or (isListCondApply and regrNm != null and regrNm != '')">
				LEFT JOIN OR_RESC_B R ON U.RESC_ID = R.RESC_ID AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')
			</if>
		</if>
		<if test="isListCondApply and modrNm != null and modrNm != ''">
			LEFT JOIN OR_USER_B U2 ON T.MODR_UID = U2.USER_UID
			LEFT JOIN OR_RESC_B R2 ON U2.RESC_ID = R2.RESC_ID AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')
		</if>
		<where>
			<if test="bullId != null"> AND T.BULL_ID = #{bullId, jdbcType=INTEGER}</if>
			<if test="bullPid != null"> AND T.BULL_PID = #{bullPid, jdbcType=INTEGER}</if>
			<if test="replyGrpId != null"> AND T.REPLY_GRP_ID = #{replyGrpId, jdbcType=INTEGER}</if>
			<if test="notcYn != null and notcYn != ''"> AND O.NOTC_YN = #{notcYn, jdbcType=VARCHAR}</if>
			<include refid="selectBbBullLWhere"/>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</select>

	<select id="selectNewList" resultMap="bbBullLMap" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.selectNewList */
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			T.BULL_ID,
			T.COMP_ID,
			T.BRD_ID,
			(SELECT RESC_VA FROM BA_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM BA_BRD_B WHERE BRD_ID = T.BRD_ID) AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')) BRD_NM,
			T.REPLY_GRP_ID,
			T.REPLY_ORDR,
			T.REPLY_DPTH,
			T.BULL_STAT_CD,
			T.BULL_REZV_YN,
			T.TGT_DEPT_YN,
			T.TGT_USER_YN,
			T.SUBJ,
			T.READ_CNT,
			T.REGR_UID,
			(SELECT RESC_VA FROM OR_RESC_B WHERE RESC_ID = (SELECT RESC_ID FROM OR_USER_B WHERE USER_UID = T.REGR_UID) AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')) REGR_NM,
			T.REG_DT,
			T.ANON_REGR_NM,
			(SELECT BRD_TYP_CD FROM BA_BRD_B WHERE BRD_ID = T.BRD_ID) BRD_TYP_CD,
			IFNULL(O.SECU_YN, 'N') SECU_YN,
			IFNULL(O.UGNT_YN, 'N') UGNT_YN,
			IFNULL(O.NOTC_YN, 'N') NOTC_YN,
			CASE WHEN T.REG_DT &gt; DATE_ADD(NOW(), INTERVAL -(SELECT NEW_DISP_PRD FROM BA_BRD_B WHERE BRD_ID = T.BRD_ID) DAY) THEN 'Y' ELSE 'N' END NEW_YN,
			(SELECT CASE WHEN COUNT(*) > 0 THEN 'Y' ELSE 'N' END FROM BA_READ_HST_L WHERE BULL_ID = T.BULL_ID AND USER_UID = #{schUserUid, jdbcType=VARCHAR}) READ_YN,
			T.DEPT_ID,
			(SELECT RESC_VA FROM OR_RESC_B WHERE LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko') AND RESC_ID = (SELECT DEPT_RESC_ID FROM OR_USER_B WHERE USER_UID = T.REGR_UID)) AS DEPT_NM,
			-- (SELECT COUNT(*) FROM BA_CMT_D WHERE BULL_ID = T.BULL_ID) CMT_CNT,
			-- (SELECT COUNT(*) FROM BA_BULL_FILE_D WHERE REF_ID = CONVERT(T.BULL_ID, CHAR)) FILE_CNT,
			#{tableName, jdbcType=VARCHAR} TABLE_NAME,
		</trim>
		FROM ${tableName} T
			LEFT JOIN BA_BULL_OPT_D O ON T.BULL_ID = O.BULL_ID
		<if test="schCat == 'REGR_NM' and schWord != null and schWord != ''">
			LEFT JOIN OR_USER_B U ON T.REGR_UID = U.USER_UID
			LEFT JOIN OR_RESC_B R ON U.RESC_ID = R.RESC_ID AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')
		</if>
		<where>
			<if test="bullId != null"> AND T.BULL_ID = #{bullId, jdbcType=INTEGER}</if>
			<if test="bullPid != null"> AND T.BULL_PID = #{bullPid, jdbcType=INTEGER}</if>
			<if test="replyGrpId != null"> AND T.REPLY_GRP_ID = #{replyGrpId, jdbcType=INTEGER}</if>
			<if test="notcYn != null and notcYn != ''"> AND O.NOTC_YN = #{notcYn, jdbcType=VARCHAR}</if>
			<include refid="selectBbBullLWhere"/>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
		<if test="orderBy != null">ORDER BY ${orderBy}</if>
		<if test="orderBy == null">ORDER BY T.BULL_ID DESC</if>
	</select>

	<select id="selectNextId" resultType="int" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.selectNextId */
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			MAX(BULL_ID) AS BULL_ID,
		</trim>
		FROM ${tableName} T
		<if test="schCat == 'REGR_NM' and schWord != null and schWord != ''">
			LEFT JOIN OR_USER_B U ON T.REGR_UID = U.USER_UID
			LEFT JOIN OR_RESC_B R ON U.RESC_ID = R.RESC_ID AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')
		</if>
		<where>
			AND BULL_ID &lt; #{bullId, jdbcType=INTEGER}
			<if test="replyDpth != null and replyDpth == 0"> AND REPLY_DPTH = 0</if>
			<include refid="selectBbBullLWhere"/>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</select>

	<select id="selectPrevId" resultType="int" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.selectPrevId */
		SELECT
		<trim prefix="" suffix="" suffixOverrides=",">
			MIN(BULL_ID) AS BULL_ID,
		</trim>
		FROM ${tableName} T
		<if test="schCat == 'REGR_NM' and schWord != null and schWord != ''">
			LEFT JOIN OR_USER_B U ON T.REGR_UID = U.USER_UID
			LEFT JOIN OR_RESC_B R ON U.RESC_ID = R.RESC_ID AND LANG_TYP_CD = IFNULL(#{queryLang, jdbcType=VARCHAR}, 'ko')
		</if>
		<where>
			AND BULL_ID &gt; #{bullId, jdbcType=INTEGER}
			<if test="replyDpth != null and replyDpth == 0"> AND REPLY_DPTH = 0</if>
			<include refid="selectBbBullLWhere"/>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</select>

	<insert id="insertBbBullL" parameterType="BbBullLVo">
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.insertBbBullL */
		INSERT INTO ${tableName}
		<trim prefix="(" suffix=")" suffixOverrides=",">
			BULL_ID,
			COMP_ID,
			BRD_ID,
			BULL_PID,
			REPLY_GRP_ID,
			REPLY_ORDR,
			REPLY_DPTH,
			BULL_STAT_CD,
			BULL_REZV_YN,
			TGT_DEPT_YN,
			TGT_USER_YN,
			SUBJ,
			CAT_ID,
			BULL_REZV_DT,
			BULL_EXPR_DT,
			CONT,
			READ_CNT,
			PROS_CNT,
			CONS_CNT,
			RECMD_CNT,
			SCRE,
			REGR_UID,
			REG_DT,
			MODR_UID,
			MOD_DT,
			<if test="c01 != null">C01,</if>
			<if test="c02 != null">C02,</if>
			<if test="c03 != null">C03,</if>
			<if test="c04 != null">C04,</if>
			<if test="c05 != null">C05,</if>
			<if test="c06 != null">C06,</if>
			<if test="c07 != null">C07,</if>
			<if test="c08 != null">C08,</if>
			<if test="c09 != null">C09,</if>
			<if test="c10 != null">C10,</if>
			<if test="c11 != null">C11,</if>
			<if test="c12 != null">C12,</if>
			<if test="c13 != null">C13,</if>
			<if test="c14 != null">C14,</if>
			<if test="c15 != null">C15,</if>
			<if test="c16 != null">C16,</if>
			<if test="c17 != null">C17,</if>
			<if test="c18 != null">C18,</if>
			<if test="c19 != null">C19,</if>
			<if test="c20 != null">C20,</if>
			ANON_REGR_NM,
			DEPT_ID,
		</trim>
		<trim prefix="VALUES (" suffix=")" suffixOverrides=",">
			#{bullId, jdbcType=VARCHAR},
			#{compId, jdbcType=VARCHAR},
			#{brdId, jdbcType=VARCHAR},
			#{bullPid, jdbcType=INTEGER},
			#{replyGrpId, jdbcType=VARCHAR},
			#{replyOrdr, jdbcType=INTEGER},
			#{replyDpth, jdbcType=INTEGER},
			#{bullStatCd, jdbcType=VARCHAR},
			#{bullRezvYn, jdbcType=VARCHAR},
			#{tgtDeptYn, jdbcType=VARCHAR},
			#{tgtUserYn, jdbcType=VARCHAR},
			#{subj, jdbcType=NVARCHAR},
			#{catId, jdbcType=VARCHAR},
			<if test="bullRezvDt == null or bullRezvDt == ''">NULL,</if>
			<if test="bullRezvDt != null and bullRezvDt != ''">STR_TO_DATE(#{bullRezvDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			<if test="bullExprDt == null or bullExprDt == ''">NULL,</if>
			<if test="bullExprDt != null and bullExprDt != ''">STR_TO_DATE(#{bullExprDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			#{cont, jdbcType=CLOB},
			#{readCnt, jdbcType=INTEGER},
			#{prosCnt, jdbcType=INTEGER},
			#{consCnt, jdbcType=INTEGER},
			#{recmdCnt, jdbcType=INTEGER},
			#{scre, jdbcType=INTEGER},
			<if test="regrUid != null">#{regrUid, jdbcType=VARCHAR},</if><if test="regrUid == null">#{modrUid, jdbcType=VARCHAR},</if>
			<if test="regDt == 'sysdate'">NOW(),</if><if test="regDt == null or regDt == ''"><if test="modDt == 'sysdate'">NOW(),</if><if test="modDt != 'sysdate'">NULL,</if></if>
			<if test="regDt != null and regDt != '' and regDt != 'sysdate'">STR_TO_DATE(#{regDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			#{modrUid, jdbcType=VARCHAR},
			<if test="modDt == 'sysdate'">NOW(),</if><if test="modDt == null or modDt == ''">NULL,</if>
			<if test="modDt != null and modDt != '' and modDt != 'sysdate'">STR_TO_DATE(#{modDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			<if test="c01 != null">#{c01, jdbcType=VARCHAR},</if>
			<if test="c02 != null">#{c02, jdbcType=VARCHAR},</if>
			<if test="c03 != null">#{c03, jdbcType=VARCHAR},</if>
			<if test="c04 != null">#{c04, jdbcType=VARCHAR},</if>
			<if test="c05 != null">#{c05, jdbcType=VARCHAR},</if>
			<if test="c06 != null">#{c06, jdbcType=VARCHAR},</if>
			<if test="c07 != null">#{c07, jdbcType=VARCHAR},</if>
			<if test="c08 != null">#{c08, jdbcType=VARCHAR},</if>
			<if test="c09 != null">#{c09, jdbcType=VARCHAR},</if>
			<if test="c10 != null">#{c10, jdbcType=VARCHAR},</if>
			<if test="c11 != null">#{c11, jdbcType=VARCHAR},</if>
			<if test="c12 != null">#{c12, jdbcType=VARCHAR},</if>
			<if test="c13 != null">#{c13, jdbcType=VARCHAR},</if>
			<if test="c14 != null">#{c14, jdbcType=VARCHAR},</if>
			<if test="c15 != null">#{c15, jdbcType=VARCHAR},</if>
			<if test="c16 != null">#{c16, jdbcType=VARCHAR},</if>
			<if test="c17 != null">#{c17, jdbcType=VARCHAR},</if>
			<if test="c18 != null">#{c18, jdbcType=VARCHAR},</if>
			<if test="c19 != null">#{c19, jdbcType=VARCHAR},</if>
			<if test="c20 != null">#{c20, jdbcType=VARCHAR},</if>
			#{anonRegrNm, jdbcType=VARCHAR},
			#{deptId, jdbcType=VARCHAR},
		</trim>
	</insert>

	<update id="updateBbBullL" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.updateBbBullL */
		UPDATE ${tableName}
		<set>
			<if test="brdId != null"> BRD_ID = #{brdId, jdbcType=VARCHAR},</if>
			<if test="replyOrdr != null and bullId != null"> REPLY_ORDR = #{replyOrdr, jdbcType=INTEGER},</if>
			<if test="replyOrdr != null and bullId == null"> REPLY_ORDR = REPLY_ORDR + 1,</if>
			<if test="replyDpth != null"> REPLY_DPTH = #{replyDpth, jdbcType=INTEGER},</if>
			<if test="bullStatCd != null"> BULL_STAT_CD = #{bullStatCd, jdbcType=VARCHAR},</if>
			<if test="bullRezvYn != null"> BULL_REZV_YN = #{bullRezvYn, jdbcType=VARCHAR},</if>
			<if test="bullRezvYn == null and bullRezvDt == ''"> BULL_REZV_YN = #{bullRezvYn, jdbcType=VARCHAR},</if>
			<if test="tgtDeptYn != null">TGT_DEPT_YN = #{tgtDeptYn, jdbcType=VARCHAR},</if>
			<if test="tgtUserYn != null">TGT_USER_YN = #{tgtUserYn, jdbcType=VARCHAR},</if>
			<if test="subj != null"> SUBJ = #{subj, jdbcType=NVARCHAR},</if>
			<if test="catId != null"> CAT_ID = #{catId, jdbcType=VARCHAR},</if>
			<if test="bullRezvDt != null and bullRezvDt != ''"> BULL_REZV_DT = STR_TO_DATE(#{bullRezvDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			<if test="bullExprDt != null and bullExprDt != ''"> BULL_EXPR_DT = STR_TO_DATE(#{bullExprDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			<if test="cont != null"> CONT = #{cont, jdbcType=CLOB},</if>
			<if test="readCnt != null"> READ_CNT = #{readCnt, jdbcType=INTEGER},</if>
			<if test="prosCnt != null"> PROS_CNT = #{prosCnt, jdbcType=INTEGER},</if>
			<if test="consCnt != null"> CONS_CNT = #{consCnt, jdbcType=INTEGER},</if>
			<if test="recmdCnt != null"> RECMD_CNT = #{recmdCnt, jdbcType=INTEGER},</if>
			<if test="scre != null"> SCRE = #{scre, jdbcType=INTEGER}</if>
			<if test="regrUid != null"> REGR_UID = #{regrUid, jdbcType=VARCHAR},</if>
			<if test="modrUid != null"> MODR_UID = #{modrUid, jdbcType=VARCHAR},</if>
			<if test="modDt != null">
				<if test="modDt == 'sysdate'"> MOD_DT = NOW(),</if>
				<if test="modDt == ''"> MOD_DT = NULL,</if>
				<if test="modDt != '' and modDt != 'sysdate'"> MOD_DT = STR_TO_DATE(#{modDt, jdbcType=VARCHAR}, '%Y-%m-%d %H:%i:%s'),</if>
			</if>
			<if test="c01 != null"> C01 = #{c01, jdbcType=VARCHAR},</if>
			<if test="c02 != null"> C02 = #{c02, jdbcType=VARCHAR},</if>
			<if test="c03 != null"> C03 = #{c03, jdbcType=VARCHAR},</if>
			<if test="c04 != null"> C04 = #{c04, jdbcType=VARCHAR},</if>
			<if test="c05 != null"> C05 = #{c05, jdbcType=VARCHAR},</if>
			<if test="c06 != null"> C06 = #{c06, jdbcType=VARCHAR},</if>
			<if test="c07 != null"> C07 = #{c07, jdbcType=VARCHAR},</if>
			<if test="c08 != null"> C08 = #{c08, jdbcType=VARCHAR},</if>
			<if test="c09 != null"> C09 = #{c09, jdbcType=VARCHAR},</if>
			<if test="c10 != null"> C10 = #{c10, jdbcType=VARCHAR},</if>
			<if test="c11 != null"> C11 = #{c11, jdbcType=VARCHAR},</if>
			<if test="c12 != null"> C12 = #{c12, jdbcType=VARCHAR},</if>
			<if test="c13 != null"> C13 = #{c13, jdbcType=VARCHAR},</if>
			<if test="c14 != null"> C14 = #{c14, jdbcType=VARCHAR},</if>
			<if test="c15 != null"> C15 = #{c15, jdbcType=VARCHAR},</if>
			<if test="c16 != null"> C16 = #{c16, jdbcType=VARCHAR},</if>
			<if test="c17 != null"> C17 = #{c17, jdbcType=VARCHAR},</if>
			<if test="c18 != null"> C18 = #{c18, jdbcType=VARCHAR},</if>
			<if test="c19 != null"> C19 = #{c19, jdbcType=VARCHAR},</if>
			<if test="c20 != null"> C20 = #{c20, jdbcType=VARCHAR},</if>
			<if test="anonRegrNm != null"> ANON_REGR_NM = #{anonRegrNm, jdbcType=VARCHAR},</if>
		</set>
		<where>
			<if test="bullId != null"> AND BULL_ID = #{bullId, jdbcType=INTEGER}</if>
			<if test="bullId == null and replyGrpId != null and replyOrdr != null">
				AND REPLY_GRP_ID = #{replyGrpId, jdbcType=VARCHAR}
				AND REPLY_ORDR &gt;= #{replyOrdr, jdbcType=INTEGER}
			</if>
			<if test="bullId == null and replyGrpId == null"> AND 1=0</if>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</update>

	<delete id="deleteBbBullL" parameterType="BbBullLVo">
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.deleteBbBullL */
		DELETE FROM ${tableName}
		<where>
			<if test="bullId != null"> AND BULL_ID = #{bullId, jdbcType=INTEGER}</if>
			<if test="brdId != null"> AND BRD_ID = #{brdId, jdbcType=VARCHAR}</if>
			<if test="bullId == null and brdId == null"> AND 1=0</if>
			<if test="whereSqllet != null and whereSqllet != ''"> ${whereSqllet}</if>
		</where>
	</delete>

	<select id="selectMinReplyOrdr" resultType="int" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.selectMinReplyOrdr */
		SELECT MIN(REPLY_ORDR) REPLY_ORDR
		FROM ${tableName} T
		<where>
			AND T.REPLY_GRP_ID = #{replyGrpId, jdbcType=INTEGER}
			AND T.REPLY_ORDR &gt; #{replyOrdr, jdbcType=INTEGER}
			AND T.REPLY_DPTH &lt;= #{replyDpth, jdbcType=INTEGER}
		</where>
	</select>

	<select id="selectMaxReplyOrdr" resultType="int" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.selectMinReplyOrdr */
		SELECT MAX(REPLY_ORDR) REPLY_ORDR
		FROM ${tableName} T
		<where>
			AND T.REPLY_GRP_ID = #{replyGrpId, jdbcType=INTEGER}
		</where>
	</select>

	<update id="updateReplyOrdr" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.updateReplyOrdr */
		UPDATE ${tableName}
		<set>
			REPLY_ORDR = REPLY_ORDR + 1,
		</set>
		<where>
			AND REPLY_GRP_ID = #{replyGrpId, jdbcType=VARCHAR}
			AND REPLY_ORDR &gt;= #{replyOrdr, jdbcType=INTEGER}
		</where>
	</update>

	<update id="updateReadCnt" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.updateReadCnt */
		UPDATE ${tableName}
		<set>
			READ_CNT = READ_CNT + 1,
		</set>
		<where>
			AND BULL_ID = #{bullId, jdbcType=INTEGER}
		</where>
	</update>

	<update id="updateRecmdCnt" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.updateRecmdCnt */
		UPDATE ${tableName}
		<set>
			RECMD_CNT = RECMD_CNT + 1,
		</set>
		<where>
			AND BULL_ID = #{bullId, jdbcType=INTEGER}
		</where>
	</update>

	<update id="updateProsCnt" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.updateProsCnt */
		UPDATE ${tableName}
		<set>
			PROS_CNT = PROS_CNT + 1,
		</set>
		<where>
			AND BULL_ID = #{bullId, jdbcType=INTEGER}
		</where>
	</update>

	<update id="updateConsCnt" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.updateConsCnt */
		UPDATE ${tableName}
		<set>
			CONS_CNT = CONS_CNT + 1,
		</set>
		<where>
			AND BULL_ID = #{bullId, jdbcType=INTEGER}
		</where>
	</update>

	<update id="updateScre" parameterType="BbBullLVo" >
		/* com.innobiz.orange.web.bb.dao.BbBullLDao.updateScre */
		UPDATE ${tableName}
		<set>
			SCRE = (SELECT AVG(SCRE) FROM BA_SCRE_HST_L WHERE BULL_ID = ${tableName}.BULL_ID)
		</set>
		<where>
			AND BULL_ID = #{bullId, jdbcType=INTEGER}
		</where>
	</update>

</mapper>